<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Cardano2vn Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Cardano2vn Blog Atom Feed"><title data-react-helmet="true">Week 04 - Monads | Cardano2vn</title><meta data-react-helmet="true" property="og:url" content="https://cardano2vn.io/docs/dr-lars-lession/week4"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Week 04 - Monads | Cardano2vn"><meta data-react-helmet="true" name="description" content="Đây là phiên bản viết của Bài [giảng số"><meta data-react-helmet="true" property="og:description" content="Đây là phiên bản viết của Bài [giảng số"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo/2.png"><link data-react-helmet="true" rel="canonical" href="https://cardano2vn.io/docs/dr-lars-lession/week4"><link data-react-helmet="true" rel="alternate" href="https://cardano2vn.io/docs/dr-lars-lession/week4" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cardano2vn.io/docs/dr-lars-lession/week4" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.8b54419c.css">
<link rel="preload" href="/assets/js/runtime~main.38f84b10.js" as="script">
<link rel="preload" href="/assets/js/main.c8d132ad.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo/2.png" alt="Cardano2vn Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo/2.png" alt="Cardano2vn Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Cardano2vn</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/getting-started/overview">Bắt đầu</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cardano2vn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo/2.png" alt="Cardano2vn Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo/2.png" alt="Cardano2vn Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Cardano2vn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/getting-started/overview">Bắt đầu</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/cardano2vn" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/overview">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tạo Hợp đồng thông minh</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/smart-contracts/overview">Tổng quan</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/smart-contracts/marlowe">Ngôn ngữ Marlowe</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/smart-contracts/plutus">Ngôn ngữ Plutus</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tích hợp với Cardano</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/integrate-cardano/note">Note</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Vận hành một Stake Pool</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operate-a-stake-pool/note">Note</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Khoá đào tạo Plutus của Dr. Lars</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dr-lars-lession/overview">Plutus Pioneer Program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dr-lars-lession/week1">Week 01 - English Auction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dr-lars-lession/week2">Week 02 - Validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dr-lars-lession/week3">Week 03 - Script Context</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/dr-lars-lession/week4">Week 04 - Monads</a></li></ul></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Week 04 - Monads</h1></header><div class="markdown"><p>Đây là phiên bản viết của Bài <a href="https://youtu.be/HLJOcKlEucI" target="_blank" rel="noopener noreferrer">giảng số
4</a>.</p><p>Trong bài giảng này, chúng ta tìm hiểu về Đơn nguyên (monads). Đặc biệt là các
monads EmulatorTrace và Contract..</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="tổng-quat"></a>Tổng quat<a class="hash-link" href="#tổng-quat" title="Direct link to heading">#</a></h2><p>Chúng tôi đã dành hai bài giảng cuối cùng để nói về phần on-chain của
Plutus - logic xác thực được biên dịch thành tập lệnh Plutus và thực sự
sống trên blockchain và được thực hiện bởi các nút xác thực giao dịch.</p><p>Còn rất nhiều điều để nói về bộ phận on-chain đó.</p><p>Chúng tôi chưa xem xét các ví dụ phức tạp hơn về xác thực sử dụng ngữ
cảnh phức tạp hơn và chúng tôi chưa thấy cách mã thông báo gốc hoạt động
như thế nào (tập lệnh Plutus cũng được sử dụng để xác thực việc đúc và
đốt mã thông báo gốc).</p><p>Chúng ta chắc chắn sẽ phải nói về những chủ đề đó, và quay lại vấn đề
đó.</p><p>Tuy nhiên, trước khi đi vào quá nhiều chủ đề phức tạp về xác thực trên
chuỗi, chúng ta không được bỏ qua phần ngoài chuỗi, vì nó cũng quan
trọng không kém.</p><p>Phần on-chain đảm nhận việc xác thực nhưng để có thứ gì đó được xác
thực, chúng ta phải xây dựng một giao dịch và gửi nó lên blockchain. Và,
đó là những gì phần off-chain thực hiện.</p><p>Vì vậy, chúng ta sẽ bắt đầu nói về cách viết mã Plutus ngoài chuỗi.</p><p>Thật không may, có một vấn đề nhỏ liên quan đến các tính năng Haskell
cần thiết.</p><p>Phần on-chain mà chúng ta đã thấy cho đến nay hơi xa lạ và cần làm quen
một chút, do thực tế là chúng ta có thêm sự phức tạp của quá trình biên
dịch sang tập lệnh Plutus. Nhưng, chúng ta không thực sự phải lo lắng về
điều đó nếu chúng ta sử dụng phép thuật Template Haskell. Trong trường
hợp đó, hàm xác nhận chỉ là một hàm đơn giản.</p><p>Và nó thực sự là một hàm Haskell rất đơn giản theo quan điểm kỹ thuật.
Chúng tôi không sử dụng bất kỳ tính năng Haskell ưa thích nào để viết
hàm này.</p><p>Một trong những lý do cho điều đó là cách thức hoạt động của quá trình
biên dịch Plutus. Chúng tôi đã thấy làm thế nào để việc biên dịch sang
Plutus thành công, tất cả mã được sử dụng bởi hàm xác nhận phải có sẵn
trong Oxford Brackets. Điều này có nghĩa là tất cả các chức năng được sử
dụng bởi chức năng <code>mkValidator</code> phải sử dụng pragma INLINABLE.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{-# INLINABLE mkValidator #-}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mkValidator :: Data -&gt; Data -&gt; Data -&gt; ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mkValidator _ _ _ = ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">$$(PlutusTx.compile [|| mkValidator ||])</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Và hãy nhớ lại rằng vì các hàm Haskell tiêu chuẩn không có pragma CÓ THỂ
LỆNH này, nên có một mô-đun Plutus Prelude mới tương tự như Haskell
Prelude tiêu chuẩn, nhưng với các chức năng được xác định với pragma
INLINABLE.</p><p>Nhưng, tất nhiên, có hàng trăm thư viện Haskell ngoài kia và hầu hết
chúng không được viết với Plutus, vì vậy chúng tôi không thể sử dụng
chúng trong quá trình xác thực. Và, điều đó có tác dụng là xác thực bên
trong Haskell sẽ tương đối đơn giản và sẽ không có nhiều phụ thuộc.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="monads"></a>Monads<a class="hash-link" href="#monads" title="Direct link to heading">#</a></h2><p>Trong phần off-chain của Plutus, tình hình đã đảo ngược. Chúng ta không
phải lo lắng về việc biên dịch sang tập lệnh Plutus - nó chỉ là Haskell
đơn giản. Tuy nhiên, mặt trái của nó là, cách nó được thực hiện, nó sử
dụng các tính năng Haskell phức tạp hơn nhiều - ví dụ như cái gọi là hệ
thống hiệu ứng, phát trực tuyến và đặc biệt là monads.</p><p>Tất cả mã off-chain (mã ví), được viết bằng một đơn nguyên đặc biệt -
Đơn nguyên hợp đồng.</p><p>Các tu viện nổi tiếng trong thế giới Haskell. Đây thường là trở ngại đầu
tiên khi bắt đầu lập trình viên Haskell.</p><p>Có rất nhiều hướng dẫn cố gắng giải thích các Monads. Monads được so
sánh với burritos, và tất cả các loại ẩn dụ được sử dụng để cố gắng giải
thích khái niệm. Nhưng ở đây, ít nhất chúng ta hãy cố gắng cung cấp một
khóa học cơ bản về monads cho những người mới sử dụng Haskell.</p><p>Trước khi đến với các đơn nguyên chung, chúng ta sẽ bắt đầu với IO , đó
là cách xử lý các tác dụng phụ của IO trong Haskell. Tuy nhiên, trước
khi đến với Haskell, chúng ta hãy xem xét một ngôn ngữ chính thống như
Java.</p><p>Hãy xem xét phương pháp Java sau đây.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.java}"><div tabindex="0" class="prism-code language-{.java} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">public static int foo() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   ...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hàm này không có đối số và nó trả về <code>int</code>. Hãy tưởng tượng nó được gọi
hai lần trong mã.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.java}"><div tabindex="0" class="prism-code language-{.java} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">final int a = foo();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">final int b = foo();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ, chúng ta lưu ý rằng, chừng nào chúng ta không biết điều gì đang
xảy ra bên trong hàm foo(), thì giá trị trả về của biểu thức sau là
không xác định.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.java}"><div tabindex="0" class="prism-code language-{.java} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">a == b; // true or false? at compile time, we don&#x27;t know</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi không biết có <code>a</code> giống như <code>b</code> vậy không vì trong Java, hoàn
toàn có thể xảy ra một số IO bên trong <code>foo</code>. Ví dụ: có mã là mã yêu cầu
người dùng nhập đầu vào trên bảng điều khiển và sử dụng mã này để tính
toán giá trị trả về.</p><p>Điều này có nghĩa là, để lập luận về mã, chúng ta cần phải nhìn vào bên
trong <code>foo</code>, điều này làm cho việc thử nghiệm trở nên khó khăn hơn. Và
nó có nghĩa là, <code>foo</code> ví dụ , đó là lệnh gọi trả về đầu tiên <code>13</code>- chúng
ta không thể thay thế tất cả các lệnh gọi khác đến <code>foo</code> bằng giá trị
trả về đã biết của <code>13</code>.</p><p>Ở Haskell, tình hình rất khác vì Haskell là một ngôn ngữ chức năng thuần
túy. Chữ ký tương đương trong Haskell sẽ giống như sau:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo :: Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo = ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ, nếu chúng ta gặp trường hợp chúng ta gọi <code>foo</code> hai lần, mặc dù
chúng ta không biết giá trị của <code>foo</code> là gì, chúng ta biết chắc rằng hai
giá trị trả về sẽ giống nhau.</p><p>Đây là một tính năng rất quan trọng được gọi là tính minh bạch tham
chiếu . Trên thực tế, có một số cửa thoát hiểm để giải quyết vấn đề này,
nhưng chúng ta có thể bỏ qua điều này.</p><p>Điều này làm cho các tác vụ như tái cấu trúc và kiểm tra dễ dàng hơn
nhiều.</p><p>Điều này là rất tốt, nhưng bạn cần có tác dụng phụ để có ảnh hưởng đến
thế giới. Nếu không, tất cả những gì chương trình của bạn làm là làm
nóng bộ xử lý.</p><p>Bạn cần đầu vào và đầu ra. Bạn phải có khả năng ghi kết quả đầu ra ra
màn hình, hoặc đọc đầu vào từ bàn phím, kết nối mạng hoặc tệp, chẳng
hạn.</p><p>Có một <a href="https://www.youtube.com/watch?v=iSmkqocn0oQ" target="_blank" rel="noopener noreferrer">video nổi tiếng của Simon Peyton-Jones là Haskell Is
Useless</a> giải thích rằng
ngôn ngữ thuần túy, không có tác dụng phụ thì rất đẹp về mặt toán học,
nhưng cuối cùng thì bạn cũng cần có tác dụng phụ để biến bất cứ điều gì
xảy ra.</p><p>Và Haskell có một cách để xử lý các tác dụng phụ và đó là Đơn nguyên IO.
Tuy nhiên, đừng lo lắng về phần đơn nguyên.</p><p>Đây là cách chúng tôi làm điều đó trong Haskell.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo :: IO Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo = ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>IO</code> là một phương thức khởi tạo kiểu nhận một đối số, giống như một số
ví dụ khác về các hàm tạo kiểu như <code>Maybe</code> and <code>List</code> . Tuy nhiên, không
giống như những ví dụ đó, <code>IO</code> đặc biệt, theo nghĩa là bạn không thể
triển khai nó bằng chính ngôn ngữ. Nó là một nguyên thủy được tích hợp
sẵn.</p><p>Giá trị trả về <code>IO Int</code> cho chúng ta biết rằng đây là một công thức để
tính Int và công thức này có thể gây ra các phản ứng phụ. Một danh sách
các hướng dẫn cho máy tính biết phải làm gì để kết thúc với một <code>Int</code> .</p><p>Điều quan trọng cần lưu ý là tính minh bạch của tham chiếu không bị phá
vỡ ở đây. Kết quả đánh giá foo là chính công thức, không phải giá trị
<code>Int</code> . Và vì công thức luôn giống nhau, nên tính minh bạch của tham
chiếu được duy trì.</p><p>Cách duy nhất để thực sự thực hiện một công thức như vậy trong chương
trình Haskell là từ điểm nhập chính của chương trình - hàm chính . Bạn
cũng có thể thực hiện các hành động IO trong REPL.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="hello-world"></a>Hello World<a class="hash-link" href="#hello-world" title="Direct link to heading">#</a></h3><p>Hello World in Haskell trông như thế này:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">main :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">main = putStrLn &quot;Hello, world!&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Ở đây, <code>main</code> là một công thức thực hiện một số tác dụng phụ và trả về
Đơn vị - không có gì đáng quan tâm.</p><p>Hãy xem <code>putStrLn</code> trong REPL. Chúng tôi thấy rằng đó là một hành động
IO sử dụng <code>String</code> và không trả về kết quả thú vị nào.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :t putStrLn</span></div><div class="token-line" style="color:#393A34"><span class="token plain">putStrLn :: String -&gt; IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :t putStrLn &quot;Hello, world!&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">putStrLn &quot;Hello, world!&quot; :: IO ()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi cũng có thể chạy điều này. Mở ứng dụng /Main.sh và chỉnh
sửa chức năng chính để nó đọc:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">main :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">main = putStrLn &quot;Hello, world!&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Sau đó chạy</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.bash}"><div tabindex="0" class="prism-code language-{.bash} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">cabal run hello</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng ta sẽ xem xét nhanh tệp cabal ngay bây giờ.</p><p>Trong các bài giảng trước, chúng ta chỉ cần phần thư viện <code>library</code>
trong tệp <code>plutus-pioneer-program-week04.cabal</code> vì chúng ta chỉ xử lý
các hàm thư viện. Bây giờ, chúng ta cần thêm một khổ thơ có thể thực thi
được .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.cabal}"><div tabindex="0" class="prism-code language-{.cabal} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">executable hello</span></div><div class="token-line" style="color:#393A34"><span class="token plain">hs-source-dirs:      app</span></div><div class="token-line" style="color:#393A34"><span class="token plain">main-is:             hello.hs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">build-depends:       base ^&gt;=4.14.1.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">default-language:    Haskell2010</span></div><div class="token-line" style="color:#393A34"><span class="token plain">ghc-options:         -Wall -O2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Điều này chỉ định thư mục nguồn và tệp nào giữ chức năng chính. Thông
thường tên tệp phải khớp với tên mô-đun, nhưng <code>main</code> là một ngoại lệ.</p><p>Thay vì chỉ yêu cầu loại <code>putStrLn</code> , chúng ta có thể chạy nó trong
REPL. Như đã đề cập, REPL cho phép chúng ta thực hiện các hành động IO.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; putStrLn &quot;Hello, world!&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Hello, world!</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="getline"></a>getLine<a class="hash-link" href="#getline" title="Direct link to heading">#</a></h3><p>Hãy xem <code>getLine</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :t getLine</span></div><div class="token-line" style="color:#393A34"><span class="token plain">getLine :: IO String</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Điều này cho thấy rằng đó là một công thức, có thể tạo ra các hiệu ứng
phụ, khi được thực thi sẽ tạo ra một Chuỗi . Trong trường hợp getLine ,
tác dụng phụ được đề cập là nó sẽ đợi người dùng nhập từ bàn phím.</p><p>Nếu chúng ta thực thi getLine trong REPL.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; getLine</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nó chờ nhập bàn phím. Sau đó, nếu chúng ta nhập một cái gì đó, nó sẽ trả
về kết quả.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Haskell</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;Haskell&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Có một loạt các hành động IO được định nghĩa trong Haskell để thực hiện
tất cả các loại như đọc tệp, ghi tệp, đọc từ và ghi vào ổ cắm.</p><p>Nhưng cho dù bạn có bao nhiêu hành động được xác định trước, điều đó sẽ
không bao giờ là đủ để đạt được điều gì đó phức tạp, vì vậy cần phải có
cách để kết hợp các hành động IO nguyên thủy này thành những công thức
lớn hơn, phức tạp hơn.</p><p>Một điều chúng ta có thể làm là sử dụng phiên bản kiểu <code>Functor</code> của IO.
Hãy xem xét các trường hợp loại của <code>IO</code> trong REPL.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :i IO</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type IO :: ` -&gt; `</span></div><div class="token-line" style="color:#393A34"><span class="token plain">newtype IO a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">= ghc-prim-0.6.1:GHC.Types.IO (ghc-prim-0.6.1:GHC.Prim.State#</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                 ghc-prim-0.6.1:GHC.Prim.RealWorld</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                 -&gt; (# ghc-prim-0.6.1:GHC.Prim.State#</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                       ghc-prim-0.6.1:GHC.Prim.RealWorld,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                       a #))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   -- Defined in ‘ghc-prim-0.6.1:GHC.Types’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative IO -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor IO -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad IO -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monoid a =&gt; Monoid (IO a) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Semigroup a =&gt; Semigroup (IO a) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance MonadFail IO -- Defined in ‘Control.Monad.Fail’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng ta thấy cá thể <code>Monad</code> đáng sợ , nhưng chúng ta cũng thấy một cá
thể <code>Functor</code>. <code>Functor</code> là một loại lớp rất quan trọng trong Haskell.
Nếu chúng ta nhìn vào nó trong REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :i Functor</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type Functor :: (` -&gt; `) -&gt; Constraint</span></div><div class="token-line" style="color:#393A34"><span class="token plain">class Functor f where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fmap :: (a -&gt; b) -&gt; f a -&gt; f b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(&lt;$) :: a -&gt; f b -&gt; f a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{-# MINIMAL fmap #-}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor (Either a) -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor [] -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor Maybe -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor IO -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor ((-&gt;) r) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor ((,,,) a b c) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor ((,,) a b) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor ((,) a) -- Defined in ‘GHC.Base’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Phương pháp quan trọng ở đây là fmap . Hàm thứ hai (\&lt;\$) là một hàm
tiện lợi.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">fmap :: (a -&gt; b) -&gt; f a -&gt; f b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hàm này <code>fmap</code> , mà tất cả <code>Functor</code>s có cho chúng ta biết rằng, nếu
chúng ta cấp cho nó quyền truy cập vào một hàm có thể biến <code>a</code> thàng <code>b</code>
, thì nó có thể biến fa thành fb cho chúng ta. Ở đây, chúng ta quan tâm
đến trường hợp f là IO .</p><p>Nếu chúng ta chuyên biệt hóa hàm cho <code>IO</code> , chúng ta sẽ có một hàm như:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">fmap&#x27; :: (a -&gt; b) -&gt; IO a -&gt; IO b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Làm thế nào để làm việc đó. À, <code>IO a</code> là một công thức có tác dụng phụ
và tạo ra <code>a</code> . Vì vậy, làm thế nào để chúng ta có được một <code>b</code> trong số
đó? Chúng tôi thực hiện công thức, nhưng, trước khi trả về a , chúng tôi
áp dụng hàm <code>(a -\&gt; b)</code> cho <code>a</code> và trả về kết quả là <code>b</code> .</p><p>Trong REPL, chúng ta hãy xem xét hàm <code>toUpper</code> .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; import Data.Char</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Data.Char Week04.Contract&gt; :t toUpper</span></div><div class="token-line" style="color:#393A34"><span class="token plain">toUpper :: Char -&gt; Char</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Data.Char Week04.Contract&gt; toUpper &#x27;q&#x27;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&#x27;Q&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu chúng ta muốn áp dụng được cho một chuỗi chứ không phải là một Char
chúng ta có thể sử dụng bản đồ chức năng. Các chuỗi <code>String</code>s trong
Haskell chỉ là <code>Char</code>s .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Data.Char Week04.Contract&gt; map toUpper &quot;Haskell&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;HASKELL&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hàm <code>map toUpper</code> là một hàm chuyển từ <code>String</code> to <code>String</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Data.Char Week04.Contract&gt; :t map toUpper</span></div><div class="token-line" style="color:#393A34"><span class="token plain">map toUpper :: [Char] -&gt; [Char]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Và chúng ta có thể sử dụng kết hợp với <code>fmap</code>. Nếu chúng ta sử dụng <code>map
toUpper</code> làm chức năng chuyển đổi <code>a</code> thành <code>b</code> , chúng ta có thể thấy
loại đầu ra của fmap sẽ như thế nào khi áp dụng cho <code>IO a</code> .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Data.Char Week04.Contract&gt; :t fmap (map toUpper) getLine</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fmap (map toUpper) getLine :: IO [Char]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hãy xem nó trong hành động.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Data.Char Week04.Contract&gt; fmap (map toUpper) getLine</span></div><div class="token-line" style="color:#393A34"><span class="token plain">haskell</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;HASKELL&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng ta cũng có thể sử dụng toán tử <code>\&gt;\&gt;</code> . Điều này chuỗi hai hành
động <code>IO</code> lại với nhau, bỏ qua kết quả của hành động đầu tiên. Trong ví
dụ sau, cả hai hành động sẽ được thực hiện theo trình tự.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; putStrLn &quot;Hello&quot; &gt;&gt; putStrLn &quot;World&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Hello</span></div><div class="token-line" style="color:#393A34"><span class="token plain">World</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Ở đây, không có kết quả từ <code>putStrLn</code> , nhưng nếu có, nó sẽ bị bỏ qua. Các tác dụng không mong muốn của nó sẽ được thực hiện, kết quả của nó bị bỏ qua, sau đó các tác dụng không mong muốn thứ hai của <code>putStrLn</code> sẽ được thực hiện trước khi trả về kết quả của lần gọi thứ hai.</p><p>Sau đó, có một toán tử quan trọng không bỏ qua kết quả của hành động IO đầu tiên , và đó được gọi là ràng buộc . Nó được viết dưới dạng ký hiệu <code>\&gt;\&gt;=</code> .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :t (&gt;&gt;=)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi thấy ràng buộc <code>Monad</code> , nhưng chúng tôi có thể bỏ qua điều đó ngay bây giờ và chỉ nghĩ về <code>IO</code> .</p><p>Điều này nói lên rằng nếu tôi có một công thức thực hiện các tác dụng phụ sau đó cho tôi kết quả <code>a</code> , và cho rằng tôi có một hàm nhận <code>a</code> và trả lại cho tôi một công thức trả về <code>b</code> , thì tôi có thể kết hợp công thức <code>m a</code>. với công thức mb bằng cách lấy giá trị a và sử dụng nó trong công thức thu được giá trị <code>b</code> .</p><p>Một ví dụ sẽ làm rõ điều này.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; getLine &gt;&gt;= putStrLn</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Haskell</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Haskell</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Ở đây, hàm <code>getLine</code>  có kiểu <code>IO String</code> . Giá trị trả về <code>a</code> được chuyển cho hàm <code>(a -\&gt; m b)</code> , sau đó tạo ra một công thức <code>putStrLn</code> với giá trị đầu vào là <code>a</code> và đầu ra là kiểu <code>IO ()</code> . Sau đó, <code>putStrLn</code> thực hiện các tác dụng phụ của nó và trả về <code>Unit</code> .</p><p>Có một cách khác, rất quan trọng, để tạo các hành động <code>IO</code> , và đó là tạo các công thức nấu ăn ngay lập tức trả về kết quả mà không thực hiện bất kỳ tác dụng phụ nào.</p><p>Điều đó được thực hiện với một chức năng được gọi là <code>return</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :t return</span></div><div class="token-line" style="color:#393A34"><span class="token plain">return :: Monad m =&gt; a -&gt; m a</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Một lần nữa, nó là chung cho bất kỳ Đơn nguyên (Monad) nào, chúng ta chỉ cần nghĩ về <code>IO</code> ngay bây giờ.</p><p>Nó nhận một giá trị <code>a</code> và trả về một công thức tạo ra giá trị <code>a</code> . Trong trường hợp trả lại , công thức thực sự không tạo ra bất kỳ tác dụng phụ nào.</p><p>Ví dụ:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; return &quot;Haskell&quot; :: IO String</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;Haskell&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi cần chỉ định kiểu trả về để REPL biết chúng tôi đang sử dụng <code>Monad</code> nào: </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :t return &quot;Haskell&quot; :: IO String</span></div><div class="token-line" style="color:#393A34"><span class="token plain">return &quot;Haskell&quot; :: IO String :: IO String</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :t return &quot;Haskell&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">return &quot;Haskell&quot; :: Monad m =&gt; m [Char]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu bây giờ chúng ta quay lại <code>main</code> của mình, bây giờ chúng ta có thể viết các hành động <code>IO</code>  tương đối phức tạp . Ví dụ, chúng ta có thể xác định một hành động <code>IO</code>  sẽ yêu cầu hai chuỗi và in kết quả của việc nối hai chuỗi đó với bảng điều khiển.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">main :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">main = bar</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bar :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bar = getLine &gt;&gt;= \s -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      getLine &gt;&gt;= \t -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      putStrLn (s ++ t)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Và sau đó, khi chúng tôi chạy nó, chương trình sẽ đợi hai đầu vào và sau đó xuất ra kết quả được nối.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.bash}"><div tabindex="0" class="prism-code language-{.bash} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">cabal run hello</span></div><div class="token-line" style="color:#393A34"><span class="token plain">one</span></div><div class="token-line" style="color:#393A34"><span class="token plain">two</span></div><div class="token-line" style="color:#393A34"><span class="token plain">onetwo</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ điều này là đủ cho các mục đích của chúng tôi, mặc dù chúng tôi sẽ không cần Đơn nguyên <code>IO</code> cho đến khi có lẽ sau này trong khóa học khi chúng tôi nói về việc thực sự triển khai các hợp đồng Plutus. Tuy nhiên, <code>IO</code> Monad là một ví dụ quan trọng và là một ví dụ tốt để bắt đầu.</p><p>Vì vậy, hiện tại, chúng ta hãy hoàn toàn quên <code>IO</code> và chỉ viết Haskell thuần túy, có chức năng, sử dụng kiểu <code>Maybe</code> .</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="maybe"></a>Maybe<a class="hash-link" href="#maybe" title="Direct link to heading">#</a></h3><p>Kiểu <code>Maybe</code>  là một trong những loại hữu ích nhất trong Haskell.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :i Maybe</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type Maybe :: ` -&gt; `</span></div><div class="token-line" style="color:#393A34"><span class="token plain">data Maybe a = Nothing | Just a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   -- Defined in ‘GHC.Maybe’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative Maybe -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Eq a =&gt; Eq (Maybe a) -- Defined in ‘GHC.Maybe’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor Maybe -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad Maybe -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Semigroup a =&gt; Monoid (Maybe a) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Ord a =&gt; Ord (Maybe a) -- Defined in ‘GHC.Maybe’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Semigroup a =&gt; Semigroup (Maybe a)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Show a =&gt; Show (Maybe a) -- Defined in ‘GHC.Show’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Read a =&gt; Read (Maybe a) -- Defined in ‘GHC.Read’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Foldable Maybe -- Defined in ‘Data.Foldable’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Traversable Maybe -- Defined in ‘Data.Traversable’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance MonadFail Maybe -- Defined in ‘Control.Monad.Fail’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nó thường được gọi là <code>Optional</code> trong các ngôn ngữ lập trình khác.</p><p>Nó có hai hàm tạo - <code>Nothing</code> , không nhận đối số và <code>Just</code> - có một đối số.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data Maybe a = Nothing | Just a</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hãy xem một ví dụ.</p><p>Trong Haskell, nếu bạn muốn truyền <code>String</code> đến một giá trị có thể hiện <code>read</code> , bạn sẽ thường làm điều này với hàm <code>read</code> .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Week04.Maybe&gt; read &quot;42&quot; :: Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">42</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Tuy nhiên, <code>read</code> hơi khó chịu, bởi vì nếu chúng ta có thứ gì đó không thể phân tích cú pháp thành <code>Int</code> , thì chúng ta sẽ gặp lỗi.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Week04.Maybe&gt; read &quot;42+u&quot; :: Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*** Exception: Prelude.read: no parse</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hãy import <code>readMaybe</code> để làm điều đó theo cách tốt hơn.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Maybe&gt; import Text.Read (readMaybe)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Text.Read Week04.Contract&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hàm <code>readMaybe</code> làm tương tự như <code>read</code>, nhưng nó trả về một <code>Maybe</code> và trong trường hợp nó không thể phân tích cú pháp, nó sẽ trả về một <code>Maybe</code> được tạo bằng phương thức khởi tạo <code>Nothing</code> .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Text.Read Week04.Contract&gt; readMaybe &quot;42&quot; :: Maybe Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Just 42</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Text.Read Week04.Contract&gt; readMaybe &quot;42+u&quot; :: Maybe Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Nothing</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Giả sử chúng ta muốn tạo một hàm mới trả về a <code>Maybe</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><div tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo :: String -&gt; String -&gt; String -&gt; Maybe Int</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Ý tưởng là hàm nên cố gắng phân tích cú pháp cả ba <code>Strings</code> là <code>Ints</code>. Nếu tất cả các Strings có thể được phân tích cú pháp thành công thành <code>Ints</code>, thì chúng ta muốn cộng ba <code>Ints</code> đó để có được một tổng. Nếu một trong các phân tích cú pháp không thành công, chúng tôi muốn quay lại <code>Nothing</code>.</p><p>Một cách để làm điều đó sẽ là:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo :: String -&gt; String -&gt; String -&gt; Maybe Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo x y z = case readMaybe x of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Nothing -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Just k  -&gt; case readMaybe y of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      Nothing -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      Just l  -&gt; case readMaybe z of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Nothing -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Just m  -&gt; Just (k + l + m)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hãy xem nếu nó hoạt động. Đầu tiên, trường hợp thành công:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :l Week04.Maybe </span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Maybe&gt; foo &quot;1&quot; &quot;2&quot; &quot;3&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Just 6</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Tuy nhiên, nếu một trong các giá trị không thể được phân tích cú pháp, chúng tôi nhận được <code>Nothing</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Maybe&gt; foo &quot;&quot; &quot;2&quot; &quot;3&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Nothing</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Mã này không lý tưởng vì chúng ta lặp lại cùng một mẫu ba lần. Mỗi lần chúng ta phải xem xét hai trường hợp - kết quả của phép đọc là <code>Just</code> hoặc <code>Nothing</code>.</p><p>Ask Haskellers, we hate repetition like this.</p><p>Điều chúng tôi muốn làm rất đơn giản. Chúng tôi muốn vượt qua ba <code>Strings</code> và thêm kết quả, nhưng với tất cả những trường hợp đó, nó rất ồn và rất xấu. Chúng tôi muốn loại bỏ mô hình này.</p><p>Một cách để làm điều đó là xác định một cái gì đó như:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">bindMaybe :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bindMaybe Nothing = Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bindMaybe (Just x) f = f x</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hãy viết lại cùng một chức năng bằng cách sử dụng <code>bindMaybe</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27; :: String -&gt; String -&gt; String -&gt; Maybe Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27; x y z = readMaybe x `bindMaybe` \k -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            readMaybe y `bindMaybe` \l -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            readMaybe z `bindMaybe` \m -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Just (k + l + m)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Và sau đó, trong REPL, chúng tôi nhận được kết quả tương tự <code>foo\&#x27;</code>như chúng tôi đã nhận được <code>foo</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Maybe&gt; foo &quot;1&quot; &quot;2&quot; &quot;3&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Just 6</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Maybe&gt; foo &quot;&quot; &quot;2&quot; &quot;3&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Nothing</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Điều này thực hiện chính xác như <code>foo</code>, nhưng nó nhỏ gọn hơn nhiều, ít tiếng ồn hơn và logic kinh doanh rõ ràng hơn nhiều.</p><p>Nó có thể, hoặc có thể không, giúp xem chức năng mà nó không được sử dụng với ký hiệu infix:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Text.Read Week04.Maybe&gt; bindMaybe (readMaybe &quot;42&quot; :: Maybe Int) (\x -&gt; Just x)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Just 42</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Ở đây bạn có thể thấy rõ ràng hàm lấy <code>Maybe</code> và sau đó là hàm lấy <code>a</code> từ <code>Maybe</code> và sử dụng nó làm đầu vào cho một hàm trả về một mới  <code>Maybe</code>.</p><p>Điều này tạo ra không có gì hữu ích, cho đến khi chúng tôi thêm <code>readMaybe</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Text.Read Week04.Maybe&gt; bindMaybe (readMaybe &quot;42&quot; :: Maybe Int) (\x -&gt; bindMaybe (readMaybe &quot;5&quot; :: Maybe Int) (\y -&gt; Just (y + x)))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Just 47</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Theo một số cách <code>Nothing</code> ithì hơi giống một ngoại lệ trong các ngôn ngữ khác. Nếu bất kỳ phép tính nào trả về  <code>Nothing</code>,  phần còn lại của phép tính trong khối không được thực hiện và  <code>Nothing</code> được trả về.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="một-trong-hai-either"></a>Một trong hai (Either)<a class="hash-link" href="#một-trong-hai-either" title="Direct link to heading">#</a></h3><p>Một kiểu rất hữu ích khác trong Haskell là kiểu <code>Either</code> .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :i Either</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type Either :: ` -&gt; ` -&gt; `</span></div><div class="token-line" style="color:#393A34"><span class="token plain">data Either a b = Left a | Right b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative (Either e) -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Eq a, Eq b) =&gt; Eq (Either a b)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor (Either a) -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad (Either e) -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Ord a, Ord b) =&gt; Ord (Either a b)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Semigroup (Either a b) -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Show a, Show b) =&gt; Show (Either a b)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Read a, Read b) =&gt; Read (Either a b)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Foldable (Either a) -- Defined in ‘Data.Foldable’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Traversable (Either a) -- Defined in ‘Data.Traversable’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>Either</code> nhận hai tham số <code>a</code> and <code>b</code>.  Giống như <code>Maybe</code> nó có hai hàm tạo, nhưng không giống như <code>Maybe</code> cả hai đều nhận một giá trị. Nó có thể <code>Either</code> là một <code>a</code> hoặc một là <code>b</code>. Hai hàm tạo là <code>Left</code> and <code>Right</code>.</p><p>Ví dụ:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; Left &quot;Haskell&quot; :: Either String Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Left &quot;Haskell&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>hoặc</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; Right 7 :: Either String Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Right 7</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu chúng ta xem xét phép loại suy ngoại lệ xa hơn một chút, thì một vấn đề <code>Maybe</code> là nếu chúng ta quay trở lại <code>Nothing</code>, không có thông báo lỗi. Tuy nhiên, nếu chúng ta muốn một thứ gì đó đưa ra một thông điệp, chúng ta có thể thay thế <code>Maybe</code>bằng <code>Either</code>.</p><p>Trong trường hợp đó, <code>Right</code> có thể tương ứng với <code>Just</code>và <code>Left</code> có thể tương ứng với một lỗi, như <code>Nothing</code> đã làm. Tuy nhiên, tùy thuộc vào loại mà chúng tôi chọn cho <code>a</code>, chúng tôi có thể đưa ra các thông báo lỗi thích hợp.</p><p>Hãy định nghĩa một cái gì đó được gọi <code>readEither</code> và xem nó làm gì khi có thể và khi nào nó không thể phân tích cú pháp đầu vào của nó.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">readEither :: Read a =&gt; String -&gt; Either String a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">readEither s case readMaybe s of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Nothing -&gt; Left $ &quot;can&#x27;t parse: &quot; ++ s</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Just a  -&gt; Right a</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Either&gt; readEither &quot;42&quot; :: Either String Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Right 42</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Either&gt; readEither &quot;42+u&quot; :: Either String Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Left &quot;can&#x27;t parse: 42+u&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Sử dụng điều này, bây giờ chúng ta có thể viết lại <code>foo</code> bằng <code>Either</code>. Đầu tiên, sử dụng phương pháp dài dòng:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo :: String -&gt; String -&gt; String -&gt; Either String Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo x y z = case readEither x of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Left err -&gt; Left err</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Right k  -&gt; case readEither y of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      Left err -&gt; Left err</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      Right l  -&gt; case readEither z of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Left err -&gt; Left err</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Right m  -&gt; Right (k + l + m)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hãy thử nó. Đầu tiên, đường dẫn tốt:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Either&gt; foo &quot;1&quot; &quot;2&quot; &quot;3&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Right 6</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>sau đó có vấn đề:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Either&gt; foo &quot;ays&quot; &quot;2&quot; &quot;3&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Left &quot;can&#x27;t parse: ays&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>hưng, chúng tôi có cùng một vấn đề mà chúng tôi đã gặp phải <code>Maybe</code>; chúng tôi có rất nhiều sự lặp lại.</p><p>Giải pháp cũng tương tự.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">bindEither :: Either String a -&gt; (a -&gt; Either String b) -&gt; Either String b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bindEither (Left err) _ = Left err</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bindEither (Right x)  f = f x</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27; :: String -&gt; String -&gt; String -&gt; Either String Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27; x y z = readEither x `bindEither` \k -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            readEither y `bindEither` \l -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            readEither z `bindEither` \m -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Right (k + l + m)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bạn có thể chạy lại điều này trong REPL và nó sẽ hoạt động giống như phiên bản dài dòng của nó.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="writer"></a>Writer<a class="hash-link" href="#writer" title="Direct link to heading">#</a></h3><p>Cho đến nay chúng tôi đã xem xét ba ví dụ: <code>IO a</code>, <code>Maybe a</code> và <code>Either String a</code>. <code>IO a</code> đại diện cho các kế hoạch có thể liên quan đến các tác dụng phụ và khi được thực hiện, tạo ra một <code>a</code>. <code>Maybe a</code> và <code>Either String a</code> đại diện cho các phép tính có thể tạo ra  <code>a</code> nhưng cũng có thể thất bại. Sự khác biệt giữa <code>Maybe</code> và <code>Either</code> chỉ <code>Maybe</code> không tạo ra bất kỳ thông báo lỗi nào, nhưng  <code>Either</code> thì có.</p><p>Bây giờ chúng ta hãy xem xét một ví dụ hoàn toàn khác ghi lại ý tưởng về các phép tính cũng có thể tạo ra đầu ra nhật ký.</p><p>Chúng ta có thể biểu diễn điều đó bằng một kiểu.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data Writer a = Writer a [String]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   deriving Show</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Ví dụ, hãy viết một hàm trả về  <code>Writer</code> cho  <code>Int</code> và viết một thông báo nhật ký.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">number :: Int -&gt; Writer Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">number n = Writer n $ [&quot;number: &quot; ++ show n]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Trong REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Writer&gt; number 42</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Writer 42 [&quot;number: 42&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ, chúng ta hãy làm điều gì đó tương tự như chúng ta đã làm với <code>Maybe</code>và  <code>Either</code>.</p><p>Hãy viết một hàm sử dụng ba phép tính ghi nhật ký mà mỗi phép tính tạo ra một <code>Int</code> và chúng ta muốn trả về một phép tính duy nhất tạo ra tổng của các phép tính đó <code>Int</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo :: Writer Int -&gt; Writer Int -&gt; Writer Int -&gt; Writer Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo (Writer k xs) (Writer l ys) (Writer m zs) =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Writer (K + l + m) $ xs ++ ys ++ zs</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Trong REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Writer&gt; foo (number 1) (number 2) (number 3)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Writer 6 [&quot;number: 1&quot;,&quot;number: 2&quot;,&quot;number: 3&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ, hãy viết một hàm hữu ích khác có danh sách thông báo và các nhà sản xuất một <code>Writer</code> không có kết quả hữu ích.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">tell :: [String] -&gt; Writer ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">tell = Writer ()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ, chúng tôi có thể cập nhật <code>foo</code> để thêm một thông báo nhật ký bổ sung hiển thị tổng các số.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo :: Writer Int -&gt; Writer Int -&gt; Writer Int -&gt; Writer Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo (Writer k xs) (Writer l ys) (Writer m zs) =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">let</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   s = k + l + m</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Writer _ us = tell [&quot;sum: &quot; ++ show s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">in</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Writer s $ xs ++ ys ++ zs ++ us</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>In the REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Writer&gt; foo (number 1) (number 2) (number 3)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Writer 6 [&quot;number: 1&quot;,&quot;number: 2&quot;,&quot;number: 3&quot;,&quot;sum: 6&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Như trước đây, chúng ta có thể viết một hàm ràng buộc:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">bindWriter :: Writer a -&gt; (a -&gt; Writer b) -&gt; Writer b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bindWriter (Writer a xs) f =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">let</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Writer b ys = f a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">in</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Writer b $ xs ++ ys</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Ở đây, <code>bindWriter</code> hàm được trả lại <code>Writer b</code> và sản xuất thông điệp log đó là một nối của <code>xs</code> mà chúng ta mô hình phù hợp trên đầu vào, và <code>ys</code> mà chúng ta mô hình phù hợp khi gọi <code>f a</code> để sản xuất các <code>Writer b</code> .</p><p>Bây giờ, chúng ta có thể viết lại <code>foo</code> bằng <code>bindWriter</code> và làm cho nó đẹp hơn nhiều.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27; :: Writer Int -&gt; Writer Int -&gt; Writer Int -&gt; Writer Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27; x y z = x `bindWriter` \k -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            y `bindWriter` \l -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            z `bindWriter` \m -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            let s = k + l + m</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            in tell [&quot;sum: &quot; ++ show s] `bindWriter` \_ -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">               Writer s []</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Những gì chúng tôi đã làm với <code>foo\&#x27;</code>trước đây, bây giờ chúng tôi có thể làm với foo &#x27; , và chúng tôi nhận được kết quả tương tự.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Writer&gt; foo&#x27; (number 1) (number 2) (number 3)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Writer 6 [&quot;number: 1&quot;,&quot;number: 2&quot;,&quot;number: 3&quot;,&quot;sum: 6&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Phải thừa nhận rằng nó dài hơn trước, nhưng nó đẹp hơn rất nhiều. Chúng tôi không còn cần thực hiện đối sánh mẫu để trích xuất các thông báo. Chúng tôi không cần phải kết hợp các thông báo nhật ký một cách rõ ràng, nơi chúng tôi có thể mắc lỗi và quên một hoặc sai thứ tự. Thay vào đó, chúng tôi trừu tượng hóa tất cả những thứ đó đi và chỉ có thể tập trung vào logic kinh doanh.</p><p>Mặc dù mô hình giống như với <code>Maybe</code> and <code>Either</code>, lưu ý rằng khía cạnh đặc biệt của các tính toán này là hoàn toàn khác nhau. Với <code>Maybe</code> and <code>Either</code>, chúng tôi xử lý khái niệm thất bại, trong khi ở đây, với <code>Writer</code>, không có thất bại, mà thay vào đó chúng tôi có thêm đầu ra.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="what-is-a-monad"></a>What is a Monad?<a class="hash-link" href="#what-is-a-monad" title="Direct link to heading">#</a></h3><p>Bây giờ, chúng ta có thể giải thích Monad là gì.</p><p>Nhìn lại bốn ví dụ, chúng có điểm gì chung? Trong tất cả bốn trường hợp, Chúng tôi đã có một constructor loại với một tham số kiểu -  <code>IO</code>,
<code>Maybe</code>, <code>Either String</code> and <code>Writer</code> cả phải mất một tham số kiểu.</p><p>Và, đối với tất cả bốn ví dụ này, chúng tôi có một hàm ràng buộc. Đối với <code>IO</code>, chúng tôi có <code>\&gt;\&gt;=</code> chức năng và đối với những người khác, chúng tôi có các chức năng ràng buộc mà chúng tôi tự viết. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">bindWriter :: Writer a -&gt; (a -&gt; Writer b) -&gt; Writer b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bindEither :: Either String a -&gt; (a -&gt; Either String b) -&gt; Either String b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bindMaybe :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Cách thức hoạt động của ràng buộc tùy thuộc vào từng trường hợp. Trong trường hợp của <code>IO</code> nó là phép thuật tích hợp sẵn, nhưng bạn có thể nghĩ nó chỉ là kết hợp hai kế hoạch mô tả các hành động cần thực hiện trong quá trình tính toán. Đối với <code>bindMaybe</code> và <code>bindEither</code> logic là toàn bộ kế hoạch sẽ thất bại nếu bất kỳ phần nào của nó không thành công và đối với <code>bindWriter</code>, logic là kết hợp danh sách các thông báo nhật ký.</p><p>Và đó là ý tưởng chính của Monads. Đó là một khái niệm về tính toán với một số tác dụng phụ bổ sung và khả năng liên kết hai phép tính đó lại với nhau.</p><p>Có một khía cạnh khác mà chúng tôi đã đề cập ngắn gọn trong trường hợp IO nhưng không phải đối với các ví dụ khác - một điều khác mà chúng tôi luôn có thể làm.</p><p>Bất cứ khi nào chúng ta có khái niệm tính toán với các tác dụng phụ như vậy, chúng ta cũng luôn có khả năng tạo ra một phép tính kiểu này <code>doesn\&#x27;t</code> có bất kỳ tác dụng phụ nào.</p><p>Trong ví dụ của <code>IO</code>, điều này đã được thực hiện với <code>return</code>. Với một <code>a</code>, bạn có thể tạo một <code>IO a</code> công thức luôn trả về đơn giản mà akhông có tác dụng phụ. Mỗi ví dụ khác cũng có khả năng này, như được hiển thị bên dưới.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">return              :: a -&gt; IO a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Just                :: a -&gt; Maybe a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Right               :: a -&gt; Either String a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(\a -&gt; Writer a []) :: a -&gt; Writer a</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Và chính sự kết hợp của hai đặc điểm này đã xác định một Đơn nguyên.</p><p>khả năng liên kết hai phép tính với nhau
khả năng xây dựng một phép tính từ một giá trị thuần túy mà không sử dụng bất kỳ tác dụng phụ tiềm ẩn nào
Nếu chúng ta xem trong REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :i Monad</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type Monad :: (` -&gt; `) -&gt; Constraint</span></div><div class="token-line" style="color:#393A34"><span class="token plain">class Applicative m =&gt; Monad m where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(&gt;&gt;) :: m a -&gt; m b -&gt; m b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">return :: a -&gt; m a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{-# MINIMAL (&gt;&gt;=) #-}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad (Either e) -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad [] -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad Maybe -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad IO -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad ((-&gt;) r) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Monoid a, Monoid b, Monoid c) =&gt; Monad ((,,,) a b c)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Monoid a, Monoid b) =&gt; Monad ((,,) a b)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monoid a =&gt; Monad ((,) a) -- Defined in ‘GHC.Base’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi thấy chức năng ràng buộc</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Và <code>return</code> hàm nhận một giá trị thuần túy và biến nó thành một phép tính tiềm ẩn tác dụng phụ, nhưng không sử dụng chúng.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">return :: a -&gt; m a</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The other function <code>\&gt;\&gt;</code> can easily be defined in terms of <code>\&gt;\&gt;=</code>, but
is provided for convenience.
Các chức năng khác <code>\&gt;\&gt;</code> có thể dễ dàng được xác định về mặt <code>\&gt;\&gt;=</code>, nhưng được cung cấp để thuận tiện.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(&gt;&gt;) :: m a -&gt; m b -&gt; m b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Những gì hàm này làm là loại bỏ kết quả của phép tính đầu tiên, vì vậy bạn có thể xác định nó theo nghĩa <code>\&gt;\&gt;=</code> chỉ bằng cách bỏ qua đối số của tham số hàm.</p><p>Có một tính toán kỹ thuật khác. Chúng tôi thấy rằng Monadcó siêu lớp <code>Applicative</code>, vì vậy mọi Đơn nguyên đều như vậy <code>Applicative</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :i Applicative</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type Applicative :: (` -&gt; `) -&gt; Constraint</span></div><div class="token-line" style="color:#393A34"><span class="token plain">class Functor f =&gt; Applicative f where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">pure :: a -&gt; f a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(&lt;`&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">GHC.Base.liftA2 :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(`&gt;) :: f a -&gt; f b -&gt; f b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(&lt;`) :: f a -&gt; f b -&gt; f a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{-# MINIMAL pure, ((&lt;`&gt;) | liftA2) #-}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative (Either e) -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative [] -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative Maybe -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative IO -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative ((-&gt;) r) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Monoid a, Monoid b, Monoid c) =&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">         Applicative ((,,,) a b c)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Monoid a, Monoid b) =&gt; Applicative ((,,) a b)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monoid a =&gt; Applicative ((,) a) -- Defined in ‘GHC.Base’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi thấy nó có một loạt các chức năng, nhưng chúng tôi chỉ cần hai chức năng đầu tiên.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">pure :: a -&gt; f a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(&lt;`&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hàm <code>pure</code> có cùng kiểu chữ ký với <code>return</code>. Sau đó, có <code>\&lt;\&gt;</code> (phát âm là &#x27;ap&#x27;) trông phức tạp hơn một chút. Nhưng, sự thật là, một khi bạn có returnvà <code>\&gt;\&gt;=</code> ở trong Đơn nguyên, chúng ta có thể dễ dàng xác định cả hai purevà <code>\&lt;\&gt;</code>.</p><p>Chúng tôi thấy rằng <code>Applicative</code> cũng có một lớp cha <code>Functor</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; :i Functor</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type Functor :: (` -&gt; `) -&gt; Constraint</span></div><div class="token-line" style="color:#393A34"><span class="token plain">class Functor f where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fmap :: (a -&gt; b) -&gt; f a -&gt; f b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(&lt;$) :: a -&gt; f b -&gt; f a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{-# MINIMAL fmap #-}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor (Either a) -- Defined in ‘Data.Either’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor [] -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor Maybe -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor IO -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor ((-&gt;) r) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor ((,,,) a b c) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor ((,,) a b) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor ((,) a) -- Defined in ‘GHC.Base’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Như chúng ta đã đề cập trong ngữ cảnh <code>IO</code>, <code>Functor</code> có một hàm <code>fmap</code>, được cho trước một hàm từ <code>a</code> to <code>b</code>sẽ biến một <code>f a</code> thành một <code>f b</code>.</p><p>Ví dụ nguyên mẫu cho <code>fmap</code> là danh sách ở đâu chính <code>fmap</code> là <code>fmap</code>. Cho một hàm từ <code>a</code> to <code>b</code>, bạn có thể tạo một danh sách kiểu btừ một danh sách kiểu abằng cách áp dụng maphàm cho từng phần tử của danh sách.</p><p>Một lần nữa, một khi bạn có <code>return</code> and <code>\&gt;\&gt;=</code>, thật dễ dàng để xác định <code>fmap</code>.</p><p>Vì vậy, bất cứ khi nào bạn muốn xác định Đơn nguyên, bạn chỉ cần xác định <code>return</code> và <code>\&gt;\&gt;=</code>, và để làm cho trình biên dịch hài lòng và đưa ra các thể hiện cho <code>Functor</code> and <code>Applicative</code>, luôn có một cách tiêu chuẩn để làm điều đó.</p><p>Chúng ta có thể làm điều này trong ví dụ của <code>Writer</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import Control.Monad</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Functor Writer where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   fmap = liftM</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Applicative Writer where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   pure = return</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (&lt;`&gt;) = ap</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monad Writer where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   return a = Writer a []</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (&gt;&gt;=) = bindWriter</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng ta không cần phải làm như vậy đối với <code>Maybe</code>, <code>Either</code> or <code>IO</code> vì chúng đã là Đơn nguyên được xác định bởi Khúc dạo đầu.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="tại-sao-điều-này-hữu-ích"></a>Tại sao điều này hữu ích?<a class="hash-link" href="#tại-sao-điều-này-hữu-ích" title="Direct link to heading">#</a></h3><p>Nói chung, nó luôn hữu ích để xác định một mẫu chung và đặt tên cho nó.</p><p>Nhưng, có lẽ lợi thế quan trọng nhất là có rất nhiều chức năng không quan tâm đến Đơn vị nào mà chúng ta đang xử lý - chúng sẽ hoạt động với tất cả Đơn vị.</p><p>Hãy tổng quát hóa ví dụ nơi chúng ta tính tổng của ba số nguyên. Chúng tôi sử dụng một <code>let</code> trong ví dụ bên dưới vì những lý do sẽ trở nên rõ ràng trong giây lát.`</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">threeInts :: Monad m =&gt; m Int -&gt; m Int -&gt; m Int -&gt; m Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">threeInts mx my mz =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   mx &gt;&gt;= \k -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   my &gt;&gt;= \l -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   mz &gt;&gt;= \m -&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   let s = k + l + m in return s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ chúng ta có chức năng này, chúng ta có thể quay lại <code>Maybe</code> ví dụ và viết lại nó.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27;&#x27; :: String -&gt; String -&gt; String -&gt; Maybe Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27;&#x27; x y z = threeInts (readMaybe x) (readMaybe y) (readMaybe z)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng ta có thể làm tương tự cho <code>Either</code> ví dụ. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27;&#x27; :: String -&gt; String -&gt; String -&gt; Either String Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27;&#x27; x y z = threeInts (readEither x) (readEither y) (readEither z)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Các <code>Writer</code>  ví dụ không phải là giống hệt nhau.</p><p>Nếu chúng tôi không hài lòng khi không có thông báo nhật ký cho tổng, nó rất đơn giản vì nó đã là một ví dụ của</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27;&#x27; :: Writer Int -&gt; Writer Int -&gt; Writer Int -&gt; Writer Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27;&#x27; x y z = threeInts</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Tuy nhiên, nếu chúng ta muốn thông báo nhật ký cuối cùng, nó sẽ trở nên phức tạp hơn một chút.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27;&#x27; :: Writer Int -&gt; Writer Int -&gt; Writer Int -&gt; Writer Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">foo&#x27;&#x27; x y z = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   s &lt;- threeInts x y z</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   tell [&quot;sum: &quot; ++ show s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   return s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu bạn nhìn vào mô-đun Control.Monad trong Haskell Prelude tiêu chuẩn, bạn sẽ thấy rằng có rất nhiều chức năng hữu ích mà bạn có thể sử dụng cho tất cả các Đơn nguyên.</p><p>Một cách để nghĩ về Đơn nguyên là tính toán với một siêu năng lực.</p><p>Trong trường hợp của <code>IO</code>, siêu sức mạnh sẽ có tác dụng phụ trong thế giới thực. Trong trường hợp của <code>Maybe</code>, siêu sức mạnh có thể bị hỏng. Sức mạnh siêu việt của <code>Either</code>là không thành công với một thông báo lỗi. Và trong trường hợp của <code>Writer</code>, siêu sức mạnh là ghi lại các tin nhắn.</p><p>Có một câu nói trong cộng đồng Haskell rằng Haskell có dấu chấm phẩy quá tải. Giải thích cho điều này là trong nhiều ngôn ngữ lập trình mệnh lệnh, bạn có dấu chấm phẩy kết thúc bằng dấu chấm phẩy - mỗi câu lệnh được thực thi lần lượt, mỗi câu cách nhau bằng dấu chấm phẩy. Nhưng, chính xác dấu chấm phẩy có nghĩa là gì phụ thuộc vào ngôn ngữ. Ví dụ, có thể có một ngoại lệ, trong trường hợp đó, quá trình tính toán sẽ dừng lại và không tiếp tục với các dòng tiếp theo.</p><p>Theo một nghĩa nào đó, <code>bind</code> giống như dấu chấm phẩy. Và điều thú vị về Haskell là nó là một dấu chấm phẩy có thể lập trình được. Chúng ta có thể nói logic là gì để kết hợp hai phép tính với nhau.</p><p>Mỗi Đơn nguyên đi kèm với &quot;dấu chấm phẩy&quot; riêng.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="ký-hiệu-do"></a>ký hiệu \&#x27;do\&#x27;<a class="hash-link" href="#ký-hiệu-do" title="Direct link to heading">#</a></h3><p>Bởi vì mô hình này rất phổ biến và các phép tính đơn lẻ ở khắp nơi, có một ký hiệu đặc biệt cho điều này trong Haskell, được gọi là ký hiệu <code>do </code>.</p><p>Nó là đường cú pháp. Hãy viết lại <code>threeInts</code> sbằng cách sử dụng ký hiệu<code>do</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">threeInts&#x27; :: Monad m =&gt; m Int -&gt; m Int -&gt; m Int -&gt; m Int</span></div><div class="token-line" style="color:#393A34"><span class="token plain">threeInts&#x27; mx my mz = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   k &lt;- mx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   l &lt;- my</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   m &lt;- mz</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   let s = k + l + m</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   return s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Điều này thực hiện chính xác những điều tương tự như <code>non-do</code> phiên bản, nhưng nó có ít tiếng ồn hơn.</p><p>Lưu ý rằng <code>let</code> câu lệnh không sử dụng một <code>in</code> phần. Nó không cần phải bên trong một khối <code>do</code>.</p><p>Và đó là <code>Monads</code>. Còn rất nhiều điều để nói về chúng nhưng hy vọng bây giờ bạn đã biết được <code>Monads</code> là gì và chúng hoạt động như thế nào.</p><p>Thường thì bạn ở trong một tình huống mà bạn muốn có nhiều hiệu ứng cùng một lúc - ví dụ, bạn có thể muốn andthông báo nhật ký lỗi tùy chọn . Có nhiều cách để làm điều đó trong Haskell. Ví dụ, có Monad Transformers nơi về cơ bản người ta có thể xây dựng các Monad tùy chỉnh với các tính năng mà bạn muốn.</p><p>Có những cách tiếp cận khác. Một được gọi là Hệ thống Hiệu ứng, có mục tiêu tương tự. Và đây tình cờ là thứ mà Plutus sử dụng cho các Môn phái quan trọng. Đặc biệt là Đơn vị liên hệ trong ví và Đơn vị theo dõi được sử dụng để kiểm tra mã Plutus.</p><p>Tin tốt là bạn không cần phải hiểu Hệ thống Hiệu ứng để làm việc với các Đơn nguyên này. Bạn chỉ cần biết rằng bạn đang làm việc với Monad, và nó có siêu năng lực nào.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="plutus-monads"></a>Plutus Monads<a class="hash-link" href="#plutus-monads" title="Direct link to heading">#</a></h2><p>Bây giờ chúng ta đã thấy cách viết mã đơn nguyên, bằng cách sử dụng ràng buộc và trả về hoặc bằng cách sử dụng ký hiệu, chúng ta có thể xem một Đơn nguyên rất quan trọng, đó là Đơn nguyên hợp đồng, mà bạn có thể đã nhận thấy trong các ví dụ mã trước đó.</p><p>Đơn nguyên hợp đồng xác định mã sẽ chạy trong ví, đây là phần ngoài chuỗi của Plutus.</p><p>Tuy nhiên, trước khi đi vào chi tiết, chúng ta sẽ nói về Đơn nguyên thứ hai, Đơn nguyên EmulatorTrace.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="the-emulatortrace-monad"></a>The EmulatorTrace Monad<a class="hash-link" href="#the-emulatortrace-monad" title="Direct link to heading">#</a></h3><p>Bạn có thể đã tự hỏi liệu có cách nào để thực thi mã Plutus cho mục đích thử nghiệm mà không cần sử dụng Sân chơi Plutus hay không. Thực sự là có, và điều này được thực hiện bằng cách sử dụng <code>EmulatorTrace Monad</code>.</p><p>Bạn có thể nghĩ về một chương trình trong đơn nguyên này giống như những gì chúng tôi thực hiện thủ công trong <code>simulator</code> tab của sân chơi. Nghĩa là, chúng tôi xác định các điều kiện ban đầu, chúng tôi xác định các hành động chẳng hạn như ví nào gọi điểm cuối nào với các tham số nào và chúng tôi xác định khoảng thời gian chờ giữa các hành động.</p><p>Các định nghĩa liên quan nằm trong gói <code>plutus-contract</code> trong mô-đun <code>Plutus.Trace.Emulator</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">module Plutus.Trace.Emulator</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chức năng cơ bản nhất được gọi <code>runEmulatorTrace</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">-- | Run an emulator trace to completion, returning a tuple of the final state</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- of the emulator, the events, and any error, if any.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">runEmulatorTrace</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :: EmulatorConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    -&gt; EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    -&gt; ([EmulatorEvent], Maybe EmulatorErr, EmulatorState)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">runEmulatorTrace cfg trace =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (\(xs :&gt; (y, z)) -&gt; (xs, y, z))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $ run</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $ runReader ((initialDist . _initialChainState) cfg)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $ foldEmulatorStreamM (generalize list)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $ runEmulatorStream cfg trace</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nó nhận được một thứ gọi là một <code>EmulatorConfig</code> và <code>EmulatorTrace ()</code>, là một phép tính thuần túy mà không có tác dụng phụ trong thế giới thực. Nó là một chức năng thuần túy thực hiện theo dõi trên một blockchain được mô phỏng, sau đó đưa ra kết quả là một danh sách các <code>EmulatorState</code>, có thể là lỗi, nếu có, và cuối cùng là kết quả cuối cùng <code>EmulatorState</code>.</p><p><code>EmulatorConfig</code> được định nghĩa trong một mô-đun khác trong cùng một gói:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">module Wallet.Emulator.Stream</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">data EmulatorConfig =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">EmulatorConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    { _initialChainState      :: InitialChainState -- ^ State of the blockchain at the beginning of the simulation. Can be given as a map of funds to wallets, or as a block of transactions.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    } deriving (Eq, Show)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type InitialChainState = Either InitialDistribution Block</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi thấy nó chỉ có một trường, thuộc loại <code>InitialChainState</code> và nó là<code>InitialDistribution</code> hoặc <code>Block</code>.</p><p><code>InitialDistribution</code> được định nghĩa trong một mô-đun khác trong cùng một gói và nó là một từ đồng nghĩa kiểu cho một bản đồ các cặp giá trị khóa từ  <code>Wallet</code>s dến <code>Value</code>s, như bạn mong đợi. <code>Value</code> có thể là mã thông báo đáng yêu hoặc mã nguồn gốc.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">module Plutus.Contract.Trace</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type InitialDistribution = Map Wallet Value</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Trong cùng một mô-đun, chúng ta thấy một thứ được gọi là <code>defaultDist</code> nó trả về phân phối mặc định cho tất cả các ví. Nó làm điều này bằng cách đi qua 10 ví xác định bởi <code>allWallets</code> để <code>defaultDistFor</code> mà phải mang một danh sách các ví.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">-- | The wallets used in mockchain simulations by default. There are</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--   ten wallets because the emulator comes with ten private keys.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">allWallets :: [EM.Wallet]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">allWallets = EM.Wallet &lt;$&gt; [1 .. 10]</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">defaultDist :: InitialDistribution</span></div><div class="token-line" style="color:#393A34"><span class="token plain">defaultDist = defaultDistFor allWallets</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">defaultDistFor :: [EM.Wallet] -&gt; InitialDistribution</span></div><div class="token-line" style="color:#393A34"><span class="token plain">defaultDistFor wallets = Map.fromList $ zip wallets (repeat (Ada.lovelaceValueOf 100_000_000))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi có thể thử điều này trong REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week04.Contract&gt; import Plutus.Trace.Emulator</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Week04.Contract&gt; import Plutus.Contract.Trace</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Week04.Contract&gt; defaultDist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fromList [(Wallet 1,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 2,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 3,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 4,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 5,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 6,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 7,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 8,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 9,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 10,Value (Map [(,Map [(&quot;&quot;,100000000)])]))]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng ta có thể thấy rằng mỗi ví trong số 10 ví đã được phân phối ban đầu là 100.000.000 lovelace.</p><p>Chúng tôi cũng có thể lấy số dư cho một ví cụ thể hoặc các ví:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Week04.Contract&gt; defaultDistFor [Wallet 1]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fromList [(Wallet 1,Value (Map [(,Map [(&quot;&quot;,100000000)])]))]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu bạn muốn các giá trị ban đầu khác nhau, nếu bạn muốn mã thông báo gốc, thì bạn phải chỉ định giá trị đó theo cách thủ công.</p><p>Hãy xem những gì chúng ta cần để chạy dấu vết đầu tiên của mình:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Week04.Contract&gt; :t runEmulatorTrace</span></div><div class="token-line" style="color:#393A34"><span class="token plain">runEmulatorTrace</span></div><div class="token-line" style="color:#393A34"><span class="token plain">:: EmulatorConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-&gt; EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-&gt; ([Wallet.Emulator.MultiAgent.EmulatorEvent], Maybe EmulatorErr,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      Wallet.Emulator.MultiAgent.EmulatorState)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p> vậy, chúng ta cần một <code>EmulatorConfig</code> cái mà chúng ta biết cần một cái <code>InitialChainState</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Week04.Contract&gt; import Wallet.Emulator.Stream </span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator.Stream Week04.Contract&gt; :i InitialChainState </span></div><div class="token-line" style="color:#393A34"><span class="token plain">type InitialChainState :: `</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type InitialChainState =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Either InitialDistribution Ledger.Blockchain.Block</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      -- Defined in ‘Wallet.Emulator.Stream’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu chúng ta thực hiện <code>Left</code> của <code>defaultDist</code> chúc sẽ nhận được một
<code>InitialDistribution</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator.Stream Week04.Contract&gt; :t Left defaultDist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Left defaultDist :: Either InitialDistribution b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Sau đó, chúng ta có thể sử dụng để tạo một <code>EmulatorConfig</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator.Stream Week04.Contract&gt; EmulatorConfig $ Left defaultDist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">EmulatorConfig {_initialChainState = Left (fromList [(Wallet 1,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 2,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 3,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 4,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 5,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 6,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 7,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 8,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 9,Value (Map [(,Map [(&quot;&quot;,100000000)])])),(Wallet 10,Value (Map [(,Map [(&quot;&quot;,100000000)])]))])}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Vì vậy, chúng ta hãy thử <code>runEmulatorTrace</code>. Nhớ lại rằng, cũng như và<code>EmulatorConfig</code>, chúng ta cũng cần chuyển vào một <code>EmulatorTrace</code>và cái đơn giản nhất mà chúng ta có thể tạo chỉ đơn giản là một cái trả về Unit - <code>return ()</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">runEmulatorTrace (EmulatorConfig $ Left defaultDist) $ return ()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu bạn chạy điều này trong REPL, bạn sẽ nhận được một lượng lớn dữ liệu xuất ra bảng điều khiển, mặc dù chúng tôi không làm gì với dấu vết. Nếu bạn muốn làm cho nó trở nên hữu ích, bằng cách nào đó, bạn phải lọc tất cả dữ liệu này thành một thứ hợp lý và tổng hợp nó theo một cách nào đó.</p><p>May mắn thay, có những chức năng khác <code>runEmulatorTrace</code>. Một trong số đó là <code>runEmulatorTraceIo</code> chạy mô phỏng sau đó xuất ra ở dạng đẹp trên màn hình.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">runEmulatorTraceIO</span></div><div class="token-line" style="color:#393A34"><span class="token plain">:: EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-&gt; IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">runEmulatorTraceIO = runEmulatorTraceIO&#x27; def def</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Để sử dụng hàm này, chúng ta không cần chỉ định <code>EmulatorConfig</code> như chúng ta đã làm trước đây, vì theo mặc định sẽ chỉ sử dụng phân phối mặc định.</p><p>Trong REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude...&gt; runEmulatorTraceIO $ return ()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.}"><div tabindex="0" class="prism-code language-{.} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: TxnValidate af5e6d25b5ecb26185289a03d50786b7ac4425b21849143ed7e18bcd70dc4db8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: SlotAdd Slot 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: SlotAdd Slot 2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Final balances</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 1: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 2: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 3: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 4: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 5: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 6: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 7: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 8: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 9: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 10: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>And we see a much more manageable, concise output. Nothing happens, but
we see the Genesis transaction and then the final balances for each
wallet.</p><p>If you want more control, there is also <code>runEmulatorTraceIO\&#x27;</code>, which
does take an <code>EmulatorConfig</code>, so we could specify a different
distribution.
Và chúng tôi thấy một đầu ra ngắn gọn, dễ quản lý hơn nhiều. Không có gì xảy ra, nhưng chúng tôi thấy giao dịch Genesis và sau đó là số dư cuối cùng cho mỗi ví.</p><p>Nếu bạn muốn kiểm soát nhiều hơn, thì cũng có <code>runEmulatorTraceIO\&#x27;</code>, điều này có nghĩa là <code>EmulatorConfig</code>, vì vậy chúng tôi có thể chỉ định một phân phối khác.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">runEmulatorTraceIO&#x27;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">:: TraceConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-&gt; EmulatorConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-&gt; EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-&gt; IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">runEmulatorTraceIO&#x27; tcfg cfg trace</span></div><div class="token-line" style="color:#393A34"><span class="token plain">= runPrintEffect (outputHandle tcfg) $ runEmulatorTraceEff tcfg cfg trace</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nó cũng có một  <code>TraceConfig</code>, có hai trường.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data TraceConfig = TraceConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{ showEvent    :: EmulatorEvent&#x27; -&gt; Maybe String</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- ^ Function to decide how to print the particular events.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">, outputHandle :: Handle</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- ^ Where to print the outputs to. Default: &#x27;System.IO.stdout&#x27;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The first field, <code>showEvent</code> is a function that specifies which
<code>EmulatorEvent</code>s are displayed and how they are displayed. It takes an
<code>EmulatorEvent</code> as an argument and can return <code>Nothing</code> it the event
should not be displayed, or a <code>Just</code> with a <code>String</code> showing how the
event will be displayed.</p><p>Here is the default <code>TraceConfig</code> used by <code>runEmulatorTraceIO</code>. We can
see that most events are ignored and that we only get output for some of
the events.
Trường đầu tiên, <code>showEvent</code> là một hàm chỉ định cái mà các <code>EmulatorEvent</code>s được hiển thị và cách chúng được hiển thị. Nó nhận một <code>EmulatorEvent</code> đối số như một đối số và có thể trả về <code>Nothing </code> nó nếu sự kiện sẽ không được hiển thị hoặc một <code>Just</code> với một <code>String</code> cách hiển thị sự kiện sẽ được hiển thị.</p><p>Đây là mặc định <code>TraceConfig</code> được sử dụng bởi <code>runEmulatorTraceIO</code>. Chúng ta có thể thấy rằng hầu hết các sự kiện đều bị bỏ qua và chúng ta chỉ nhận được kết quả cho một số sự kiện.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">instance Default TraceConfig where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">def = TraceConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            { showEvent     = defaultShowEvent</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            , outputHandle  = stdout</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">defaultShowEvent :: EmulatorEvent&#x27; -&gt; Maybe String</span></div><div class="token-line" style="color:#393A34"><span class="token plain">defaultShowEvent = \case</span></div><div class="token-line" style="color:#393A34"><span class="token plain">UserThreadEvent (UserLog msg)                                        -&gt; Just $ &quot;*** USER LOG: &quot; &lt;&gt; msg</span></div><div class="token-line" style="color:#393A34"><span class="token plain">InstanceEvent (ContractInstanceLog (ContractLog (A.String msg)) _ _) -&gt; Just $ &quot;*** CONTRACT LOG: &quot; &lt;&gt; show msg</span></div><div class="token-line" style="color:#393A34"><span class="token plain">InstanceEvent (ContractInstanceLog (StoppedWithError err)       _ _) -&gt; Just $ &quot;*** CONTRACT STOPPED WITH ERROR: &quot; &lt;&gt; show err</span></div><div class="token-line" style="color:#393A34"><span class="token plain">InstanceEvent (ContractInstanceLog NoRequestsHandled            _ _) -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">InstanceEvent (ContractInstanceLog (HandledRequest _)           _ _) -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">InstanceEvent (ContractInstanceLog (CurrentRequests _)          _ _) -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">SchedulerEvent _                                                     -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">ChainIndexEvent _ _                                                  -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">WalletEvent _ _                                                      -&gt; Nothing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">ev                                                                   -&gt; Just . renderString . layoutPretty defaultLayoutOptions . pretty $ ev</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Trường thứ hai là một xử lý được đặt mặc định <code>stdout</code>, nhưng chúng tôi cũng có thể chỉ định một tệp ở đây.</p><p>Bây giờ chúng ta hãy xem xét một dấu vết thú vị hơn, sử dụng <code>Vesting</code> hợp đồng từ bài giảng trước.</p><p>Đầu tiên, chúng tôi xác định một <code>Trace</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myTrace :: EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myTrace = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">h1 &lt;- activateContractWallet (Wallet 1) endpoints</span></div><div class="token-line" style="color:#393A34"><span class="token plain">h2 &lt;- activateContractWallet (Wallet 2) endpoints</span></div><div class="token-line" style="color:#393A34"><span class="token plain">callEndpoint @&quot;give&quot; h1 $ GiveParams</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      { gpBeneficiary = pubKeyHash $ walletPubKey $ Wallet 2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      , gpDeadline    = Slot 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      , gpAmount      = 1000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">void $ waitUntilSlot 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">callEndpoint @&quot;grab&quot; h2 ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">void $ waitNSlots 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Điều đầu tiên chúng ta phải làm là kích hoạt ví bằng cách sử dụng chức năng đơn nguyên <code>activateContractWallet</code>. Chúng ta liên kết kết quả của hàm này với <code>h1</code>, và sau đó liên kết kết quả của cuộc gọi thứ hai (đối với Wallet 2) với <code>h2</code>. Hai giá trị đó - <code>h1</code>và <code>h2</code>được xử lý đối với ví tương ứng của chúng.</p><p>Tiếp theo, chúng tôi sử dụng <code>callEndpoint</code> để mô phỏng Ví 1 gọi <code>give</code> điểm cuối, với các thông số được hiển thị. Sau đó, chúng tôi chờ đợi đến vị trí 20. Hàm <code>waitUntilSlot</code> thực sự trả về một giá trị đại diện cho vị trí đã đạt đến, nhưng vì chúng tôi không quan tâm đến giá trị đó ở đây, chúng tôi sử dụng <code>void</code> để bỏ qua nó. Sau đó, chúng tôi mô phỏng cuộc gọi đến <code>grab</code> điểm cuối bằng Ví 2.</p><p>Bây giờ, chúng ta có thể viết một hàm để gọi <code>runEmulatorTraceIO</code> với out <code>Trace</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">test :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test = runEmulatorTraceIO myTrace</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Và, sau đó chúng ta có thể chạy điều này trong REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator Week04.Trace Wallet.Emulator.Stream Week04.Contract&gt; test</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.}"><div tabindex="0" class="prism-code language-{.} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: TxnValidate af5e6d25b5ecb26185289a03d50786b7ac4425b21849143ed7e18bcd70dc4db8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: SlotAdd Slot 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Contract instance started</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000001 {Contract instance for wallet 2}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Contract instance started</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Receive endpoint call: Object (fromList [(&quot;tag&quot;,String &quot;give&quot;),(&quot;value&quot;,Object (fromList [(&quot;unEndpointValue&quot;,Object (fromList [(&quot;gpAmount&quot;,Number 1000.0),(&quot;gpBeneficiary&quot;,Object (fromList [(&quot;getPubKeyHash&quot;,String &quot;39f713d0a644253f04529421b9f51b9b08979d08295959c4f3990ee617f5139f&quot;)])),(&quot;gpDeadline&quot;,Object (fromList [(&quot;getSlot&quot;,Number 20.0)]))]))]))])</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: W1: TxSubmit: 49f326a21c09ba52eddee46b65bdb5fb33b3444745e9af1510a68f9043696eba</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: TxnValidate 49f326a21c09ba52eddee46b65bdb5fb33b3444745e9af1510a68f9043696eba</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: SlotAdd Slot 2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00002: *** CONTRACT LOG: &quot;made a gift of 1000 lovelace to 39f713d0a644253f04529421b9f51b9b08979d08295959c4f3990ee617f5139f with deadline Slot {getSlot = 20}&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00002: SlotAdd Slot 3</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00003: SlotAdd Slot 4</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00004: SlotAdd Slot 5</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00005: SlotAdd Slot 6</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00006: SlotAdd Slot 7</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00007: SlotAdd Slot 8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00008: SlotAdd Slot 9</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00009: SlotAdd Slot 10</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00010: SlotAdd Slot 11</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00011: SlotAdd Slot 12</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00012: SlotAdd Slot 13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00013: SlotAdd Slot 14</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00014: SlotAdd Slot 15</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00015: SlotAdd Slot 16</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00016: SlotAdd Slot 17</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00017: SlotAdd Slot 18</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00018: SlotAdd Slot 19</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00019: SlotAdd Slot 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00020: 00000000-0000-4000-8000-000000000001 {Contract instance for wallet 2}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Receive endpoint call: Object (fromList [(&quot;tag&quot;,String &quot;grab&quot;),(&quot;value&quot;,Object (fromList [(&quot;unEndpointValue&quot;,Array [])]))])</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00020: W2: TxSubmit: d9a2028384b4472242371f27cb51727f5c7c04327972e4278d1f69f606019a8b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00020: TxnValidate d9a2028384b4472242371f27cb51727f5c7c04327972e4278d1f69f606019a8b</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00020: SlotAdd Slot 21</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00021: *** CONTRACT LOG: &quot;collected gifts&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00021: SlotAdd Slot 22</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Final balances</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 1: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 99998990</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 2: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000990</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 3: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 4: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 5: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 6: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 7: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 8: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 9: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 10: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Đầu ra này rất giống với đầu ra mà chúng ta thấy trong playground. Chúng ta có thể thấy giao dịch Genesis cũng như cả giao dịch <code>give</code>và <code>grab</code> giao dịch từ <code>Trace</code>. Chúng ta cũng có thể thấy một số đầu ra nhật ký từ chính hợp đồng, có tiền tố là <code>CONTRACT LOG</code>.</p><p>Chúng tôi cũng có thể đăng nhập từ bên trong <code>Trace</code> đơn nguyên. Ví dụ, chúng tôi có thể xem kết quả của <code>waitNSlots</code> cuộc gọi cuối cùng :</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myTrace :: EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myTrace = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">s &lt;- waitNSlots 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Extras.logInfo $ &quot;reached slot &quot; ++ show s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Sau đó, chúng tôi sẽ thấy kết quả này khi chúng tôi chạy mô phỏng:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.}"><div tabindex="0" class="prism-code language-{.} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00020: SlotAdd Slot 21</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00021: *** USER LOG: reached slot Slot {getSlot = 21}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00021: *** CONTRACT LOG: &quot;collected gifts&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00021: SlotAdd Slot 22</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ chúng ta hãy nhìn vào Contract Monad.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="the-contract-monad"></a>The Contract Monad<a class="hash-link" href="#the-contract-monad" title="Direct link to heading">#</a></h3><p>Mục đích của Đơn nguyên hợp đồng là xác định mã ngoài chuỗi chạy trong ví. Nó có bốn tham số kiểu:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">newtype Contract w s e a = Contract { unContract :: Eff (ContractEffs w s e) a }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      deriving newtype (Functor, Applicative, Monad)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>a</code> như trong mọi Đơn nguyên - nó biểu thị kiểu kết quả của phép tính.</p><p>Chúng ta sẽ đi vào chi tiết hơn ba phần khác sau nhưng chỉ ngắn gọn:</p><ul><li>w giống như ví dụ đơn nguyên <code>Writer</code> của chúng tôi, nó cho phép chúng tôi viết các thông báo kiểu nhật ký <code>w</code>.</li><li>s mô tả các khả năng của blockchain, ví dụ như đợi một vị trí, gửi giao dịch, lấy khóa công khai của ví. Nó cũng có thể chứa các điểm cuối cụ thể.</li><li>e mô tả loại thông báo lỗi mà đơn nguyên này có thể ném ra.
Hãy viết một ví dụ.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myContract1 :: Contract () BlockchainActions Text ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myContract1 = Contract.logInfo @String &quot;Hello from the contract!&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Ở đây , Chung tôi đưa <code>Contract</code> xây dựng với <code>Unit</code> như là kiểu <code>w</code>và <code>BlockchainActions</code> như là đối số thứ 2 <code>s</code>. Điều này cho phép chúng tôi truy cập vào tất cả các hành động của blockchain - điều duy nhất chúng tôi không thể làm là gọi các điểm cuối cụ thể.</p><p>Đối với <code>e</code> - loại thông báo lỗi, Chúng tôi sử dụng <code>Text</code>. <code>Text</code> trong Haskell được sử dụng như là <code>String</code>, nhưng nó hiệu quả hơn nhiều</p><p>Chúng tôi không muốn một kết quả cụ thể, vì vậy chúng tôi sử dụng <code>Unit</code> thay cho  <code>a</code>.</p><p>Đối với phần thân hàm, chúng tôi viết một thông báo nhật ký. Chúng tôi sử dụng <code>\@String</code>. bởi vì, chúng tôi đã imported kiể <code>Data.Text</code> Và sử dụng <code>OverloadedStrings</code> trong GHC biên dịch, vì vậy trình biên dịch cần biết loại mà chúng tôi đang tham chiếu - một <code>Text</code> hoặc một <code>String</code>. Chung tôi có thể sử dụng<code>\@String</code> Nếu chúng tôi sử dụng tùy biến biên dichij <code>TypeApplications</code>.</p><p>Bây giờ chung ta định nghĩa <code>Trace</code> bắt đầu chạy hợp đồng trong ví và hàm <code>test</code> để chạy nó.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myTrace1 :: EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myTrace1 = void $ activateContractWallet (Wallet 1) myContract1</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test1 :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test1 = runEmulatorTraceIO myTrace1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu chúng tôi chạy điều này trong REPL, chúng tôi sẽ thấy thông báo nhật ký của chúng tôi từ hợp đồng..</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.Prelude"><div tabindex="0" class="prism-code language-{.Prelude codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: TxnValidate af5e6d25b5ecb26185289a03d50786b7ac4425b21849143ed7e18bcd70dc4db8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: SlotAdd Slot 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Contract instance started</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: *** CONTRACT LOG: \&quot;Hello from the contract!\&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Contract instance stopped (no errors)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: SlotAdd Slot 2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Final balances</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 1: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 2: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 3: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 4: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 5: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 6: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 7: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 8: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 9: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 10: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, \&quot;\&quot;}: 100000000}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ, hãy xém một ngoại lệ.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myContract1 :: Contract () BlockchainActions Text ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myContract1 = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">void $ Contract.throwError &quot;BOOM!&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Contract.logInfo @String &quot;Hello from the contract!&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nhớ lại rằng chúng tôi đã chọn loại <code>Text</code> làm thông báo lỗi. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.}"><div tabindex="0" class="prism-code language-{.} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator Week04.Trace Wallet.Emulator.Stream Week04.Contract&gt; test1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: TxnValidate af5e6d25b5ecb26185289a03d50786b7ac4425b21849143ed7e18bcd70dc4db8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: SlotAdd Slot 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Contract instance started</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: *** CONTRACT STOPPED WITH ERROR: &quot;\&quot;BOOM!\&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: SlotAdd Slot 2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Final balances</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 1: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 2: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 3: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 4: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 5: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 6: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 7: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 8: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 9: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 10: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Bây giờ, chúng tôi không nhận được thông báo nhật ký, nhưng chúng tôi được thông báo rằng hợp đồng đã dừng do lỗi và chúng tôi thấy thông báo ngoại lệ của mình.</p><p>Một điều khác bạn có thể làm là xử lý các trường hợp ngoại lệ. Chúng tôi sẽ sử dụng hàm <code>handleError</code> từ mô-đun<code>Plutus.Contract.Types</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">handleError ::</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      forall w s e e&#x27; a.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (e -&gt; Contract w s e&#x27; a)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      -&gt; Contract w s e a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      -&gt; Contract w s e&#x27; a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">handleError f (Contract c) = Contract c&#x27; where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      c&#x27; = E.handleError @e (raiseUnderN @&#x27;[E.Error e&#x27;] c) (fmap unContract f)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Các hàm <code>handleError</code> và hàm <code>Contract</code> xử lý lỗi . TTrình xử lý lỗi nhận một đối số kiểu <code>e</code> từ hợp đồng của chúng tôi và trả về một đối số mới  <code>Contract</code> như một tham số thứ nhất, nhưng chúng ta có thể thay đổi kiểu của <code>e</code>  - kiểu lỗi, được thể hiện trong danh sách đối số <code>Contract</code> như là <code>e\&#x27;</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myContract2 :: Contract () BlockchainActions Void ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myContract2 = Contract.handleError</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (\err -&gt; Contract.logError $ &quot;Caught error: &quot; ++ unpack err)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      myContract1</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myTrace2 :: EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myTrace2 = void $ activateContractWallet (Wallet 1) myContract2</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test2 :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test2 = runEmulatorTraceIO myTrace2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi sử dụng loại <code>Void</code> làm loại lỗi. <code>Void</code> là một loại không có giá trị, vì vậy, bằng cách sử dụng loại này, chúng tôi muốn nói rằng không thể có bất kỳ sai sót nào đối với hợp đồng này.</p><p><em>Chú ý</em></p><p>Hàm <code>unpack</code> được định nghĩa trong module <code>Data.Text</code>. nó chuyển đổi một giá trị kiểu <code>Text</code> thành giá trị kiểu <code>String</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.}"><div tabindex="0" class="prism-code language-{.} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator Week04.Trace Wallet.Emulator.Stream Week04.Contract&gt; test2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: TxnValidate af5e6d25b5ecb26185289a03d50786b7ac4425b21849143ed7e18bcd70dc4db8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: SlotAdd Slot 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Contract instance started</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: *** CONTRACT LOG: &quot;Caught error: BOOM!&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Contract instance stopped (no errors)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: SlotAdd Slot 2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Final balances</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chúng tôi không còn nhận được thông báo lỗi nữa, nhưng thay vào đó chúng tôi nhận được thông báo từ trình xử lý lỗi hiển thị ngoại lệ đã được đưa ra bởi Contract1. Lưu ý rằng chúng tôi vẫn không nhận được thông báo &quot;Xin chào từ hợp đồng!&quot;. Hợp đồng 1 vẫn ngừng xử lý sau lỗi của nó, nhưng không có lỗi tổng thể của hợp đồng do ngoại lệ được phát hiện và xử lý.</p><p>Tất nhiên, các trường hợp ngoại lệ cũng có thể xảy ra ngay cả khi chúng không được mã hợp đồng của bạn đưa ra một cách rõ ràng. Có những hoạt động, chẳng hạn như gửi một giao dịch mà không có đủ đầu vào để thanh toán cho một đầu ra, trong đó Plutus sẽ đưa ra một ngoại lệ.</p><p>Tiếp theo, hãy xem tham số<code>s</code>, tham số thứ hai <code>Contract</code>, xác định các hành động blockchain có sẵn.</p><p>Trong hai ví dụ đầu tiên, chúng tôi chỉ sử dụng <code>BlockChainActions</code> kiểu có tất cả các chức năng tiêu chuẩn nhưng không hỗ trợ cho các điểm cuối cụ thể. Nếu chúng tôi muốn hỗ trợ cho các điểm cuối cụ thể, chúng tôi phải sử dụng một loại khác.</p><p>Cách thường được thực hiện là sử dụng từ đồng nghĩa loại. Ví dụ sau đây sẽ tạo ra một từ đồng nghĩa kiểu <code>MySchema</code> có tất cả các khả năng <code>BlockChainActions</code> nhưng với việc bổ sung khả năng gọi điểm cuối <code>foo</code> với một đối số kiểu <code>Int</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">type MySchema = BlockchainActions .\/ Endpoint &quot;foo&quot; Int</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><em>Chú ý</em></p><p>Toán tử <code>.\\/</code> là một kiểu hoạt động - nó hoạt động trên kiểu không giá trị. Để sử dụng điều này chúng ta sử dụng các tùy chọn <code>TypeOperators</code> và <code>DataKinds</code> biên dịch.</p><p>Now, we can use the <code>MySchema</code> type to define our contract.
Bây giờ, chúng ta có thể sử dụng khiểu <code>MySchema</code> để xác định hợp đồng của mình.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myContract3 :: Contract () MySchema Text ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myContract3 = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      n &lt;- endpoint @&quot;foo&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      Contract.logInfo n</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Hợp đồng này sẽ chặn cho đến khi điểm cuối <code>foo</code> được gọi, trong trường hợp của chúng tôi, là một <code>Int</code>. Khi đó giá trị của tham  số<code>Int</code> sẽ được ràng buộc với n. Bởi vì điều này, chúng tôi không còn đủ để chỉ cần kích hoạt hợp đồng để kiểm tra nó. Bây giờ, chúng ta cũng phải gọi điểm cuối (endpoint).</p><p>Để làm điều này, bây giờ chúng ta cần phải xử lý từ <code>activateContractWallet</code> đó, sau đó chúng ta có thể sử dụng để gọi điểm cuối .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myTrace3 :: EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myTrace3 = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      h &lt;- activateContractWallet (Wallet 1) myContract3</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      callEndpoint @&quot;foo&quot; h 42</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test3 :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test3 = runEmulatorTraceIO myTrace3</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chạy điều này trong REPL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.}"><div tabindex="0" class="prism-code language-{.} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator Week04.Trace Wallet.Emulator.Stream Week04.Contract&gt; test3</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: TxnValidate af5e6d25b5ecb26185289a03d50786b7ac4425b21849143ed7e18bcd70dc4db8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Receive endpoint call: Object (fromList [(&quot;tag&quot;,String &quot;foo&quot;),(&quot;value&quot;,Object (fromList [(&quot;unEndpointValue&quot;,Number 42.0)]))])</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Contract log: Number 42.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Final balances</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 10: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">{, &quot;&quot;}: 100000000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Cuối cùng, hãy xem tham số kiểu đầu tiên, người viết. Không thể <code>w</code>  là một kiểu tùy ý, nó phải là một thể hiện của lớp kiểu <code>Monoid</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator Week04.Trace Wallet.Emulator.Stream Week04.Contract&gt; :i Monoid</span></div><div class="token-line" style="color:#393A34"><span class="token plain">type Monoid :: ` -&gt; Constraint</span></div><div class="token-line" style="color:#393A34"><span class="token plain">class Semigroup a =&gt; Monoid a where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mempty :: a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mappend :: a -&gt; a -&gt; a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mconcat :: [a] -&gt; a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{-# MINIMAL mempty #-}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monoid [a] -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monoid Ordering -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Semigroup a =&gt; Monoid (Maybe a) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monoid a =&gt; Monoid (IO a) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monoid b =&gt; Monoid (a -&gt; b) -- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Monoid a, Monoid b, Monoid c, Monoid d, Monoid e) =&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      Monoid (a, b, c, d, e)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Monoid a, Monoid b, Monoid c, Monoid d) =&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      Monoid (a, b, c, d)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Monoid a, Monoid b, Monoid c) =&gt; Monoid (a, b, c)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance (Monoid a, Monoid b) =&gt; Monoid (a, b)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">-- Defined in ‘GHC.Base’</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Monoid () -- Defined in ‘GHC.Base’</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Đây là một lớp kiểu rất quan trọng và rất phổ biến trong Haskell. Nó định nghĩa <code>mempty</code> và <code>mappend</code>.</p><p>Hàm <code>mempty</code> giống như phần tử trung lập và <code>mappend</code> kết hợp hai phần tử của loại này để tạo ra một phần tử mới cùng loại.</p><p>Ví dụ <code>Monoid</code> là <code>List</code>, khi <code>mempty</code> là danh sách empty <code>\[\]</code>, và <code>mappend</code> là nối <code>++</code>.</p><p>Ví dụ:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude&gt; mempty :: [Int]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude&gt; mappend [1, 2, 3 :: Int] [4, 5, 6]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[1,2,3,4,5,6]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Có rất nhiều ví dụ khác về <code>Monoid</code>, và chúng ta sẽ thấy các trường hợp khác trong khóa học này.</p><p>Nhưng bây giờ, chúng ta hãy gắn bó với các danh sách và viết ví dụ cuối cùng của chúng ta.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myContract4 :: Contract [Int] BlockchainActions Text ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myContract4 = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void $ Contract.waitNSlots 10</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    tell [1]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void $ Contract.waitNSlots 10</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    tell [2]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void $ Contract.waitNSlots 10</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Thay vì sử dụng <code>Unit</code> như là kiểu <code>w</code>, Chúng tôi sử dụng<code>\[Int\]</code>.Điều này cho phép chúng tôi sử dụng <code>tell</code> như là show.</p><p>Điều này bây giờ cho phép chúng tôi truy cập vào các thông báo đó trong quá trình theo dõi, bằng cách sử dụng hàm <code>observableState</code> .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">myTrace4 :: EmulatorTrace ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">myTrace4 = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    h &lt;- activateContractWallet (Wallet 1) myContract4</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void $ Emulator.waitNSlots 5</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    xs &lt;- observableState h</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Extras.logInfo $ show xs</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void $ Emulator.waitNSlots 10</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ys &lt;- observableState h</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Extras.logInfo $ show ys</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void $ Emulator.waitNSlots 10</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    zs &lt;- observableState h</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Extras.logInfo $ show zs</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test4 :: IO ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test4 = runEmulatorTraceIO myTrace4</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nếu chúng ta chạy điều này trong REPL, chúng ta có thể thấy các <code>USER LOG</code> thông báo được tạo bằng cách sử dụng hàm <code>tell</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.}"><div tabindex="0" class="prism-code language-{.} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.Trace.Emulator Plutus.Contract.Trace Wallet.Emulator Week04.Trace Wallet.Emulator.Stream Week04.Contract&gt; test4</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: TxnValidate af5e6d25b5ecb26185289a03d50786b7ac4425b21849143ed7e18bcd70dc4db8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00000: SlotAdd Slot 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Contract instance started</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00001: SlotAdd Slot 2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00005: SlotAdd Slot 6</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00006: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Sending contract state to Thread 0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00006: SlotAdd Slot 7</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00007: *** USER LOG: []</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00007: SlotAdd Slot 8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00015: SlotAdd Slot 16</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00016: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Sending contract state to Thread 0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00016: SlotAdd Slot 17</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00017: *** USER LOG: [1]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00017: SlotAdd Slot 18</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00025: SlotAdd Slot 26</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00026: 00000000-0000-4000-8000-000000000000 {Contract instance for wallet 1}:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Sending contract state to Thread 0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00026: SlotAdd Slot 27</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Slot 00027: *** USER LOG: [1,2]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Final balances</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 1: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 2: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Wallet 10: </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {, &quot;&quot;}: 100000000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Sử dụng cơ chế này, có thể truyền thông tin từ hợp đồng đang chạy trong ví ra thế giới bên ngoài. Sử dụng thiết bị đầu cuối, chúng tôi có thể chuyển thông tin vào một hợp đồng. Và bằng cách sử dụng cơ chế <code>tell</code>, chúng tôi có thể lấy thông tin ra khỏi ví.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/cardano2vn/cardanovn-portal/edit/main/docs/dr-lars-lession/week4.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/dr-lars-lession/week3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Week 03 - Script Context</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tổng-quat" class="table-of-contents__link">Tổng quat</a></li><li><a href="#monads" class="table-of-contents__link">Monads</a><ul><li><a href="#hello-world" class="table-of-contents__link">Hello World</a></li><li><a href="#getline" class="table-of-contents__link">getLine</a></li><li><a href="#maybe" class="table-of-contents__link">Maybe</a></li><li><a href="#một-trong-hai-either" class="table-of-contents__link">Một trong hai (Either)</a></li><li><a href="#writer" class="table-of-contents__link">Writer</a></li><li><a href="#what-is-a-monad" class="table-of-contents__link">What is a Monad?</a></li><li><a href="#tại-sao-điều-này-hữu-ích" class="table-of-contents__link">Tại sao điều này hữu ích?</a></li><li><a href="#ký-hiệu-do" class="table-of-contents__link">ký hiệu &#39;do&#39;</a></li></ul></li><li><a href="#plutus-monads" class="table-of-contents__link">Plutus Monads</a><ul><li><a href="#the-emulatortrace-monad" class="table-of-contents__link">The EmulatorTrace Monad</a></li><li><a href="#the-contract-monad" class="table-of-contents__link">The Contract Monad</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Tài liệu</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/overview">Bắt đầu</a></li></ul></div><div class="col footer__col"><div class="footer__title">Cộng đồng</div><ul class="footer__items"><li class="footer__item"><a href="https://t.me/cardano2vn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCJTdAQPGJntJet5v-nk9ebA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://github.com/cardano2vn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/about-us">About Us</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">The content of this site is referenced and copied from the <a href="https://developers.cardano.org/" target="_blank" rel="noopener noreferrer">Cardano Developer</a>, 2021</div></div></div></footer></div>
<script src="/assets/js/runtime~main.38f84b10.js"></script>
<script src="/assets/js/main.c8d132ad.js"></script>
</body>
</html>