<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Cardano2vn Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Cardano2vn Blog Atom Feed"><title data-react-helmet="true">Week 03 - Script Context | Cardano2vn</title><meta data-react-helmet="true" property="og:url" content="https://cardano2vn.io/docs/dr-lars-lession/week3"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Week 03 - Script Context | Cardano2vn"><meta data-react-helmet="true" name="description" content="ÄÃ¢y lÃ  phiÃªn báº£n Ä‘Ã£ dá»‹ch cá»§a BÃ i giáº£ng sá»‘ 3 Dr. Lars."><meta data-react-helmet="true" property="og:description" content="ÄÃ¢y lÃ  phiÃªn báº£n Ä‘Ã£ dá»‹ch cá»§a BÃ i giáº£ng sá»‘ 3 Dr. Lars."><link data-react-helmet="true" rel="shortcut icon" href="/img/logo/2.png"><link data-react-helmet="true" rel="canonical" href="https://cardano2vn.io/docs/dr-lars-lession/week3"><link data-react-helmet="true" rel="alternate" href="https://cardano2vn.io/docs/dr-lars-lession/week3" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cardano2vn.io/docs/dr-lars-lession/week3" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.8b54419c.css">
<link rel="preload" href="/assets/js/runtime~main.af40557b.js" as="script">
<link rel="preload" href="/assets/js/main.97b62b7d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo/2.png" alt="Cardano2vn Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo/2.png" alt="Cardano2vn Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Cardano2vn</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/getting-started/overview">Báº¯t Ä‘áº§u</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cardano2vn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo/2.png" alt="Cardano2vn Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo/2.png" alt="Cardano2vn Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Cardano2vn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/getting-started/overview">Báº¯t Ä‘áº§u</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/cardano2vn" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/overview">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Táº¡o Há»£p Ä‘á»“ng thÃ´ng minh</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/smart-contracts/overview">Tá»•ng quan</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/smart-contracts/marlowe">NgÃ´n ngá»¯ Marlowe</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/smart-contracts/plutus">NgÃ´n ngá»¯ Plutus</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">TÃ­ch há»£p vá»›i Cardano</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/integrate-cardano/note">Note</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Váº­n hÃ nh má»™t Stake Pool</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operate-a-stake-pool/note">Note</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">KhoÃ¡ Ä‘Ã o táº¡o Plutus cá»§a Dr. Lars</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dr-lars-lession/overview">Plutus Pioneer Program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dr-lars-lession/week1">Week 01 - English Auction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dr-lars-lession/week2">Week 02 - Validation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/dr-lars-lession/week3">Week 03 - Script Context</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dr-lars-lession/week4">Week 04 - Monads</a></li></ul></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Week 03 - Script Context</h1></header><div class="markdown"><p>ÄÃ¢y lÃ  phiÃªn báº£n Ä‘Ã£ dá»‹ch cá»§a <a href="https://youtu.be/WG3uw-TkW2k" target="_blank" rel="noopener noreferrer">BÃ i giáº£ng sá»‘ 3 Dr. Lars</a>.</p><p>Trong bÃ i giáº£ng nÃ y, chÃºng ta tÃ¬m hiá»ƒu vá» context script (Ä‘á»‘i sá»‘ xÃ¡c thá»±c thá»© ba), thá»i gian xá»­ lÃ½ vÃ  cÃ¡c há»£p Ä‘á»“ng Ä‘Æ°á»£c tham sá»‘ hÃ³a.</p><p>Äoáº¡n mÃ£ trong bÃ i giáº£ng nÃ y sá»­ dá»¥ng Plutus commit lÃ  <code>81ba78edb1d634a13371397d8c8b19829345ce0d</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="trÆ°á»›c-khi-chÃºng-ta-báº¯t-Ä‘áº§u"></a>TrÆ°á»›c khi chÃºng ta báº¯t Ä‘áº§u<a class="hash-link" href="#trÆ°á»›c-khi-chÃºng-ta-báº¯t-Ä‘áº§u" title="Direct link to heading">#</a></h2><p>Ká»ƒ tá»« bÃ i giáº£ng cuá»‘i cÃ¹ng Ä‘Ã£ cÃ³ má»™t báº£n cáº­p nháº­t cho sÃ¢n chÆ¡i, cÃ³ trong báº£n cam káº¿t Plutus mÃ  chÃºng tÃ´i Ä‘ang sá»­ dá»¥ng cho bÃ i giáº£ng nÃ y (xem ghi chÃº á»Ÿ trÃªn).</p><p>ÄÃ£ xáº£y ra sá»± cá»‘ khi thá»i gian chá» Ä‘Æ°á»£c mÃ£ hÃ³a cá»©ng vÃ o sÃ¢n chÆ¡i quÃ¡ ngáº¯n. Äiá»u nÃ y sáº½ khiáº¿n mÃ´ phá»ng khÃ´ng thÃ nh cÃ´ng náº¿u chÃºng máº¥t nhiá»u thá»i gian hÆ¡n thá»i gian chá» mÃ£ cá»©ng.</p><p>BÃ¢y giá» cÃ³ má»™t tÃ¹y chá»n khi báº¡n khá»Ÿi Ä‘á»™ng MÃ¡y chá»§ sÃ¢n chÆ¡i Plutus cho phÃ©p báº¡n chá»‰ Ä‘á»‹nh thá»i gian chá». VÃ­ dá»¥ sau Ä‘áº·t thá»i gian chá» thÃ nh 120 giÃ¢y.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.}"><div tabindex="0" class="prism-code language-{.} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">plutus-playground-server -i 120s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="tÃ³m-táº¯t-láº¡i"></a>TÃ³m táº¯t láº¡i<a class="hash-link" href="#tÃ³m-táº¯t-láº¡i" title="Direct link to heading">#</a></h2><p>Khi chÃºng tÃ´i Ä‘Ã£ giáº£i thÃ­ch (E) UTxO mÃ´ hÃ¬nh trong bÃ i giáº£ng Ä‘áº§u tiÃªn, chÃºng tÃ´i Ä‘á» cáº­p ráº±ng Ä‘á»ƒ má»Ÿ khÃ³a má»™t Ä‘á»‹a chá»‰ ká»‹ch báº£n, ká»‹ch báº£n gáº¯n liá»n vá»›i Ä‘á»‹a chá»‰ Ä‘Æ°á»£c cháº¡y, vÃ  ká»‹ch báº£n mÃ  Ä‘Æ°á»£c ba máº©u thÃ´ng tin -
<em>datum</em>,  <em>redeemer</em> vÃ  <em>context</em>.</p><p>Trong bÃ i giáº£ng thá»© hai, chÃºng ta Ä‘Ã£ xem cÃ¡c vÃ­ dá»¥ vá» Ä‘iá»u Ä‘Ã³ vÃ  chÃºng ta Ä‘Ã£ tháº¥y nÃ³ thá»±c sá»± hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o trong Haskell.</p><p>ChÃºng tÃ´i Ä‘Ã£ tháº¥y viá»‡c triá»ƒn khai cáº¥p tháº¥p, trong Ä‘Ã³ cáº£ ba Ä‘á»‘i sá»‘ Ä‘á»u Ä‘Æ°á»£c biá»ƒu thá»‹ báº±ng kiá»ƒu <code>Data</code>. ChÃºng tÃ´i cÅ©ng tháº¥y ráº±ng trong thá»±c táº¿ Ä‘iá»u nÃ y khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng.</p><p>Thay vÃ o Ä‘Ã³, chÃºng tÃ´i sá»­ dá»¥ng phiÃªn báº£n Ä‘Ã£ nháº­p, trong Ä‘Ã³ dá»¯ liá»‡u vÃ  cÃ´ng cá»¥ Ä‘á»•i cÃ³ thá»ƒ lÃ  kiá»ƒu tÃ¹y chá»‰nh (miá»…n lÃ  chÃºng triá»ƒn khai lá»›p kiá»ƒu <code>IsData</code>) vÃ  trong Ä‘Ã³ Ä‘á»‘i sá»‘ thá»© ba lÃ  kiá»ƒu <code>ScriptContext</code>.</p><p>Trong cÃ¡c vÃ­ dá»¥ mÃ  chÃºng tÃ´i Ä‘Ã£ tháº¥y cho Ä‘áº¿n nay, chÃºng tÃ´i Ä‘Ã£ xem xÃ©t dá»¯ liá»‡u vÃ  cÃ´ng cá»¥ Ä‘á»•i, nhÆ°ng chÃºng tÃ´i luÃ´n bá» qua ngá»¯ cáº£nh. NhÆ°ng bá»‘i cáº£nh, táº¥t nhiÃªn, ráº¥t quan trá»ng. VÃ¬ váº­y, trong bÃ i giáº£ng nÃ y, chÃºng ta sáº½ báº¯t Ä‘áº§u xem xÃ©t context.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="scriptcontext"></a>ScriptContext<a class="hash-link" href="#scriptcontext" title="Direct link to heading">#</a></h2><p><code>ScriptContext</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong gÃ³i <code>plutus-ledger-api</code>, mÃ  lÃ  má»™t gÃ³i pháº§n má»m Ä‘Ã³, cho Ä‘áº¿n bÃ¢y giá», chÃºng tÃ´i Ä‘Ã£ khÃ´ng cáº§n thiáº¿t. NhÆ°ng bÃ¢y giá» chÃºng tÃ´i cáº§n nÃ³, vÃ  nÃ³ Ä‘Ã£ Ä‘Æ°á»£c Ä‘Æ°a vÃ o files <code>.cabal</code> cá»§a tuáº§n nÃ y . NÃ³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong mÃ´-Ä‘un <code>Plutus.V1.Ledger.Contexts</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data ScriptContext = ScriptContext { </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            scriptContextTxInfo :: TxInfo, </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            scriptContextPurpose :: ScriptPurpose </span></div><div class="token-line" style="color:#393A34"><span class="token plain">      }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>NÃ³ lÃ  má»™t loáº¡i báº£n ghi cÃ³ hai trÆ°á»ng.</p><p>TrÆ°á»ng thá»© hai thuá»™c loáº¡i <code>ScriptPurpose</code>, Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh trong cÃ¹ng má»™t mÃ´-Ä‘un. NÃ³ xÃ¡c Ä‘á»‹nh má»¥c Ä‘Ã­ch mÃ  má»™t táº­p lá»‡nh Ä‘ang Ä‘Æ°á»£c cháº¡y.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data ScriptPurpose</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   = Minting CurrencySymbol</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   | Spending TxOutRef</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   | Rewarding StakingCredential</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   | Certifying DCert</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Äá»‘i vá»›i chÃºng tÃ´i, quan trá»ng nháº¥t lÃ  <code>Spending</code>. ÄÃ¢y lÃ  nhá»¯ng gÃ¬ chÃºng ta Ä‘Ã£ nÃ³i cho Ä‘áº¿n nay trong context cá»§a mÃ´ hÃ¬nh (E) UTxO. ÄÃ¢y lÃ  khi má»™t táº­p lá»‡nh Ä‘Æ°á»£c cháº¡y Ä‘á»ƒ xÃ¡c thá»±c Ä‘áº§u vÃ o chi tiÃªu cho má»™t giao dá»‹ch.</p><p>CÃ¡c <code>Minting</code> dÃ¹ng khi báº¡n muá»‘n Ä‘á»‹nh nghÄ©a má»™t token gá»‘c. Má»¥c Ä‘Ã­ch cá»§a nÃ³ lÃ  chÃºng tÃ´i mÃ´ táº£ trong nhá»¯ng trÆ°á»ng há»£p nÃ o token gá»‘c cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘Ãºc hoáº·c Ä‘á»‘t.</p><p>NgoÃ i ra cÃ²n cÃ³ hai má»¥c Ä‘Ã­ch hoÃ n toÃ n má»›i -<code>Rewarding</code>-  liÃªn quan Ä‘áº¿n Ä‘áº·t cÆ°á»£c vÃ  <em><code>Certifying</code></em>  liÃªn quan Ä‘áº¿n á»§y quyá»n cá»• pháº§n.</p><p>TrÆ°á»ng thÃº vá»‹ nháº¥t, trÆ°á»ng chá»©a ngá»¯ cáº£nh thá»±c táº¿ <code>scriptContextTxInfo</code> lÃ  trÆ°á»ng thuá»™c loáº¡i <code>TxInfo</code>, cÅ©ng Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh trong cÃ¹ng má»™t mÃ´-Ä‘un.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data TxInfo = TxInfo</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   { txInfoInputs      :: [TxInInfo] -- ^ Transaction inputs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoOutputs     :: [TxOut] -- ^ Transaction outputs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoFee         :: Value -- ^ The fee paid by this transaction.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoForge       :: Value -- ^ The &#x27;Value&#x27; forged by this transaction.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoDCert       :: [DCert] -- ^ Digests of certificates included in this transaction</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoWdrl        :: [(StakingCredential, Integer)] -- ^ Withdrawals</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoValidRange  :: SlotRange -- ^ The valid range for the transaction.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoSignatories :: [PubKeyHash] -- ^ Signatures provided with the transaction, attested that they all signed the tx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoData        :: [(DatumHash, Datum)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , txInfoId          :: TxId</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   -- ^ Hash of the pending transaction (excluding witnesses)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   } deriving (Generic)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>NÃ³ mÃ´ táº£ giao dá»‹ch chi tiÃªu. Trong mÃ´ hÃ¬nh (E) UTxO, bá»‘i cáº£nh xÃ¡c thá»±c lÃ  giao dá»‹ch chi tiÃªu vÃ  cÃ¡c Ä‘áº§u vÃ o vÃ  Ä‘áº§u ra cá»§a nÃ³. Bá»‘i cáº£nh nÃ y Ä‘Æ°á»£c thá»ƒ hiá»‡n trong <code>TxInfo</code>.</p><p>CÃ³ má»™t sá»‘ trÆ°á»ng lÃ  toÃ n cáº§u cho toÃ n bá»™ giao dá»‹ch vÃ  cá»¥ thá»ƒ lÃ  chÃºng tÃ´i cÃ³ danh sÃ¡ch táº¥t cáº£ cÃ¡c Ä‘áº§u vÃ o <code>txInfoInputs</code> vÃ  danh sÃ¡ch táº¥t cáº£ cÃ¡c Ä‘áº§u ra <code>txInfoOutputs</code>. Má»—i ngÆ°á»i trong sá»‘ há» cÃ³ nhiá»u lÄ©nh vá»±c khÃ¡c nhau Ä‘á»ƒ Ä‘i sÃ¢u vÃ o tá»«ng Ä‘áº§u vÃ o hoáº·c Ä‘áº§u ra riÃªng láº».</p><p>ChÃºng tÃ´i cÅ©ng tháº¥y cÃ¡c trÆ°á»ng vá» phÃ­ <code>txFee</code>, giÃ¡ trá»‹ giáº£ máº¡o <code>txInfoForge</code>, Ä‘Æ°á»£c sá»­ dá»¥ng khi Ä‘Ãºc hoáº·c Ä‘á»‘t cÃ¡c token gá»‘c.</p><p>Sau Ä‘Ã³, chÃºng tÃ´i cÃ³ má»™t danh sÃ¡ch cÃ¡c chá»©ng chá»‰ á»§y quyá»n trong <code>txInfoDCert</code> vÃ  má»™t trÆ°á»ng <code>txInfoWdrl</code> Ä‘á»ƒ náº¯m giá»¯ thÃ´ng tin vá» viá»‡c rÃºt tiá»n Ä‘áº·t cÆ°á»£c.</p><p>TrÆ°á»ng <code>txInfoValidRange</code> mÃ  chÃºng ta sáº½ xem xÃ©t chi tiáº¿t hÆ¡n trong giÃ¢y lÃ¡t, xÃ¡c Ä‘á»‹nh pháº¡m vi vá»‹ trÃ­ mÃ  giao dá»‹ch nÃ y há»£p lá»‡.</p><p><code>txInfoSignatories</code> lÃ  danh sÃ¡ch cÃ¡c khÃ³a cÃ´ng khai Ä‘Ã£ kÃ½ káº¿t giao dá»‹ch nÃ y.</p><p>CÃ¡c giao dá»‹ch sá»­ dá»¥ng Ä‘áº§u ra táº­p lá»‡nh cáº§n pháº£i bao gá»“m dá»¯ liá»‡u cá»§a Ä‘áº§u ra táº­p lá»‡nh. CÃ¡c <code>txInfoData</code> lÄ©nh vá»±c lÃ  má»™t danh sÃ¡ch liÃªn káº¿t datums vá»›i bÄƒm tÆ°Æ¡ng á»©ng cá»§a há». Náº¿u cÃ³ má»™t Ä‘áº§u ra giao dá»‹ch tá»›i má»™t Ä‘á»‹a chá»‰ táº­p lá»‡nh mang má»™t sá»‘ dá»¯ liá»‡u nÃ o Ä‘Ã³, báº¡n khÃ´ng cáº§n pháº£i bao gá»“m dá»¯ liá»‡u Ä‘Ã³, báº¡n chá»‰ cÃ³ thá»ƒ bao gá»“m bÄƒm dá»¯ liá»‡u. Tuy nhiÃªn, cÃ¡c táº­p lá»‡nh sá»­ dá»¥ng má»™t Ä‘áº§u ra cáº§n pháº£i bao gá»“m dá»¯ liá»‡u, trong trÆ°á»ng há»£p Ä‘Ã³, nÃ³ sáº½ Ä‘Æ°á»£c Ä‘Æ°a vÃ o danh sÃ¡ch <code>txInfoData</code> .</p><p>Cuá»‘i cÃ¹ng, trÆ°á»ng <code>txInfoId</code> lÃ  ID cá»§a giao dá»‹ch nÃ y.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="txinfovalidrange"></a>txInfoValidRange<a class="hash-link" href="#txinfovalidrange" title="Direct link to heading">#</a></h3><p>Máº·c dÃ¹ cÃ³ ráº¥t nhiá»u thÃ´ng tin chá»©a trong kiá»ƒu <code>txInfo</code>, nhÆ°ng Ä‘á»‘i vá»›i vÃ­ dá»¥ Ä‘áº§u tiÃªn cá»§a chÃºng tÃ´i vá» cÃ¡ch sá»­ dá»¥ng Ä‘á»‘i sá»‘ thá»© ba Ä‘á»ƒ xÃ¡c thá»±c, chÃºng tÃ´i sáº½ táº­p trung vÃ o trÆ°á»ng <code>txInfoValidRange</code> nÃ y.</p><p>Äiá»u nÃ y Ä‘Æ°a chÃºng ta Ä‘áº¿n má»™t tÃ¬nh huá»‘ng khÃ³ xá»­ thÃº vá»‹. ChÃºng tÃ´i Ä‘Ã£ nháº¥n máº¡nh nhiá»u láº§n ráº±ng lá»£i tháº¿ lá»›n mÃ  Cardano cÃ³ so vá»›i má»™t thá»© nhÆ° Ethereum lÃ  viá»‡c xÃ¡c thá»±c cÃ³ thá»ƒ xáº£y ra trong vÃ­. NhÆ°ng chÃºng tÃ´i cÅ©ng Ä‘Ã£ lÆ°u Ã½ ráº±ng má»™t giao dá»‹ch váº«n cÃ³ thá»ƒ khÃ´ng thÃ nh cÃ´ng on-chain sau khi xÃ¡c thá»±c, náº¿u khi giao dá»‹ch trÃªn blockchain, nÃ³ Ä‘Ã£ bá»‹ ngÆ°á»i khÃ¡c sá»­ dá»¥ng. Trong trÆ°á»ng há»£p nÃ y, giao dá»‹ch khÃ´ng thÃ nh cÃ´ng mÃ  khÃ´ng pháº£i tráº£ phÃ­.</p><p>Äiá»u khÃ´ng bao giá» nÃªn xáº£y ra trong cÃ¡c trÆ°á»ng há»£p bÃ¬nh thÆ°á»ng lÃ  má»™t táº­p lá»‡nh xÃ¡c thá»±c cháº¡y vÃ  sau Ä‘Ã³ khÃ´ng thÃ nh cÃ´ng. Äiá»u nÃ y lÃ  do báº¡n luÃ´n cÃ³ thá»ƒ cháº¡y xÃ¡c thá»±c trong cÃ¹ng má»™t Ä‘iá»u kiá»‡n trong vÃ­, vÃ¬ váº­y nÃ³ sáº½ khÃ´ng thÃ nh cÃ´ng trÆ°á»›c khi báº¡n gá»­i nÃ³.</p><p>VÃ¬ váº­y, Ä‘Ã³ lÃ  má»™t tÃ­nh nÄƒng ráº¥t hay, nhÆ°ng khÃ´ng rÃµ rÃ ng lÃ  lÃ m tháº¿ nÃ o Ä‘á»ƒ quáº£n lÃ½ thá»i gian trong context Ä‘Ã³. Thá»i gian ráº¥t quan trá»ng, bá»Ÿi vÃ¬ chÃºng tÃ´i muá»‘n thá»ƒ hiá»‡n ráº±ng má»™t giao dá»‹ch nháº¥t Ä‘á»‹nh chá»‰ cÃ³ hiá»‡u lá»±c trÆ°á»›c hoáº·c chá»‰ cÃ³ hiá»‡u lá»±c sau khi Ä‘Ã£ Ä‘áº¡t Ä‘áº¿n má»™t thá»i Ä‘iá»ƒm nháº¥t Ä‘á»‹nh.</p><p>ChÃºng ta Ä‘Ã£ tháº¥y má»™t vÃ­ dá»¥ vá» Ä‘iá»u nÃ y trong bÃ i giáº£ng má»™t - vÃ­ dá»¥ Ä‘áº¥u giÃ¡ (bid), trong Ä‘Ã³ giÃ¡ tháº§u chá»‰ Ä‘Æ°á»£c phÃ©p cho Ä‘áº¿n khi Ä‘áº¡t Ä‘áº¿n thá»i háº¡n cuá»‘i cÃ¹ng vÃ  <code>close</code> chá»‰ khi cÃ³ thá»ƒ gá»i <em>Endpoint</em> sau khi thá»i háº¡n Ä‘Ã£ qua.</p><p>Äiá»u Ä‘Ã³ dÆ°á»ng nhÆ° lÃ  má»™t sá»± mÃ¢u thuáº«n, bá»Ÿi vÃ¬ thá»i gian rÃµ rÃ ng lÃ  Ä‘ang trÃ´i. VÃ¬ váº­y, khi báº¡n cá»‘ gáº¯ng xÃ¡c thá»±c má»™t giao dá»‹ch mÃ  báº¡n Ä‘ang táº¡o trong vÃ­ cá»§a mÃ¬nh, táº¥t nhiÃªn, thá»i gian báº¡n Ä‘ang thá»±c hiá»‡n cÃ³ thá»ƒ khÃ¡c vá»›i thá»i gian giao dá»‹ch Ä‘áº¿n má»™t nÃºt Ä‘á»ƒ xÃ¡c thá»±c. VÃ¬ váº­y, khÃ´ng rÃµ lÃ m tháº¿ nÃ o Ä‘á»ƒ káº¿t há»£p hai Ä‘iá»u nÃ y láº¡i vá»›i nhau Ä‘á»ƒ xÃ¡c thá»±c lÃ  xÃ¡c Ä‘á»‹nh vÃ  Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng náº¿u vÃ  chá»‰ khi, xÃ¡c thá»±c thÃ nh cÃ´ng trong vÃ­, thÃ¬ nÃ³ cÅ©ng sáº½ thÃ nh cÃ´ng trong nÃºt.</p><p>CÃ¡ch Cardano giáº£i quyáº¿t Ä‘iá»u Ä‘Ã³, lÃ  báº±ng cÃ¡ch thÃªm trÆ°á»ng pháº¡m vi vá»‹ trÃ­ <code>txInfoValidRange</code> vÃ o má»™t giao dá»‹ch, vá» cÆ¡ báº£n nÃ³i ráº±ng &quot;Giao dá»‹ch nÃ y há»£p lá»‡ giá»¯a vá»‹ trÃ­ nÃ y vÃ  vá»‹ trÃ­ kia &quot;.</p><p>Khi má»™t giao dá»‹ch Ä‘Æ°á»£c gá»­i Ä‘áº¿n blockchain vÃ  Ä‘Æ°á»£c xÃ¡c thá»±c bá»Ÿi má»™t nÃºt, sau Ä‘Ã³ trÆ°á»›c khi cháº¡y báº¥t ká»³ táº­p lá»‡nh nÃ o, má»™t sá»‘ kiá»ƒm tra chung sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n, cháº³ng háº¡n nhÆ° táº¥t cáº£ cÃ¡c Ä‘áº§u vÃ o Ä‘á»u cÃ³ máº·t vÃ  sá»‘ dÆ° cá»™ng láº¡i, phÃ­ Ä‘Æ°á»£c bao gá»“m, v.v.</p><p>Má»™t trong nhá»¯ng kiá»ƒm tra xáº£y ra trÆ°á»›c khi xÃ¡c thá»±c lÃ  kiá»ƒm tra xem pháº¡m vi vá»‹ trÃ­ cÃ³ há»£p lá»‡ hay khÃ´ng. NÃºt sáº½ xem xÃ©t thá»i Ä‘iá»ƒm hiá»‡n táº¡i vÃ  kiá»ƒm tra xem nÃ³ cÃ³ náº±m trong pháº¡m vi vá»‹ trÃ­ há»£p lá»‡ cá»§a giao dá»‹ch hay khÃ´ng. Náº¿u khÃ´ng, thÃ¬ xÃ¡c thá»±c khÃ´ng thÃ nh cÃ´ng ngay láº­p tá»©c mÃ  khÃ´ng bao giá» cháº¡y cÃ¡c táº­p lá»‡nh trÃ¬nh xÃ¡c thá»±c.</p><p>VÃ¬ váº­y, náº¿u kiá»ƒm tra trÆ°á»›c thÃ nh cÃ´ng, thÃ¬ Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  thá»i gian hiá»‡n táº¡i rÆ¡i vÃ o pháº¡m vi vá»‹ trÃ­ há»£p lá»‡. Äáº¿n lÆ°á»£t nÃ³, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta láº¡i hoÃ n toÃ n xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c. Táº­p lá»‡nh xÃ¡c thá»±c cÃ³ thá»ƒ Ä‘Æ¡n giáº£n giáº£ Ä‘á»‹nh ráº±ng nÃ³ Ä‘ang Ä‘Æ°á»£c cháº¡y táº¡i má»™t vá»‹ trÃ­ há»£p lá»‡.</p><p>Theo máº·c Ä‘á»‹nh, má»™t táº­p lá»‡nh sáº½ sá»­ dá»¥ng pháº¡m vi vá»‹ trÃ­ vÃ´ háº¡n, má»™t táº­p lá»‡nh bao gá»“m táº¥t cáº£ cÃ¡c vá»‹ trÃ­ báº¯t Ä‘áº§u tá»« khá»‘i gá»‘c vÃ  cháº¡y cho Ä‘áº¿n háº¿t thá»i gian.</p><p>CÃ³ má»™t sá»± phá»©c táº¡p nhá» vá»›i Ä‘iá»u nÃ y, Ä‘Ã³ lÃ  Ouroboros, giao thá»©c Ä‘á»“ng thuáº­n cung cáº¥p nÄƒng lÆ°á»£ng cho Cardano khÃ´ng sá»­ dá»¥ng thá»i gian POSIX, nÃ³ sá»­ dá»¥ng cÃ¡c khe cáº¯m. NhÆ°ng Plutus sá»­ dá»¥ng thá»i gian thá»±c, vÃ¬ váº­y chÃºng ta cáº§n cÃ³ kháº£ nÄƒng chuyá»ƒn Ä‘á»•i qua láº¡i giá»¯a thá»i gian thá»±c vÃ  thá»i Ä‘iá»ƒm. Äiá»u nÃ y khÃ´ng cÃ³ váº¥n Ä‘á» gÃ¬ miá»…n lÃ  thá»i gian rÃ£nh Ä‘Æ°á»£c cá»‘ Ä‘á»‹nh. Ngay bÃ¢y giá» lÃ  má»™t giÃ¢y, vÃ¬ váº­y ngay bÃ¢y giá» nÃ³ lÃ  dá»… dÃ ng.</p><p>Tuy nhiÃªn, Ä‘iá»u nÃ y cÃ³ thá»ƒ thay Ä‘á»•i trong tÆ°Æ¡ng lai. CÃ³ thá»ƒ cÃ³ má»™t Ä‘á»£t hard fork vá»›i má»™t sá»‘ thay Ä‘á»•i thÃ´ng sá»‘ sáº½ thay Ä‘á»•i thá»i gian cá»§a vá»‹ trÃ­. ChÃºng tÃ´i khÃ´ng thá»ƒ biáº¿t trÆ°á»›c Ä‘iá»u Ä‘Ã³. VÃ­ dá»¥, chÃºng tÃ´i khÃ´ng biáº¿t Ä‘á»™ dÃ i vá»‹ trÃ­ sáº½ lÃ  bao nhiÃªu trong 10 nÄƒm ná»¯a.</p><p>Äiá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  cÃ¡c khoáº£ng thá»i gian Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh cho cÃ¡c giao dá»‹ch khÃ´ng Ä‘Æ°á»£c cÃ³ giá»›i háº¡n trÃªn xÃ¡c Ä‘á»‹nh lÃ  quÃ¡ xa trong tÆ°Æ¡ng lai. Chá»‰ cÃ ng xa trong tÆ°Æ¡ng lai thÃ¬ ngÆ°á»i ta má»›i cÃ³ thá»ƒ biáº¿t Ä‘Æ°á»£c Ä‘á»™ dÃ i rÃ£nh sáº½ lÃ  bao nhiÃªu. Äiá»u nÃ y xáº£y ra tÆ°Æ¡ng tá»± nhÆ° 36 giá». ChÃºng tÃ´i biáº¿t ráº±ng náº¿u sáº¯p cÃ³ má»™t Ä‘á»£t hard fork, chÃºng tÃ´i sáº½ biáº¿t vá» nÃ³ trÆ°á»›c Ã­t nháº¥t 36 giá».</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="posixtimerange"></a>POSIXTimeRange<a class="hash-link" href="#posixtimerange" title="Direct link to heading">#</a></h3><p>HÃ£y xem <code>POSIXTimeRange</code> nÃ y , Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong <code>Plutus.V1.Ledger.Time</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">type POSIXTimeRange = Interval POSIXTime.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>NÃ³ lÃ  má»™t loáº¡i tá»« Ä‘á»“ng nghÄ©a vá»›i <code>Interval POSIXTime</code> vÃ  chÃºng ta tháº¥y ráº±ng nÃ³ <code>Interval</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bá»Ÿi  <code>LowerBound</code> vÃ  <code>UpperBound</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Interval</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      ivFrom :: LowerBound a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      inTo   :: UpperBound a      </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Náº¿u chÃºng ta Ä‘i sÃ¢u vÃ o, <code>LowerBound</code> chÃºng ta sáº½ tháº¥y hÃ m táº¡o</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data LowerBound a = LowerBound (Extended a) Closure</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>Closure</code> lÃ  má»™t tá»« Ä‘Ã´ng nghÄ©a vá»›i <code>Bool</code> vÃ  cháº¯c cháº¯n ráº±ng cÃ³ Ä‘Æ°a vÃ o <code>Interval</code> hay khÃ´ng.</p><p><code>Extended</code> cÃ³ thá»ƒ lÃ  <code>NegInf</code> Ã¢m vÃ´ cÃ¹ng, <code>PosInf</code> dÆ°Æ¡ng vÃ´ cÃ¹ng, hoáº·c <code>Finite</code>.</p><p>ChÃºng tÃ´i cÅ©ng tÃ¬m tháº¥y má»™t sá»‘ hÃ m trá»£ giÃºp bao gá»“m cáº£ hÃ m <code>member</code> kiá»ƒm tra xem má»™t cÃ¡i Ä‘Ã£ cho <code>a</code> cÃ³ pháº£i lÃ  má»™t pháº§n cá»§a má»™t cÃ¡i Ä‘Ã£ cho hay khÃ´ng <code>Interval</code>, miá»…n lÃ  kiá»ƒu cá»§a <code>a</code> lÃ  má»™t kiá»ƒu con cá»§a <code>Ord</code>, Ä‘Ã¢y lÃ  trÆ°á»ng há»£p cho <code>POSIXTime</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">member :: Ord a =&gt; a -&gt; Interval a -&gt; Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">member a i = i `contains` singleton a</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>interval</code> lÃ  má»™t hÃ m táº¡o thÃ´ng minh cho <code>Interval</code> Kiá»ƒu nÃ y táº¡o <code>Interval</code> vá»›i giá»›i háº¡n trÃªn vÃ  dÆ°á»›i.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">interval :: a -&gt; a -&gt; Interval a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">interval s s&#x27; = Interval (lowerBound s) (upperBound s&#x27;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Sau Ä‘Ã³ chÃºng ta cÃ³ <code>from</code> vá»›i <code>Interval</code> cÃ¡i nÃ y báº¯t Ä‘áº§u tá»« <code>a</code>
vÃ  kÃ©o dÃ i Ä‘áº¿n vÃ´ cÃ¹ng.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">from :: a -&gt; Interval a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">from s = Interval (lowerBound s) (UpperBound PosInf True)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>VÃ  chÃºng ta cÃ³ <code>to</code>, nÃ³ lÃ  ngÆ°á»›c láº¡i vá»›i <code>from</code>. NÃ³ cÅ©ng Ä‘Æ°á»£c dÃ¹ng <code>Interval</code>
nÃ³ báº¯t Ä‘áº§u block genesis tá»›i <code>a</code>, vÃ  bao gá»“m cáº£ <code>a</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">to :: a -&gt; Interval a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">to s = Interval (LowerBound NegInf True) (upperBound s)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>always</code> luÃ´n máº·c Ä‘á»‹nh <code>Interval</code> bao gá»“m táº¥t cáº£ tá»« Ã¢m vÃ´ cÃ¹ng Ä‘áº¿n dÆ°Æ¡ng vÃ´ cÃ¹ng.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">always :: Interval a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">always = Interval (LowerBound NegInf True) (UpperBound PosInf True)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>vÃ  cÃ³ Ä‘iá»u ngÆ°Æ¡c láº¡i, <code>never</code>, NÃ³ khÃ´ng chá»©a slots nÃ o.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">never :: Interval a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">never = Interval (LowerBound PosInf True) (UpperBound NegInf True)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>NgoÃ i ra cÃ²n trÃ¬nh trá»£ giÃºp <code>singleton</code>, nÃ³ bao gá»“m má»™t slot</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">singleton :: a -&gt; Interval a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">singleton s = interval s s      </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>HÃ m <code>hull</code> cho khoáº£ng nhá» nháº¥t chá»©a cáº£ hai khoáº£ng Ä‘Ã£ cho.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">hull :: Ord a =&gt; Interval a -&gt; Interval a -&gt; Interval a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">hull (Interval l1 h1) (Interval l2 h2) = Interval (min l1 l2) (max h1 h2)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Chá»©c nÄƒng <code>intersection</code> xÃ¡c Ä‘á»‹nh khoáº£ng thá»i gian lá»›n nháº¥t Ä‘Æ°á»£c chá»©a trong cáº£ khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh. ÄÃ¢y lÃ  má»™t <code>Interval</code> báº¯t Ä‘áº§u tá»« giá»›i háº¡n dÆ°á»›i lá»›n nháº¥t cá»§a hai khoáº£ng vÃ  kÃ©o dÃ i cho Ä‘áº¿n giá»›i háº¡n trÃªn nhá» nháº¥t.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">intersection :: Ord a =&gt; Interval a -&gt; Interval a -&gt; Interval a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">intersection (Interval l1 h1) (Interval l2 h2) = Interval (max l1 l2) (min h1 h2)    </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>HÃ m <code>overlaps</code> kiá»ƒm tra chá»©c nÄƒng cho dÃ¹ hai khoáº£ng thá»i gian chá»“ng lÃªn nhau, cÃ³ nghÄ©a lÃ , cho dÃ¹ cÃ³ má»™t giÃ¡ trá»‹ chá»“ng lÃªn nhau cá»§a cáº£ hai khoáº£ng thá»i gian.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">overlaps :: Ord a =&gt; Interval a -&gt; Interval a -&gt; Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">overlaps l r = isEmpty (l `intersection` r)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>contains</code> tláº¥y hai khoáº£ng vÃ  xÃ¡c Ä‘á»‹nh xem khoáº£ng thá»© hai cÃ³ hoÃ n toÃ n náº±m trong khoáº£ng thá»i gian Ä‘áº§u tiÃªn hay khÃ´ng.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">contains :: Ord a =&gt; Interval a -&gt; Interval a -&gt; Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">contains (Interval l1 h1) (Interval l2 h2) = l1 &lt;= l2 &amp;&amp; h2 &lt;= h1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>VÃ  chÃºng tÃ´i cÃ³ cÃ¡c chá»©c nÄƒng <code>before</code> vÃ  <code>after</code> Ä‘á»ƒ xÃ¡c Ä‘á»‹nh náº¿u má»™t thá»i gian nháº¥t Ä‘á»‹nh tÆ°Æ¡ng á»©ng, trÆ°á»›c hoáº·c sau má»i thá»© trong má»™t thá»i gian nháº¥t Ä‘á»‹nh <code>Interval</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">before :: Ord a =&gt; a -&gt; Interval a -&gt; Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">before h (Interval f _) = lowerBound h &lt; f</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">after :: Ord a =&gt; a -&gt; Interval a -&gt; Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">after h (Interval _ t) = upperBound h &gt; t</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>HÃ£y vÃ o trong REPL.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week03.Homework1&gt; import Plutus.V1.Ledger.Interval</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>HÃ£y xÃ¢y dá»±ng <code>Interval</code> tá»« 10 Ä‘áº¿n 20, bao gá»“m cáº£ hai Ä‘áº§u.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; interval (10 :: Integer) 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Interval {ivFrom = LowerBound (Finite 10) True, ivTo = UpperBound (Finite 20) True}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>ChÃºng ta cÃ³ thá»ƒ kiá»ƒm tra xem má»™t giÃ¡ trá»‹ cÃ³ pháº£i lÃ  thÃ nh viÃªn cá»§a má»™t khoáº£ng hay khÃ´ng:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 9 $ interval (10 :: Integer) 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">False</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 10 $ interval (10 :: Integer) 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 12 $ interval (10 :: Integer) 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 20 $ interval (10 :: Integer) 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 21 $ interval (10 :: Integer) 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">False</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng hÃ m <code>from</code>. á» Ä‘Ã¢y giá»›i háº¡n dÆ°á»›i láº¡i lÃ  má»™t slot há»¯u háº¡n, nhÆ°ng giá»›i háº¡n trÃªn lÃ  dÆ°Æ¡ng vÃ´ cÃ¹ng.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 21 $ from (30 :: Integer)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">False</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 30 $ from (30 :: Integer)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 300000 $ from (30 :: Integer)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>VÃ  hÃ m táº¡o <code>to</code>. á» Ä‘Ã¢y giá»›i háº¡n dÆ°á»›i lÃ  Ã¢m vÃ´ cÃ¹ng, trong khi giá»›i háº¡n trÃªn lÃ  sá»‘ slot há»¯u háº¡n.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 300000 $ to (30 :: Integer)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">False</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 31 $ to (30 :: Integer)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">False</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 30 $ to (30 :: Integer)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; member 7 $ to (30 :: Integer)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>BÃ¢y giá», chÃºng ta hÃ£y thá»­ hÃ m <code>intersection</code> vá»›i <code>Interval</code> tá»« 10 Ä‘áº¿n 20 vÃ  <code>Interval</code> tá»« 18 Ä‘áº¿n 30.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; intersection (interval (10 :: Integer) 20) $ interval 18 30</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Interval {ivFrom = LowerBound (Finite 18) True, ivTo = UpperBound (Finite 20) True}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>NhÆ° mong Ä‘á»£i, chÃºng tÃ´i nháº­n Ä‘Æ°á»£c nhá»¯ng <code>Interval</code> cháº¡y tá»« 18 Ä‘áº¿n 20, bao gá»“m cáº£ giÃ¡ trá»‹ hai Ä‘áº§u.</p><p>ChÃºng tÃ´i cÃ³ thá»ƒ kiá»ƒm tra xem má»™t cÃ¡i <code>Interval</code> cÃ³ chá»©a cÃ¡i khÃ¡c hay khÃ´ng.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; contains (to (100 :: Integer)) $ interval 30 80</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; contains (to (100 :: Integer)) $ interval 30 100</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; contains (to (100 :: Integer)) $ interval 30 101</span></div><div class="token-line" style="color:#393A34"><span class="token plain">False</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>We see that as soon as the second <code>Interval</code> extends to 101, it is no
longer fully contained within the <code>Interval</code> that runs to 100.</p><p>However, if we check with <code>overlaps</code>, then it will be true because there
are elements, such as 40, that are contained in both intervals.</p><p>ChÃºng tÃ´i tháº¥y ráº±ng ngay sau khi giÃ¢y thá»© hai <code>Interval</code> kÃ©o dÃ i Ä‘áº¿n 101, nÃ³ khÃ´ng cÃ²n Ä‘Æ°á»£c chá»©a Ä‘áº§y Ä‘á»§ bÃªn trong giÃ¡ trá»‹ <code>Interval</code> cháº¡y Ä‘áº¿n 100.</p><p>Tuy nhiÃªn, náº¿u chÃºng ta kiá»ƒm tra vá»›i <code>overlaps</code>, thÃ¬ nÃ³ sáº½ Ä‘Ãºng vÃ¬ cÃ³ cÃ¡c pháº§n tá»­, cháº³ng háº¡n nhÆ° 40, Ä‘Æ°á»£c chá»©a trong cáº£ hai khoáº£ng.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; overlaps (to (100 :: Integer)) $ interval 30 101</span></div><div class="token-line" style="color:#393A34"><span class="token plain">True</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Plutus.V1.Ledger.Interval Week03.Homework1&gt; overlaps (to (100 :: Integer)) $ interval 101 110</span></div><div class="token-line" style="color:#393A34"><span class="token plain">False</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="vÃ­-dá»¥---vesting"></a>VÃ­ dá»¥ - Vesting<a class="hash-link" href="#vÃ­-dá»¥---vesting" title="Direct link to heading">#</a></h2><p>HÃ£y tÆ°á»Ÿng tÆ°á»£ng báº¡n muá»‘n táº·ng má»™t mÃ³n quÃ  cá»§a Ada cho má»™t Ä‘á»©a tráº». Báº¡n muá»‘n Ä‘á»©a tráº» sá»Ÿ há»¯u Ada, nhÆ°ng báº¡n chá»‰ muá»‘n Ä‘á»©a tráº» cÃ³ quyá»n truy cáº­p vÃ o nÃ³ khi trÃ²n mÆ°á»i tÃ¡m tuá»•i.</p><p>Sá»­ dá»¥ng Plutus, nÃ³ ráº¥t dá»… thá»±c hiá»‡n. LÃ  há»£p Ä‘á»“ng Ä‘áº§u tiÃªn cá»§a chÃºng tÃ´i sáº½ xem xÃ©t Ä‘á»‘i sá»‘ ngá»¯ cáº£nh, chÃºng tÃ´i sáº½ thá»±c hiá»‡n má»™t há»£p Ä‘á»“ng thá»±c hiá»‡n má»™t káº¿ hoáº¡ch vesting. Tiá»n sáº½ Ä‘Æ°á»£c Ä‘Æ°a vÃ o má»™t ká»‹ch báº£n vÃ  sau Ä‘Ã³ nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c láº¥y bá»Ÿi má»™t ngÆ°á»i nÃ o Ä‘Ã³, nhÆ°ng chá»‰ khi Ä‘áº¿n má»™t thá»i háº¡n nháº¥t Ä‘á»‹nh.</p><p>ChÃºng tÃ´i báº¯t Ä‘áº§u báº±ng cÃ¡ch sao chÃ©p há»£p Ä‘á»“ng <code>IsData</code> tá»« bÃ i giáº£ng 2 vÃ o má»™t mÃ´-Ä‘un má»›i Ä‘Æ°á»£c gá»i lÃ  <code>Vesting</code>.</p><p>BÆ°á»›c Ä‘áº§u tiÃªn lÃ  suy nghÄ© vá» cÃ¡c loáº¡i cho dá»¯ liá»‡u vÃ  cÃ´ng cá»¥ Ä‘á»•i.</p><p>Äá»‘i vá»›i dá»¯ liá»‡u, Ä‘iá»u há»£p lÃ½ lÃ  cÃ³ hai pháº§n thÃ´ng tin, ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ  thá»i háº¡n. VÃ¬ váº­y, hÃ£y xÃ¡c Ä‘á»‹nh loáº¡i nÃ y:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data VestingDatum = VestingDatum</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   { beneficiary :: PubKeyHash</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , deadline    :: POSIXTime</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   } deriving Show</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">PlutusTx.unstableMakeIsData &#x27;&#x27;VestingDatum</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Äá»ƒ biáº¿t ai Ä‘Ã³ cÃ³ thá»ƒ chi tiÃªu Ä‘áº§u ra táº­p lá»‡nh nÃ y hay khÃ´ng, cáº§n cÃ³ hai thÃ´ng tin, tá»©c lÃ  chá»¯ kÃ½ cá»§a ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ  thá»i gian cá»§a giao dá»‹ch. Trong trÆ°á»ng há»£p nÃ y, cáº£ hai pháº§n thÃ´ng tin Ä‘Ã³ Ä‘á»u Ä‘Æ°á»£c chá»©a trong chÃ­nh giao dá»‹ch. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng tÃ´i khÃ´ng cáº§n báº¥t ká»³ thÃ´ng tin nÃ o trong trÃ¬nh redeemer, vÃ¬ váº­y chÃºng tÃ´i chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng  <code>()</code> cho trÃ¬nh redeemer.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">mkValidator :: VestingDatum -&gt; () -&gt; ScriptContext -&gt; Bool</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>ChÃºng ta cáº§n kiá»ƒm tra hai Ä‘iá»u kiá»‡n.</p><ol><li>Chá»‰ ngÆ°á»i thá»¥ hÆ°á»Ÿng chÃ­nh xÃ¡c má»›i cÃ³ thá»ƒ má»Ÿ khÃ³a UTxO táº¡i Ä‘á»‹a chá»‰ nÃ y. ChÃºng tÃ´i cÃ³ thá»ƒ xÃ¡c nháº­n Ä‘iá»u nÃ y báº±ng cÃ¡ch kiá»ƒm tra xem chá»¯ kÃ½ cá»§a ngÆ°á»i thá»¥ hÆ°á»Ÿng cÃ³ Ä‘Æ°á»£c bao gá»“m trong giao dá»‹ch hay khÃ´ng.</li><li>Ráº±ng giao dá»‹ch nÃ y chá»‰ Ä‘Æ°á»£c thá»±c hiá»‡n sau khi Ä‘áº¿n thá»i háº¡n cuá»‘i cÃ¹ng.</li></ol><p>ChÃºng tÃ´i cÃ³ thá»ƒ chá»‰ viáº¿t Ä‘iá»u nÃ y trong má»™t láº§n, nhÆ°ng chÃºng tÃ´i sáº½ viáº¿t nÃ³ theo kiá»ƒu tá»« trÃªn xuá»‘ng vÃ  á»§y quyá»n cho má»™t sá»‘ chá»©c nÄƒng trá»£ giÃºp.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">mkValidator dat () ctx =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      mkValidator dat () ctx = traceIfFalse &quot;beneficiary&#x27;s signature missing&quot; signedByBeneficiary &amp;&amp;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                               traceIfFalse &quot;deadline not reached&quot; deadlineReached</span></div><div class="token-line" style="color:#393A34"><span class="token plain">where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      info :: TxInfo</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      info = scriptContextTxInfo ctx</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Äá»ƒ kiá»ƒm tra xem giao dá»‹ch cÃ³ Ä‘Æ°á»£c kÃ½ bá»Ÿi ngÆ°á»i thá»¥ hÆ°á»Ÿng hay khÃ´ng, chÃºng tÃ´i cÃ³ thá»ƒ láº¥y khÃ³a cÃ´ng khai cá»§a ngÆ°á»i thá»¥ hÆ°á»Ÿng tá»« dá»¯ liá»‡u vÃ  chuyá»ƒn nÃ³, cÃ¹ng vá»›i thÃ´ng tin giao dá»‹ch vÃ o <code>txSignedBy</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">signedByBeneficiary :: Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">signedByBeneficiary = txSignedBy info $ beneficiary dat</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>LÃ m tháº¿ nÃ o Ä‘á»ƒ chÃºng tÃ´i kiá»ƒm tra xem thá»i háº¡n Ä‘Ã£ qua?</p><p><img src="/assets/images/pic__00046-91ac81d2e6110ca563ef34a48b448bb4.png"></p><p>HÃ£y xem xÃ©t má»™t giao dá»‹ch cÃ³ giÃ¡ trá»‹ há»£p lá»‡ vÆ°á»£t qua thá»i háº¡n, Ä‘Æ°á»£c hiá»ƒn thá»‹ dÆ°á»›i dáº¡ng pháº¡m vi cao nháº¥t trong biá»ƒu Ä‘á»“ trÃªn.</p><p>Nhá»› láº¡i ráº±ng trÆ°á»›c khi cháº¡y táº­p lá»‡nh trÃ¬nh xÃ¡c thá»±c, cÃ¡c kiá»ƒm tra khÃ¡c Ä‘Æ°á»£c thá»±c hiá»‡n, bao gá»“m cáº£ kiá»ƒm tra thá»i gian. NÃºt kiá»ƒm tra xem thá»i gian hiá»‡n táº¡i cÃ³ náº±m trong pháº¡m vi há»£p lá»‡ cá»§a giao dá»‹ch hay khÃ´ng vÃ  chá»‰ sau Ä‘Ã³ trÃ¬nh xÃ¡c thá»±c má»›i Ä‘Æ°á»£c cháº¡y. VÃ¬ váº­y, chÃºng tÃ´i biáº¿t ráº±ng, náº¿u chÃºng tÃ´i Ä‘ang á»Ÿ trong trÃ¬nh xÃ¡c thá»±c, thá»i gian hiá»‡n táº¡i náº±m á»Ÿ Ä‘Ã¢u Ä‘Ã³ trong khoáº£ng thá»i gian hiá»‡u lá»±c.</p><p>Trong trÆ°á»ng há»£p pháº¡m vi vÆ°á»£t qua thá»i háº¡n, mÃ£ trÃ¬nh xÃ¡c thá»±c khÃ´ng thá»ƒ biáº¿t liá»‡u thá»i Ä‘iá»ƒm hiá»‡n táº¡i lÃ  trÆ°á»›c hay sau thá»i háº¡n. Trong trÆ°á»ng há»£p nÃ y, ngÆ°á»i xÃ¡c nháº­n pháº£i tuyÃªn bá»‘ ráº±ng giao dá»‹ch khÃ´ng há»£p lá»‡.</p><p>Tuy nhiÃªn, vÃ­ dá»¥ thá»© hai trong sÆ¡ Ä‘á»“ lÃ  tá»‘t. ChÃºng tÃ´i váº«n chÆ°a biáº¿t chÃ­nh xÃ¡c thá»i gian hiá»‡n táº¡i lÃ  bao nhiÃªu, nhÆ°ng chÃºng tÃ´i biáº¿t ráº±ng dÃ¹ thá»i gian lÃ  bao nhiÃªu thÃ¬ cÅ©ng sáº½ Ä‘áº¿n sau thá»i háº¡n.</p><p>VÃ¬ váº­y, nhá»¯ng gÃ¬ chÃºng tÃ´i Ä‘ang kiá»ƒm tra lÃ  toÃ n bá»™ khoáº£ng thá»i gian hiá»‡u lá»±c náº±m á»Ÿ bÃªn pháº£i cá»§a thá»i háº¡n. Má»™t cÃ¡ch Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y lÃ  sá»­ dá»¥ng  hÃ m <code>contains</code> Ä‘á»ƒ kiá»ƒm tra xem khoáº£ng thá»i gian hiá»‡u lá»±c cÃ³ Ä‘Æ°á»£c chá»©a Ä‘áº§y Ä‘á»§ trong khoáº£ng thá»i gian báº¯t Ä‘áº§u tá»« thá»i háº¡n vÃ  kÃ©o dÃ i cho Ä‘áº¿n háº¿t thá»i gian hay khÃ´ng. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">deadlineReached :: Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">deadlineReached = contains (from $ deadline dat) $ txInfoValidRange info</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Äiá»u Ä‘Ã³ hoÃ n thÃ nh logic xÃ¡c thá»±c. HÃ£y quan tÃ¢m Ä‘áº¿n má»™t sá»‘ táº¥m boilerplate.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data Vesting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Scripts.ValidatorTypes Vesting where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    type instance DatumType Vesting = VestingDatum</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    type instance RedeemerType Vesting = ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">typedValidator :: Scripts.TypedValidator Vesting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">typedValidator = Scripts.mkTypedValidator @Vesting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $$(PlutusTx.compile [|| mkValidator ||])</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $$(PlutusTx.compile [|| wrap ||])</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    wrap = Scripts.wrapValidator @VestingDatum @()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>ChÃºng tÃ´i sáº½ táº­p trung nhiá»u hÆ¡n vÃ o pháº§n vÃ­ cá»§a script sau, nhÆ°ng Ä‘Ã¢y lÃ  nhá»¯ng thay Ä‘á»•i.</p><p>NgoÃ i ra thÃªm vÃ o tham sá»‘ má»›i <code>LANGUAGE</code> vÃ  má»™t sá»‘ imports bá»• xung, chung tÃ´i cÃ³ táº¡o kiá»ƒu <code>GiveParams</code>, vÃ  sá»­a endpoint <code>grab</code> Ä‘á»ƒ khÃ´ng yÃªu cáº§u tham sá»‘.</p><p>CÃ¡c kiá»ƒu <code>VestingSchema</code> Ä‘á»‹nh nghÄ©a endpoints cÃ¡i mÃ  ChÃºng ta muá»‘n Ä‘á»ƒ lá»™ cho ngÆ°á»i dÃ¹ng. NhÆ° trong vÃ­ dá»¥ cuá»‘i cÃ¹ng cá»§a chÃºng tÃ´i, <code>give</code> sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi ngÆ°á»i dÃ¹ng Ä‘áº·t tiá»n vÃ o há»£p Ä‘á»“ng, sau Ä‘Ã³ <code>grab</code> sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi ngÆ°á»i dÃ¹ng muá»‘n nháº­n tiá»n.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">type VestingSchema =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   .\/ Endpoint &quot;give&quot; GiveParams</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   .\/ Endpoint &quot;grab&quot; ()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Váº­y chÃºng ta cáº§n nhá»¯ng thÃ´ng sá»‘ nÃ o <code>give</code>? Endpoint sáº½ táº¡o má»™t UTxO táº¡i Ä‘á»‹a chá»‰ táº­p lá»‡nh vesting vá»›i má»™t sá»‘ tiá»n vÃ  má»™t má»©c dá»¯ liá»‡u. Náº¿u báº¡n nhá»› láº¡i, datum cá»§a chÃºng tÃ´i chá»©a ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ  thá»i háº¡n. VÃ¬ váº­y, cÃ³ ba pháº§n thÃ´ng tin mÃ  chÃºng ta pháº£i chuyá»ƒn Ä‘áº¿n endpoint <code>give</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data GiveParams = GiveParams</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   { gpBeneficiary :: !PubKeyHash</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , gpDeadline    :: !POSIXTime</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   , gpAmount      :: !Integer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   } deriving (Generic, ToJSON, FromJSON, ToSchema)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p> Endpoint <code>grab</code>  khÃ´ng yÃªu cáº§u báº¥t ká»³ tham sá»‘ nÃ o vÃ¬ ngÆ°á»i thá»¥ hÆ°á»Ÿng sáº½ chá»‰ tÃ¬m cÃ¡c UTxO á»Ÿ Ä‘á»‹a chá»‰ táº­p lá»‡nh vÃ  sau Ä‘Ã³ cÃ³ thá»ƒ kiá»ƒm tra xem há» cÃ³ pháº£i lÃ  ngÆ°á»i thá»¥ hÆ°á»Ÿng hay khÃ´ng vÃ  thá»i háº¡n Ä‘Ã£ qua hay chÆ°a. Náº¿u váº­y, há» cÃ³ thá»ƒ tiÃªu thá»¥ chÃºng.</p><p>HÃ£y nhanh chÃ³ng nhÃ¬n vÃ o endpoint <code>give</code> .</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">give :: AsContractError e =&gt; GiveParams -&gt; Contract w s e ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">give gp = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    let dat = VestingDatum</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                { beneficiary = gpBeneficiary gp</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                , deadline    = gpDeadline gp</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        tx  = mustPayToTheScript dat $ Ada.lovelaceValueOf $ gpAmount gp</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ledgerTx &lt;- submitTxConstraints typedValidator tx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void $ awaitTxConfirmed $ txId ledgerTx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    logInfo @String $ printf &quot;made a gift of %d lovelace to %s with deadline %s&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (gpAmount gp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (show $ gpBeneficiary gp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (show $ gpDeadline gp)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Äáº§u tiÃªn, chÃºng tÃ´i tÃ­nh toÃ¡n dá»¯ liá»‡u mÃ  chÃºng tÃ´i muá»‘n sá»­ dá»¥ng vÃ  chÃºng tÃ´i cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c cáº£ hai pháº§n thÃ´ng tin tá»« <code>GiveParams</code> Ä‘Ã³ Ä‘Æ°á»£c chuyá»ƒn vÃ o hÃ m.</p><p>Sau Ä‘Ã³, Ä‘á»‘i vá»›i giao dá»‹ch, chÃºng tÃ´i thÃªm má»™t rÃ ng buá»™c ráº±ng pháº£i cÃ³ má»™t Ä‘áº§u ra táº¡i Ä‘á»‹a chá»‰ táº­p lá»‡nh nÃ y vá»›i dá»¯ liá»‡u mÃ  chÃºng tÃ´i vá»«a xÃ¡c Ä‘á»‹nh vÃ  má»™t sá»‘ lovelace nháº¥t Ä‘á»‹nh, mÃ  chÃºng tÃ´i cÅ©ng nháº­n Ä‘Æ°á»£c tá»« <code>GiveParams</code>.</p><p>Pháº§n cÃ²n láº¡i cá»§a chá»©c nÄƒng váº«n nhÆ° trÆ°á»›c, chá»‰ vá»›i má»™t thÃ´ng bÃ¡o nháº­t kÃ½ khÃ¡c.</p><p>Endpoint <code>grab</code>  cÃ³ liÃªn quan nhiá»u hÆ¡n má»™t chÃºt.</p><p>CÃ³ thá»ƒ cÃ³ nhiá»u UTxO táº¡i Ä‘á»‹a chá»‰ táº­p lá»‡nh nÃ y vÃ  má»™t sá»‘ trong sá»‘ chÃºng cÃ³ thá»ƒ khÃ´ng phÃ¹ há»£p vá»›i chÃºng tÃ´i, vÃ¬ chÃºng tÃ´i khÃ´ng pháº£i lÃ  ngÆ°á»i thá»¥ hÆ°á»Ÿng hoáº·c vÃ¬ thá»i háº¡n chÆ°a trÃ´i qua. Náº¿u chÃºng tÃ´i cá»‘ gáº¯ng gá»­i má»™t giao dá»‹ch khi khÃ´ng cÃ³ UTxO phÃ¹ há»£p, chÃºng tÃ´i sáº½ tráº£ phÃ­ nhÆ°ng khÃ´ng nháº­n láº¡i Ä‘Æ°á»£c gÃ¬.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">grab :: forall w s e. AsContractError e =&gt; Contract w s e ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">grab = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    now   &lt;- currentTime</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    pkh   &lt;- pubKeyHash &lt;$&gt; ownPubKey</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    utxos &lt;- Map.filter (isSuitable pkh now) &lt;$&gt; utxoAt scrAddress</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if Map.null utxos</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        then logInfo @String $ &quot;no gifts available&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            let orefs   = fst &lt;$&gt; Map.toList utxos</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                lookups = Constraints.unspentOutputs utxos  &lt;&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                          Constraints.otherScript validator</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                tx :: TxConstraints Void Void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                tx      = mconcat [mustSpendScriptOutput oref $ Redeemer $ PlutusTx.toData () | oref &lt;- orefs] &lt;&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                          mustValidateIn (from now)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            ledgerTx &lt;- submitTxConstraintsWith @Void lookups tx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            void $ awaitTxConfirmed $ txId ledgerTx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            logInfo @String $ &quot;collected gifts&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    isSuitable :: PubKeyHash -&gt; POSIXTime -&gt; TxOutTx -&gt; Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    isSuitable pkh now o = case txOutDatumHash $ txOutTxOut o of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        Nothing -&gt; False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        Just h  -&gt; case Map.lookup h $ txData $ txOutTxTx o of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Nothing        -&gt; False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Just (Datum e) -&gt; case PlutusTx.fromData e of</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                Nothing -&gt; False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                Just d  -&gt; beneficiary d == pkh &amp;&amp; deadline d &lt;= now</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Äáº§u tiÃªn, chÃºng tÃ´i láº¥y thá»i gian hiá»‡n táº¡i vÃ  tÃ­nh toÃ¡n bÄƒm khÃ³a cÃ´ng khai cá»§a chÃºng tÃ´i. Sau Ä‘Ã³, chÃºng tÃ´i tra cá»©u táº¥t cáº£ cÃ¡c UTxO táº¡i Ä‘á»‹a chá»‰ nÃ y vÃ  lá»c chÃºng báº±ng cÃ¡ch sá»­ dá»¥ng hÃ m <code>isSuitable</code> trá»£ giÃºp, Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong má»‡nh Ä‘á» <code>where</code>.</p><p>TrÆ°á»›c tiÃªn, nÃ³ kiá»ƒm tra bÄƒm datum vÃ  náº¿u tÃ¬m tháº¥y nÃ³, nÃ³ sáº½ cá»‘ gáº¯ng tÃ¬m kiáº¿m datum tÆ°Æ¡ng á»©ng. Nhá»› láº¡i ráº±ng giao dá»‹ch sáº£n xuáº¥t, trong trÆ°á»ng há»£p <code>give</code> nÃ y khÃ´ng pháº£i cung cáº¥p datum, nÃ³ chá»‰ cáº§n cung cáº¥p bÄƒm datum. Tuy nhiÃªn, trong trÆ°á»ng há»£p cá»§a chÃºng ta, chÃºng ta cáº§n cÃ³ sáºµn dá»¯ liá»‡u cho endpoint <code>grab</code> , vÃ¬ váº­y endpoint <code>give</code> cung cáº¥p datum.</p><p>Náº¿u endpoint <code>grab</code> tÃ¬m tháº¥y datum, nÃ³ pháº£i giáº£i thÃ­ch nÃ³ thÃ nh kiá»ƒu<code>Vesting</code> .</p><p>Náº¿u táº¥t cáº£ nhá»¯ng Ä‘iá»u nÃ y thÃ nh cÃ´ng, chÃºng tÃ´i cÃ³ thá»ƒ kiá»ƒm tra xem chÃºng tÃ´i cÃ³ pháº£i lÃ  ngÆ°á»i thá»¥ hÆ°á»Ÿng hay khÃ´ng vÃ  thá»i háº¡n Ä‘Ã£ qua hay chÆ°a.</p><p>Táº¡i thá»i Ä‘iá»ƒm nÃ y, <code>utxos</code> chá»©a táº¥t cáº£ cÃ¡c UTxO mÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng. Náº¿u chÃºng tÃ´i khÃ´ng tÃ¬m tháº¥y, thÃ¬ chÃºng tÃ´i chá»‰ cáº§n ghi láº¡i má»™t thÃ´ng bÃ¡o cho hiá»‡u á»©ng Ä‘Ã³. Náº¿u cÃ³ Ã­t nháº¥t má»™t giao dá»‹ch, thÃ¬ chÃºng tÃ´i táº¡o má»™t giao dá»‹ch sá»­ dá»¥ng táº¥t cáº£ chÃºng lÃ m Ä‘áº§u vÃ o vÃ  thanh toÃ¡n tiá»n vÃ o vÃ­ cá»§a chÃºng tÃ´i.</p><p>NhÆ° <code>lookups</code>, chÃºng tÃ´i cung cáº¥p danh sÃ¡ch cÃ¡c UTxO cÅ©ng nhÆ° táº­p lá»‡nh trÃ¬nh xÃ¡c thá»±c. Nhá»› láº¡i ráº±ng, Ä‘á»ƒ sá»­ dá»¥ng UTxO táº¡i Ä‘á»‹a chá»‰ nÃ y, giao dá»‹ch chi tiÃªu pháº£i cung cáº¥p táº­p lá»‡nh xÃ¡c thá»±c.</p><p>Sau Ä‘Ã³, chÃºng tÃ´i táº¡o má»™t giao dá»‹ch sá»­ dá»¥ng táº¥t cáº£ cÃ¡c UTxO phÃ¹ há»£p cÃ¹ng vá»›i má»™t rÃ ng buá»™c mÃ  nÃ³ pháº£i xÃ¡c thá»±c trong Ä‘Ã³ <code>Interval</code> kÃ©o dÃ i tá»« slot hiá»‡n táº¡i cho Ä‘áº¿n háº¿t thá»i gian. Náº¿u chÃºng tÃ´i khÃ´ng cung cáº¥p khoáº£ng thá»i gian á»Ÿ Ä‘Ã¢y, thÃ¬ viá»‡c xÃ¡c thá»±c sáº½ khÃ´ng thÃ nh cÃ´ng, vÃ¬ khoáº£ng thá»i gian máº·c Ä‘á»‹nh lÃ  tá»« ban Ä‘áº§u cho Ä‘áº¿n khi káº¿t thÃºc thá»i gian. XÃ¡c thá»±c trÃªn chuá»—i sáº½ tá»« chá»‘i Ä‘iá»u nÃ y vÃ¬ nÃ³ cáº§n má»™t khoáº£ng thá»i gian Ä‘Æ°á»£c chá»©a Ä‘áº§y Ä‘á»§ trong khoáº£ng thá»i gian kÃ©o dÃ i tá»« thá»i háº¡n cho Ä‘áº¿n khi káº¿t thÃºc thá»i gian.</p><p>ChÃºng tÃ´i cÃ³ thá»ƒ sá»­ dá»¥ng  <code>Interval</code> <code>now</code>, nhÆ°ng náº¿u cÃ³ báº¥t ká»³ sá»± cá»‘ nÃ o, cháº³ng háº¡n nhÆ° sá»± cháº­m trá»… cá»§a máº¡ng vÃ  giao dá»‹ch Ä‘áº¿n má»™t nÃºt muá»™n hÆ¡n má»™t hoáº·c hai vá»‹ trÃ­, thÃ¬ quÃ¡ trÃ¬nh xÃ¡c thá»±c sáº½ khÃ´ng hoáº¡t Ä‘á»™ng ná»¯a.</p><p>vÃ  giá», chÃºng ta chá»‰ táº­p há»£p cÃ¡c endpoints.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">endpoints :: Contract () VestingSchema Text ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">endpoints = (give&#x27; `select` grab&#x27;) &gt;&gt; endpoints</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    give&#x27; = endpoint @&quot;give&quot; &gt;&gt;= give</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    grab&#x27; = endpoint @&quot;grab&quot; &gt;&gt;  grab</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Sau Ä‘Ã³, cÃ³ má»™t sá»‘ táº¥m báº£ng Ä‘Æ°á»£c sá»­ dá»¥ng trong playground.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">mkSchemaDefinitions &#x27;&#x27;VestingSchema</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mkKnownCurrencies []</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="in-the-playground"></a>In the playground<a class="hash-link" href="#in-the-playground" title="Direct link to heading">#</a></h3><p>Äáº§u tiÃªn, hÃ£y thÃªm má»™t vÃ­ thá»© ba. ChÃºng tÃ´i sáº½ táº¡o má»™t ká»‹ch báº£n trong Ä‘Ã³ VÃ­ 1 táº¡o hai quÃ  táº·ng cho VÃ­ 2 vá»›i thá»i háº¡n khÃ¡c nhau vÃ  cÅ©ng táº¡o má»™t quÃ  táº·ng cho VÃ­ 3.</p><p><img src="/assets/images/pic__00043-90836e56ce8338b63ac410965d2cc39c.png"></p><p>ThÃ´ng thÆ°á»ng, cÃ³ thá»ƒ gá»­i cáº£ hai givegiao dá»‹ch trong cÃ¹ng má»™t vá»‹ trÃ­, nhÆ°ng cÃ¡ch mÃ£ cá»§a chÃºng tÃ´i Ä‘Æ°á»£c triá»ƒn khai, chÃºng tÃ´i chá» xÃ¡c nháº­n, cÃ³ nghÄ©a lÃ  chÃºng tÃ´i cáº§n thÃªm hÃ nh Ä‘á»™ng chá». ÄÃ¢y cÃ³ thá»ƒ khÃ´ng pháº£i lÃ  cÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ lÃ m Ä‘iá»u Ä‘Ã³, nhÆ°ng Ä‘Ã³ lÃ  cÃ¡ch lÃ m trong thá»i Ä‘iá»ƒm hiá»‡n táº¡i.</p><p><img src="/assets/images/pic__00044-ae789cd0b18189a70d1c764d465b5002.png"></p><p>á» Ä‘Ã¢y chÃºng tÃ´i gáº·p pháº£i váº¥n Ä‘á» Ä‘áº§u tiÃªn cá»§a chÃºng tÃ´i. ChÃºng tÃ´i cáº§n cung cáº¥p Ä‘á»‹a chá»‰ ngÆ°á»i thá»¥ hÆ°á»Ÿng, nhÆ°ng khÃ´ng cÃ³ cÃ¡ch nÃ o trong sÃ¢n chÆ¡i Ä‘á»ƒ láº¥y mÃ£ bÄƒm khÃ³a cÃ´ng khai cá»§a vÃ­.</p><p>NhÆ°ng chÃºng ta cÃ³ thá»ƒ láº¥y nÃ³ tá»« REPL.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week03.Homework1&gt; :l src/Week03/Vesting.hs </span></div><div class="token-line" style="color:#393A34"><span class="token plain">Ok, one module loaded.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Week03.Vesting&gt; import Ledger</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Week03.Vesting&gt; import Wallet.Emulator</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Week03.Vesting&gt; pubKeyHash $ walletPubKey $ Wallet 2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">39f713d0a644253f04529421b9f51b9b08979d08295959c4f3990ee617f5139f</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Week03.Vesting&gt; pubKeyHash $ walletPubKey $ Wallet 3</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dac073e0123bdea59dd9b3bda9cf6037f63aca82627d7abcd5c4ac29dd74003e</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><img src="/assets/images/pic__00047-e701ccc70650672796705049bc861960.png"></p><p>Váº¥n Ä‘á» tiáº¿p theo lÃ  thá»i háº¡n. Trong bÃ i giáº£ng trÆ°á»›c, chÃºng ta Ä‘Ã£ biáº¿t cÃ¡ch chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c vá»‹ trÃ­ vÃ  thá»i gian POSIX. Äiá»u nÃ y Ä‘Ã£ thay Ä‘á»•i. TrÆ°á»›c Ä‘Ã¢y, báº¡n chá»‰ cáº§n má»™t vá»‹ trÃ­ vÃ  xuáº¥t hiá»‡n thá»i gian POSIX. BÃ¢y giá» cÃ³ má»™t cuá»™c tranh cÃ£i thá»© hai.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Week03.Vesting&gt; import Ledger.TimeSlot </span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Ledger.TimeSlot Week03.Vesting&gt; :t slotToBeginPOSIXTime</span></div><div class="token-line" style="color:#393A34"><span class="token plain">slotToBeginPOSIXTime :: SlotConfig -&gt; Slot -&gt; POSIXTime</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>CÅ©ng cÃ³ nhá»¯ng phiÃªn báº£n slotToBeginPOSIXTimecÃ³ thá»i gian báº¯t Ä‘áº§u vÃ  káº¿t thÃºc. Äiá»u nÃ y lÃ  do má»™t thá»i Ä‘iá»ƒm khÃ´ng chá»‰ lÃ  má»™t thá»i Ä‘iá»ƒm, mÃ  lÃ  má»™t khoáº£ng thá»i gian.</p><p>Váº­y Ä‘Ã¢y lÃ  <code>SlotConfig</code>?</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Ledger.TimeSlot Week03.Vesting&gt; :i SlotConfig </span></div><div class="token-line" style="color:#393A34"><span class="token plain">type SlotConfig :: *</span></div><div class="token-line" style="color:#393A34"><span class="token plain">data SlotConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  = SlotConfig {scSlotLength :: Integer, scZeroSlotTime :: POSIXTime}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        -- Defined in â€˜Ledger.TimeSlotâ€™</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Eq SlotConfig -- Defined in â€˜Ledger.TimeSlotâ€™</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Show SlotConfig -- Defined in â€˜Ledger.TimeSlotâ€™</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>NÃ³ tÃ­nh theo Ä‘á»™ dÃ i vá»‹ trÃ­ vÃ  thá»i gian mÃ  vá»‹ trÃ­ sá»‘ 0 báº¯t Ä‘áº§u.</p><p>VÃ¬ váº­y, bÃ¢y giá» chÃºng ta pháº£i tÃ¬m ra nhá»¯ng gÃ¬ SlotConfigÄ‘á»ƒ sá»­ dá»¥ng cho sÃ¢n chÆ¡i. May máº¯n thay, nÃ³ lÃ  máº·c Ä‘á»‹nh. Äá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³, chÃºng ta cáº§n sá»­ dá»¥ng <code>Data.Default</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Ledger.TimeSlot Week03.Vesting&gt; import Data.Default</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Ledger.TimeSlot Data.Default Week03.Vesting&gt; def :: SlotConfig</span></div><div class="token-line" style="color:#393A34"><span class="token plain">SlotConfig {scSlotLength = 1000, scZeroSlotTime = POSIXTime {getPOSIXTime = 1596059091000}}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>BÃ¢y giá» chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>slotToBeginPOSIXTime</code> vá»›i cáº¥u hÃ¬nh máº·c Ä‘á»‹nh Ä‘á»ƒ láº¥y thá»i gian POSIX cho vÃ¹ng 10 vÃ  vÃ¹ng 20.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Ledger.TimeSlot Data.Default Week03.Vesting&gt; slotToBeginPOSIXTime def 10</span></div><div class="token-line" style="color:#393A34"><span class="token plain">POSIXTime {getPOSIXTime = 1596059101000}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prelude Ledger Wallet.Emulator Ledger.TimeSlot Data.Default Week03.Vesting&gt; slotToBeginPOSIXTime def 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">POSIXTime {getPOSIXTime = 1596059111000}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>VÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng chÃºng trong sÃ¢n chÆ¡i. ChÃºng tÃ´i sáº½ sá»­ dá»¥ng vá»‹ trÃ­ 10 lÃ m thá»i háº¡n cho <code>give</code> vÃ­ Ä‘áº§u tiÃªn vÃ  thá»© ba vÃ  vá»‹ trÃ­ 20 cho <code>give</code> vÃ­ thá»© hai. ChÃºng tÃ´i cÅ©ng sáº½ Ä‘Æ°a ra 10 Ada trong má»—i trÆ°á»ng há»£p. </p><p><img src="/assets/images/pic__00048-d7da99592a35e7501ca80f88da6366d0.png"></p><p>HÃ£y táº¡o má»™t ká»‹ch báº£n mÃ  má»i thá»© Ä‘á»u hoáº¡t Ä‘á»™ng. VÃ­ 3 nháº­n á»Ÿ vá»‹ trÃ­ 10 khi thá»i háº¡n cho VÃ­ 3 Ä‘Ã£ qua vÃ  VÃ­ 2 láº¥y á»Ÿ vá»‹ trÃ­ 20, khi cáº£ hai thá»i háº¡n cá»§a VÃ­ 2 Ä‘Ã£ qua. ChÃºng tÃ´i sáº½ sá»­ dá»¥ng <code>Wait Until..</code> tÃ¹y chá»n cho viá»‡c nÃ y.</p><p><img src="/assets/images/pic__00049-d73f83f7294dd0187da15f4eaa3c7247.png"></p><p>Sau khi Ä‘Ã¡nh giÃ¡, Ä‘áº§u tiÃªn chÃºng ta tháº¥y giao dá»‹ch Genesis.</p><p><img src="/assets/images/pic__00050-cd1459efe52e84b5c3fcebd8fb077b08.png"></p><p>Náº¿u chÃºng ta xem xÃ©t giao dá»‹ch tiáº¿p theo, chÃºng ta tháº¥y quÃ  táº·ng tá»« VÃ­ 1 Ä‘áº¿n VÃ­ 2 vá»›i thá»i háº¡n lÃ  10. Táº¡i Ä‘Ã¢y, mÆ°á»i Ada bá»‹ khÃ³a Ä‘á»‹a chá»‰ táº­p lá»‡nh.</p><p><img src="/assets/images/pic__00051-74d33494d0e068519bd23ae9b42ae1ca.png"></p><p>Giao dá»‹ch tiáº¿p theo lÃ  quÃ  táº·ng tá»« VÃ­ 1 Ä‘áº¿n VÃ­ 2 vá»›i thá»i háº¡n lÃ  20. Má»™t UTxO má»›i hiá»‡n Ä‘Ã£ Ä‘Æ°á»£c táº¡o táº¡i Ä‘á»‹a chá»‰ táº­p lá»‡nh vá»›i mÆ°á»i Ada.</p><p><img src="/assets/images/pic__00052-baa346bdcdad8c6a6cf40acf94e227d3.png"></p><p>VÃ  mÃ³n quÃ  thá»© ba, láº§n nÃ y lÃ  VÃ­ 3, vá»›i thá»i háº¡n lÃ  10. VÃ­ 1 hiá»‡n cÃ³ khoáº£ng 70 Ada vÃ  má»™t UTxO khÃ¡c Ä‘Æ°á»£c táº¡o vá»›i 10 Ada bá»‹ khÃ³a táº¡i Ä‘á»‹a chá»‰ táº­p lá»‡nh.</p><p><img src="/assets/images/pic__00053-95169853875b3a94d47aacb5be95d8f1.png"></p><p>Táº¡i vá»‹ trÃ­ sá»‘ 10, VÃ­ tiá»n 3 láº¥y thÃ nh cÃ´ng. UTxO thá»© ba lÃ  Ä‘áº§u vÃ o, má»™t sá»‘ khoáº£n phÃ­ Ä‘Æ°á»£c thanh toÃ¡n vÃ  sau Ä‘Ã³ pháº§n cÃ²n láº¡i cá»§a cuá»™c tÃ¬nh Ä‘Æ°á»£c gá»­i Ä‘áº¿n VÃ­ 3.</p><p><img src="/assets/images/pic__00054-914e9e6153e10e5200376f911ef80451.png"></p><p>Sau Ä‘Ã³, táº¡i vá»‹ trÃ­ 20, Wallet 2 láº¥y thÃ nh cÃ´ng cáº£ hai UTxO mÃ  há» lÃ  ngÆ°á»i thá»¥ hÆ°á»Ÿng. Láº§n nÃ y phÃ­ cao hÆ¡n vÃ¬ pháº£i cháº¡y hai trÃ¬nh xÃ¡c thá»±c.</p><p><img src="/assets/images/pic__00055-9d7a06572c0cabe917a527aa359cf8e8.png"></p><p>Sá»‘ dÆ° cuá»‘i cÃ¹ng pháº£n Ã¡nh nhá»¯ng thay Ä‘á»•i.</p><p><img src="/assets/images/pic__00056-ffd977106823023ce72d426f5bf57051.png"></p><p>BÃ¢y giá» chÃºng ta hÃ£y xem xÃ©t trÆ°á»ng há»£p xáº£y ra quÃ¡ sá»›m. ChÃºng tÃ´i sáº½ táº¡o cho Wallet 2 láº¥y á»Ÿ vá»‹ trÃ­ 15 thay vÃ¬ vá»‹ trÃ­ 20.</p><p><img src="/assets/images/pic__00010-86ac7d37c76a594b6967b6f7648e5335.png"></p><p>BÃ¢y giá» chÃºng ta tháº¥y ráº±ng cÃ¡c giao dá»‹ch Ä‘áº§u tiÃªn giá»‘ng nhau, nhÆ°ng giao dá»‹ch cuá»‘i cÃ¹ng táº¡i vá»‹ trÃ­ 15 chá»‰ cÃ³ má»™t Ä‘áº§u vÃ o, vÃ¬ UTxO thá»© hai chÆ°a cÃ³ sáºµn.</p><p><img src="/assets/images/pic__00057-deaf409949adb584abc3ce5ca4253d5a.png"></p><p>VÃ  chÃºng ta cÃ³ thá»ƒ tháº¥y ráº±ng cÃ³ 10 Ada váº«n bá»‹ khÃ³a táº¡i Ä‘á»‹a chá»‰ táº­p lá»‡nh.</p><p><img src="/assets/images/pic__00057-deaf409949adb584abc3ce5ca4253d5a.png"></p><p>MÃ£ off-chain cá»§a chÃºng tÃ´i Ä‘Æ°á»£c viáº¿t theo cÃ¡ch mÃ  nÃ³ sáº½ chá»‰ gá»­i má»™t giao dá»‹ch náº¿u cÃ³ UTxO phÃ¹ há»£p cÃ³ thá»ƒ Ä‘Æ°á»£c láº¥y. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng tÃ´i khÃ´ng thá»±c sá»± sá»­ dá»¥ng trÃ¬nh xÃ¡c thá»±c vÃ¬ chÃºng tÃ´i chá»‰ gá»­i cÃ¡c giao dá»‹ch Ä‘áº¿n chuá»—i khá»‘i sáº½ vÆ°á»£t qua xÃ¡c thá»±c.</p><p>Náº¿u báº¡n muá»‘n kiá»ƒm tra trÃ¬nh xÃ¡c thá»±c, báº¡n cÃ³ thá»ƒ sá»­a Ä‘á»•i mÃ£ vÃ­ Ä‘á»ƒ Ä‘iá»ƒm cuá»‘i láº¥y cá»‘ gáº¯ng láº¥y má»i thá»© vÃ  sau Ä‘Ã³ xÃ¡c thá»±c sáº½ khÃ´ng thÃ nh cÃ´ng náº¿u báº¡n khÃ´ng pháº£i lÃ  ngÆ°á»i thá»¥ hÆ°á»Ÿng hoáº·c chÆ°a Ä‘áº¿n thá»i háº¡n.</p><p>Báº¡n cáº§n lÆ°u Ã½ ráº±ng báº¥t ká»³ ai cÅ©ng cÃ³ thá»ƒ viáº¿t mÃ£ ngoÃ i chuá»—i. VÃ¬ váº­y, máº·c dÃ¹ nÃ³ hoáº¡t Ä‘á»™ng ngay bÃ¢y giá» miá»…n lÃ  báº¡n sá»­ dá»¥ng grabÄ‘iá»ƒm cuá»‘i mÃ  chÃºng tÃ´i Ä‘Ã£ tá»± viáº¿t, ai Ä‘Ã³ cÃ³ thá»ƒ viáº¿t má»™t Ä‘oáº¡n mÃ£ off-chain khÃ¡c khÃ´ng lá»c cÃ¡c UTxO nhÆ° chÃºng tÃ´i Ä‘Ã£ lÃ m. Trong trÆ°á»ng há»£p nÃ y, náº¿u trÃ¬nh xÃ¡c nháº­n khÃ´ng Ä‘Ãºng, Ä‘iá»u gÃ¬ Ä‘Ã³ cÃ³ thá»ƒ sai khá»§ng khiáº¿p.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="vÃ­-dá»¥-2---parameterized-contract"></a>VÃ­ dá»¥ 2 - Parameterized Contract<a class="hash-link" href="#vÃ­-dá»¥-2---parameterized-contract" title="Direct link to heading">#</a></h2><p>ChÃºng ta sáº½ báº¯t Ä‘áº§u vÃ­ dá»¥ tiáº¿p theo báº±ng cÃ¡ch sao chÃ©p mÃ£ tá»« vÃ­ dá»¥ vesting vÃ o má»™t mÃ´-Ä‘un má»›i cÃ³ tÃªn <code>Week03.Parameterized</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="on-chain"></a>On-Chain<a class="hash-link" href="#on-chain" title="Direct link to heading">#</a></h3><p>LÆ°u Ã½ ráº±ng trong vÃ­ dá»¥ vesting, chÃºng tÃ´i Ä‘Ã£ sá»­ dá»¥ng kiá»ƒu <code>Vesting</code>  lÃ m datum, nhÆ°ng nÃ³ chá»‰ Ä‘Æ°á»£c sá»­a chá»¯a, nÃ³ khÃ´ng thay Ä‘á»•i. NgoÃ i ra, chÃºng tÃ´i cÃ³ thá»ƒ Ä‘Æ°a nÃ³ vÃ o há»£p Ä‘á»“ng, cÃ³ thá»ƒ nÃ³i, Ä‘á»ƒ chÃºng tÃ´i cÃ³ má»™t há»£p Ä‘á»“ng mÃ  báº£n thÃ¢n táº­p lá»‡nh Ä‘Ã£ chá»©a thÃ´ng tin vá» ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ  thá»i háº¡n.</p><p>Táº¥t cáº£ cÃ¡c vÃ­ dá»¥ vá» há»£p Ä‘á»“ng mÃ  chÃºng tÃ´i Ä‘Ã£ tháº¥y cho Ä‘áº¿n nay Ä‘Ã£ Ä‘Æ°á»£c sá»­a chá»¯a. ChÃºng tÃ´i Ä‘Ã£ sá»­ dá»¥ng <code>TypedValidator</code> lÃ m háº±ng sá»‘ thá»i gian biÃªn dá»‹ch. Ã tÆ°á»Ÿng cá»§a táº­p lá»‡nh Ä‘Æ°á»£c tham sá»‘ hÃ³a lÃ  báº¡n cÃ³ thá»ƒ cÃ³ má»™t tham sá»‘ vÃ  tÃ¹y thuá»™c vÃ o giÃ¡ trá»‹ cá»§a tham sá»‘, báº¡n nháº­n Ä‘Æ°á»£c cÃ¡c giÃ¡ trá»‹ khÃ¡c nhau cá»§a <code>TypedValidator</code>.</p><p>SVÃ¬ váº­y, thay vÃ¬ xÃ¡c Ä‘á»‹nh má»™t táº­p lá»‡nh, vá»›i má»™t Ä‘á»‹a chá»‰ táº­p lá»‡nh duy nháº¥t, vá»›i táº¥t cáº£ cÃ¡c UTxO á»Ÿ cÃ¹ng má»™t Ä‘á»‹a chá»‰, báº¡n cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh má»™t há» táº­p lá»‡nh Ä‘Æ°á»£c tham sá»‘ hÃ³a bá»Ÿi má»™t tham sá»‘ nháº¥t Ä‘á»‹nh. Trong trÆ°á»ng há»£p cá»§a chÃºng tÃ´i, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  cÃ¡c UTxO cho nhá»¯ng ngÆ°á»i thá»¥ hÆ°á»Ÿng khÃ¡c nhau vÃ  / hoáº·c thá»i háº¡n sáº½ lÃ  má»™t Ä‘á»‹a chá»‰ táº­p lá»‡nh khÃ¡c, vÃ¬ chÃºng sáº½ cÃ³ trÃ¬nh xÃ¡c thá»±c Ä‘Æ°á»£c tham sá»‘ hÃ³a cá»¥ thá»ƒ cho cÃ¡c tham sá»‘ cá»§a há» thay vÃ¬ cá»¥ thá»ƒ cho dá»¯ liá»‡u cá»§a UTxO.</p><p>ChÃºng tÃ´i sáº½ trÃ¬nh bÃ y cÃ¡ch thá»±c hiá»‡n Ä‘iá»u nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng má»™t tham sá»‘ thay vÃ¬ sá»­ dá»¥ng sá»‘ liá»‡u cho ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ  giÃ¡ trá»‹ thá»i háº¡n.</p><p>HÃ£y báº¯t Ä‘áº§u báº±ng cÃ¡ch Ä‘á»•i tÃªn <code>VestingDatum</code> thÃ nh má»™t cÃ¡i gÃ¬ Ä‘Ã³ phÃ¹ há»£p hÆ¡n.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data VestingParam = VestingParam</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      { beneficiary :: PubKeyHash</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      , deadline    :: POSIXTime</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      } deriving Show</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>ChÃºng tÃ´i cÅ©ng sáº½ xÃ³a <code>unstableMakeIsData</code> vÃ¬ chÃºng tÃ´i khÃ´ng cáº§n nÃ³ ná»¯a.</p><p>LÃ½ do chÃºng ta khÃ´ng cáº§n nÃ³, lÃ  vÃ¬ chÃºng ta sáº½ sá»­ dá»¥ng <code>()</code> cho datum trong hÃ m  <code>mkValidator</code>. Táº¥t cáº£ thÃ´ng tin chÃºng tÃ´i yÃªu cáº§u sáº½ náº±m trong má»™t Ä‘á»‘i sá»‘ má»›i <code>mkValidator</code>, thuá»™c loáº¡i <code>VestingParam</code> mÃ  chÃºng tÃ´i thÃªm vÃ o á»Ÿ Ä‘áº§u danh sÃ¡ch cÃ¡c Ä‘á»‘i sá»‘.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{-# INLINABLE mkValidator #-}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mkValidator :: VestingParam -&gt; () -&gt; () -&gt; ScriptContext -&gt; Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mkValidator p () () ctx = traceIfFalse &quot;beneficiary&#x27;s signature missing&quot; signedByBeneficiary &amp;&amp;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                          traceIfFalse &quot;deadline not reached&quot; deadlineReached</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    info :: TxInfo</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    info = scriptContextTxInfo ctx</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    signedByBeneficiary :: Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    signedByBeneficiary = txSignedBy info $ beneficiary p</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    deadlineReached :: Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    deadlineReached = contains (from $ deadline p) $ txInfoValidRange info</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>ChÃºng tÃ´i cÅ©ng thay Ä‘á»•i kiá»ƒu <code>Vesting</code> Ä‘á»ƒ pháº£n Ã¡nh sá»± thay Ä‘á»•i Ä‘á»‘i vá»›i datum.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data Vesting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">instance Scripts.ValidatorTypes Vesting where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    type instance DatumType Vesting = ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    type instance RedeemerType Vesting = ()     </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>BÃ¢y giá», <code>TypedValidator</code> khÃ´ng cÃ²n lÃ  má»™t giÃ¡ trá»‹ khÃ´ng Ä‘á»•i. Thay vÃ o Ä‘Ã³, nÃ³ sáº½ nháº­n má»™t tham sá»‘.</p><p>Nhá»› láº¡i ráº±ng hÃ m <code>mkTypedValidator</code>  yÃªu cáº§u lÃ  Ä‘á»‘i sá»‘ Ä‘áº§u tiÃªn cá»§a nÃ³ mÃ£ Ä‘Ã£ biÃªn dá»‹ch cá»§a má»™t hÃ m nháº­n ba Ä‘á»‘i sá»‘ vÃ  tráº£ vá» má»™t <code>Bool</code>. NhÆ°ng bÃ¢y giá», nÃ³ cÃ³ bá»‘n Ä‘á»‘i sá»‘, vÃ¬ váº­y chÃºng ta cáº§n tÃ­nh Ä‘áº¿n Ä‘iá»u Ä‘Ã³.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">typedValidator :: VestingParam -&gt; Scripts.TypedValidator Vesting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">typedValidator p = Scripts.mkTypedValidator @Vesting      </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>BÃ¢y giá», nhá»¯ng gÃ¬ chÃºng tÃ´i muá»‘n lÃ m lÃ  má»™t cÃ¡i gÃ¬ Ä‘Ã³ nhÆ° tháº¿ nÃ y, chuyá»ƒn tham sá»‘ má»›i <code>p</code> vÃ o <code>mkValidator</code> Ä‘á»ƒ mÃ£ Ä‘Æ°á»£c biÃªn dá»‹ch trong dáº¥u ngoáº·c Oxford sáº½ cÃ³ kiá»ƒu chÃ­nh xÃ¡c.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">-- this won&#x27;t work</span></div><div class="token-line" style="color:#393A34"><span class="token plain">$$(PlutusTx.compile [|| mkValidator p ||])</span></div><div class="token-line" style="color:#393A34"><span class="token plain">$$(PlutusTx.compile [|| wrap ||])</span></div><div class="token-line" style="color:#393A34"><span class="token plain">where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">wrap = Scripts.wrapValidator @() @()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>MÃ£ nÃ y sáº½ khÃ´ng hoáº¡t Ä‘á»™ng, nhÆ°ng trÆ°á»›c khi chÃºng tÃ´i Ä‘iá»u tra, hÃ£y Ä‘á»ƒ mÃ£ nhÆ° hiá»‡n táº¡i vÃ  thá»±c hiá»‡n thÃªm má»™t sá»‘ thay Ä‘á»•i Ä‘á»‘i vá»›i pháº§n cÃ²n láº¡i cá»§a mÃ£.</p><p><code>validator</code> bÃ¢y giá» sáº½ nháº­n má»™t <code>VestingParam</code> vÃ  sáº½ tráº£ vá» má»™t hÃ m Ä‘Ã£ soáº¡n. HÃ m Ä‘Æ°á»£c tráº£ vá» cÃ³ tÃ¡c dá»¥ng mÃ  báº¥t ká»³ tham sá»‘ nÃ o Ä‘Æ°á»£c truyá»n Ä‘áº¿n <code>validator</code> bÃ¢y giá» sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n hÃ m <code>typedValidator</code> má»™t cÃ¡ch hiá»‡u quáº£ , giÃ¡ trá»‹ tráº£ vá» cá»§a chÃºng sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n <code>validatorScript</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">validator :: VestingParam -&gt; Validator</span></div><div class="token-line" style="color:#393A34"><span class="token plain">validator = Scripts.validatorScript . typedValidator</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>VÃ  tÆ°Æ¡ng tá»± Ä‘á»‘i vá»›i <code>valHash</code> vÃ  <code>scrAddress</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">valHash :: VestingParam -&gt; Ledger.ValidatorHash</span></div><div class="token-line" style="color:#393A34"><span class="token plain">valHash = Scripts.validatorHash . typedValidator</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">scrAddress :: VestingParam -&gt; Ledger.Address</span></div><div class="token-line" style="color:#393A34"><span class="token plain">scrAddress = scriptAddress . validator</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>BÃ¢y giá», chÃºng ta hÃ£y tÃ¬m hiá»ƒu nhá»¯ng gÃ¬ sai vá»›i hÃ m <code>typedValidator</code> .</p><p>Náº¿u chÃºng tÃ´i cá»‘ gáº¯ng khá»Ÿi cháº¡y REPL, chÃºng tÃ´i sáº½ gáº·p lá»—i biÃªn dá»‹ch.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">GHC Core to PLC plugin: E043:Error: Reference to a name which is not a local, a builtin, or an external INLINABLE function: Variable p</span></div><div class="token-line" style="color:#393A34"><span class="token plain">No unfolding</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Context: Compiling expr: p</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Context: Compiling expr: Week03.Parameterized.mkValidator p</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Context: Compiling expr at &quot;plutus-pioneer-program-week03-0.1.0.0-inplace:Week03.Parameterized:(67,10)-(67,48)&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Váº¥n Ä‘á» lÃ  dÃ²ng nÃ y.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">-- this won&#x27;t work</span></div><div class="token-line" style="color:#393A34"><span class="token plain">$$(PlutusTx.compile [|| mkValidator p ||])</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Nhá»› láº¡i ráº±ng má»i thá»© bÃªn trong dáº¥u ngoáº·c [] pháº£i Ä‘Æ°á»£c biáº¿t rÃµ rÃ ng táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. ThÃ´ng thÆ°á»ng, nÃ³ tháº­m chÃ­ sáº½ cáº§n táº¥t cáº£ mÃ£ Ä‘Æ°á»£c viáº¿t rÃµ rÃ ng, nhÆ°ng báº±ng cÃ¡ch sá»­ dá»¥ng thá»‘ng sá»‘ <code>INLINABLE</code> trong hÃ m <code>mkValidator</code>, chÃºng ta cÃ³ thá»ƒ tham chiáº¿u hÃ m Ä‘á»ƒ thay tháº¿. Tuy nhiÃªn, nÃ³ váº«n pháº£i Ä‘Æ°á»£c biáº¿t táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch, vÃ¬ Ä‘Ã³ lÃ  cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Template Haskell - nÃ³ Ä‘Æ°á»£c thá»±c thi trÆ°á»›c trÃ¬nh biÃªn dá»‹ch chÃ­nh.</p><p> <code>p</code> khÃ´ng biáº¿t Ä‘áº¿n lÃºc biÃªn dá»‹ch, bá»Ÿi vÃ¬ chÃºng tÃ´i cÃ³ Ã½ Ä‘á»‹nh cung cáº¥p nÃ³ khi cháº¡y. May máº¯n thay, cÃ³ má»™t cÃ¡ch Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y.</p><p>Vá» phÃ­a Haskell, chÃºng tÃ´i cÃ³ hÃ m <code>mkValidator</code> cá»§a mÃ¬nh vÃ  chÃºng tÃ´i cÃ³ <code>p</code> kiá»ƒu <code>VestingParam</code>. ChÃºng tÃ´i cÃ³ thá»ƒ biÃªn dá»‹ch <code>mkValidator</code> sang Plutus core, nhÆ°ng chÃºng tÃ´i khÃ´ng thá»ƒ biÃªn dá»‹ch <code>p</code> sang Plutus core vÃ¬ chÃºng tÃ´i khÃ´ng biáº¿t nÃ³ lÃ  gÃ¬. NhÆ°ng, náº¿u chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng phiÃªn báº£n Ä‘Ã£ biÃªn dá»‹ch <code>p</code>, chÃºng ta cÃ³ thá»ƒ Ã¡p dá»¥ng phiÃªn báº£n Ä‘Ã£ biÃªn dá»‹ch nÃ y cho phiÃªn báº£n Ä‘Ã£ biÃªn dá»‹ch mkValidatorvÃ  Ä‘iá»u nÃ y sáº½ mang láº¡i cho chÃºng ta nhá»¯ng gÃ¬ chÃºng ta muá»‘n.</p><p>Äiá»u nÃ y dÆ°á»ng nhÆ° khÃ´ng giáº£i quyáº¿t Ä‘Æ°á»£c gÃ¬, bá»Ÿi vÃ¬ chÃºng tÃ´i váº«n cáº§n má»™t phiÃªn báº£n Ä‘Ã£ biÃªn dá»‹ch <code>p</code> vÃ  chÃºng tÃ´i cÃ³ cÃ¹ng má»™t váº¥n Ä‘á» <code>p</code> chÆ°a Ä‘Æ°á»£c biáº¿t táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch.</p><p>Tuy nhiÃªn, <code>p</code> pkhÃ´ng pháº£i lÃ  má»™t sá»‘ mÃ£ Haskell tÃ¹y Ã½, mÃ  lÃ  dá»¯ liá»‡u, vÃ¬ váº­y nÃ³ khÃ´ng chá»©a báº¥t ká»³ loáº¡i chá»©c nÄƒng nÃ o. Náº¿u chÃºng ta thá»±c hiá»‡n kiá»ƒu cá»§a <code>p</code> thá»ƒ hiá»‡n cá»§a lá»›p kiá»ƒu Ä‘Æ°á»£c gá»i <code>Lift</code>. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>liftCode</code> Ä‘á»ƒ biÃªn dá»‹ch <code>p</code> trong thá»i gian biÃªn dá»‹ch sang Plutus Core vÃ  sau Ä‘Ã³, báº±ng cÃ¡ch sá»­ dá»¥ng <code>applyCode</code> chÃºng ta cÃ³ thá»ƒ Ã¡p dá»¥ng Plutus Core <code>p</code>  cho Plutus Core <code>mkValidator</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="lá»›p-lift"></a>Lá»›p Lift<a class="hash-link" href="#lá»›p-lift" title="Direct link to heading">#</a></h4><p>ChÃºng ta hÃ£y nhÃ¬n sÆ¡ qua vá» lá»›p <code>Lift</code>  NÃ³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong gÃ³i plutus-tx.</p><p><code>plutus-tx</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">module PlutusTx.Lift.Class</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>NÃ³ chá»‰ cÃ³ má»™t chá»©c nÄƒng <code>Lift</code>. Tuy nhiÃªn, chÃºng tÃ´i sáº½ khÃ´ng sá»­ dá»¥ng chá»©c nÄƒng nÃ y trá»±c tiáº¿p</p><p>Táº§m quan trá»ng cá»§a lá»›p lÃ  nÃ³ cho phÃ©p chÃºng ta, trong thá»i gian cháº¡y,  cÃ¡c giÃ¡ trá»‹ lift cá»§a Haskell thÃ nh cÃ¡c giÃ¡ trá»‹ táº­p lá»‡nh Plutus tÆ°Æ¡ng á»©ng. VÃ  Ä‘Ã¢y chÃ­nh xÃ¡c lÃ  nhá»¯ng gÃ¬ chÃºng ta cáº§n Ä‘á»ƒ chuyá»ƒn tham sá»‘ cá»§a mÃ¬nh <code>p</code> thÃ nh mÃ£.</p><p>ChÃºng ta sáº½ sá»­ dá»¥ng má»™t hÃ m khÃ¡c, Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong cÃ¹ng má»™t gÃ³i nhÆ°ng trong má»™t mÃ´-Ä‘un khÃ¡c.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">module PlutusTx.Lift</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>HÃ m chÃºng ta sáº½ sá»­ dá»¥ng Ä‘Æ°á»£c gá»i  <code>liftCode</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">-- | Get a Plutus Core program corresponding to the given value as a &#x27;CompiledCodeIn&#x27;, throwing any errors that occur as exceptions and ignoring fresh names.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">liftCode</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   :: (Lift.Lift uni a, Throwable uni fun, PLC.ToBuiltinMeaning uni fun)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   =&gt; a -&gt; CompiledCodeIn uni fun a</span></div><div class="token-line" style="color:#393A34"><span class="token plain">liftCode x = unsafely $ safeLiftCode x</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>NÃ³ nháº­n má»™t giÃ¡ trá»‹ Haskell cá»§a kiá»ƒu <code>a</code>, vá»›i Ä‘iá»u kiá»‡n <code>a</code> lÃ  má»™t thá»ƒ hiá»‡n cá»§a lá»›p <code>Lift</code> vÃ  biáº¿n nÃ³ thÃ nh má»™t Ä‘oáº¡n mÃ£ táº­p lá»‡nh Plutus tÆ°Æ¡ng á»©ng vá»›i cÃ¹ng kiá»ƒu.</p><p>BÃ¢y giá» chÃºng tÃ´i cÃ³ thá»ƒ sá»­a chá»¯a trÃ¬nh xÃ¡c nháº­n cá»§a mÃ¬nh.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">typedValidator :: VestingParam -&gt; Scripts.TypedValidator Vesting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">typedValidator p = Scripts.mkTypedValidator @Vesting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ($$(PlutusTx.compile [|| mkValidator ||]) `PlutusTx.applyCode` PlutusTx.liftCode p)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $$(PlutusTx.compile [|| wrap ||])</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    wrap = Scripts.wrapValidator @() @()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>MÃ£ nÃ y á»•n, nhÆ°ng nÃ³ sáº½ khÃ´ng Ä‘Æ°á»£c biÃªn dá»‹ch, bá»Ÿi vÃ¬ <code>VestingParam</code> khÃ´ng pháº£i lÃ  má»™t phiÃªn báº£n cá»§a <code>Lift</code>. Äá»ƒ kháº¯c phá»¥c Ä‘iá»u nÃ y, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>makeLift</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">PlutusTx.makeLift &#x27;&#x27;VestingParam</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>VÃ , chÃºng ta cáº§n báº­t tiá»‡n Ã­ch má»Ÿ rá»™ng GHC.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{-# LANGUAGE MultiParamTypeClasses #-}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>BÃ¢y giá» nÃ³ sáº½ biÃªn dá»‹ch.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="off-chain"></a>Off-Chain<a class="hash-link" href="#off-chain" title="Direct link to heading">#</a></h3><p>MÃ£ ngoÃ i chuá»—i khÃ´ng thay Ä‘á»•i nhiá»u.</p><p>CÃ¡c <code>GiveParams</code> váº«n giá»‘ng nhau.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">data GiveParams = GiveParams</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      { gpBeneficiary :: !PubKeyHash</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      , gpDeadline    :: !POSIXTime</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      , gpAmount      :: !Integer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      } deriving (Generic, ToJSON, FromJSON, ToSchema)      </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>VestingSchema</code> Ä‘Ã£ thay Ä‘á»•i má»™t chÃºt vÃ¬ endpoint <code>grab</code>  giá» Ä‘Ã¢y dá»±a vÃ o viá»‡c biáº¿t ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ  thá»i háº¡n Ä‘á»ƒ biáº¿t xÃ¡c Ä‘á»‹nh Ä‘á»‹a chá»‰ táº­p lá»‡nh. ChÃºng tÃ´i biáº¿t ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ¬ nÃ³ sáº½ lÃ  mÃ£ bÄƒm khÃ³a cÃ´ng khai cá»§a vÃ­ gá»i <code>grab</code>, nhÆ°ng chÃºng tÃ´i khÃ´ng biáº¿t thá»i háº¡n, vÃ¬ váº­y chÃºng tÃ´i pháº£i chuyá»ƒn nÃ³ cho <code>grab</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">type VestingSchema =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          Endpoint &quot;give&quot; GiveParams</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      .\/ Endpoint &quot;grab&quot; POSIXTime</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>endpoint<code>give</code> tÆ°Æ¡ng tá»± nhÆ° vÃ­ dá»¥ vesting, nhÆ°ng cÃ³ má»™t sá»‘ khÃ¡c biá»‡t.</p><p>Thay vÃ¬ tÃ­nh toÃ¡n dá»¯ liá»‡u, chÃºng tÃ´i sáº½ xÃ¢y dá»±ng má»™t cÃ¡i gÃ¬ Ä‘Ã³ kiá»ƒu
<code>VestingParam</code>.ChÃºng tÃ´i cÅ©ng thay Ä‘á»•i tham chiáº¿u Ä‘áº¿n datum trong
<code>mustPayToTheScript</code> Ä‘á»ƒ trá»Ÿ thÃ nh <code>()</code>, vÃ  chÃºng tÃ´i cung cáº¥p cÃ¡c loáº¡i <code>p</code> Ä‘á»ƒ <code>typedValidator</code> nhÆ° nÃ³ khÃ´ng cÃ²n lÃ  má»™t háº±ng sá»‘.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">give :: AsContractError e =&gt; GiveParams -&gt; Contract w s e ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">give gp = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    let p  = VestingParam</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                { beneficiary = gpBeneficiary gp</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                , deadline    = gpDeadline gp</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        tx = mustPayToTheScript () $ Ada.lovelaceValueOf $ gpAmount gp</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ledgerTx &lt;- submitTxConstraints (typedValidator p) tx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void $ awaitTxConfirmed $ txId ledgerTx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    logInfo @String $ printf &quot;made a gift of %d lovelace to %s with deadline %s&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (gpAmount gp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (show $ gpBeneficiary gp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (show $ gpDeadline gp)      </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Endpoint <code>grab</code>  cÅ©ng cÃ³ má»™t sá»‘ thay Ä‘á»•i.</p><p>Nhá»› láº¡i ráº±ng trÆ°á»›c Ä‘Ã³ chÃºng ta cÃ³ táº¥t cáº£ cÃ¡c UTxO á»Ÿ táº¡i má»™t Ä‘á»‹a chá»‰ táº­p lá»‡nh nÃ y vÃ  chÃºng cÃ³ thá»ƒ dÃ nh cho nhá»¯ng ngÆ°á»i thá»¥ hÆ°á»Ÿng tÃ¹y Ã½ vÃ  cho nhá»¯ng thá»i háº¡n tÃ¹y Ã½. VÃ¬ lÃ½ do nÃ y, chÃºng tÃ´i pháº£i lá»c nhá»¯ng UTxO dÃ nh cho chÃºng tÃ´i vÃ  nhá»¯ng nÆ¡i Ä‘Ã£ Ä‘áº¿n thá»i háº¡n.</p><p>BÃ¢y giá» chÃºng tÃ´i cÃ³ tham sá»‘ bá»• sung, mÃ  chÃºng tÃ´i sáº½ gá»i <code>d</code>, Ä‘áº¡i diá»‡n cho thá»i háº¡n. VÃ¬ váº­y, chÃºng tÃ´i cÃ³ thá»ƒ ngay láº­p tá»©c xem náº¿u thá»i háº¡n Ä‘Ã£ Ä‘áº¿n hay chÆ°a.</p><p>Náº¿u nÃ³ váº«n chÆ°a Ä‘áº¡t Ä‘Æ°á»£c, chÃºng tÃ´i viáº¿t má»™t thÃ´ng bÃ¡o nháº­t kÃ½ vÃ  dá»«ng láº¡i, náº¿u khÃ´ng chÃºng tÃ´i tiáº¿p tá»¥c vÃ  xÃ¢y dá»±ng <code>VestingParam</code>.</p><p>Sau Ä‘Ã³, chÃºng tÃ´i tÃ¬m kiáº¿m cÃ¡c UTxO cÃ³ táº¡i Ä‘á»‹a chá»‰ nÃ y. Äá»‹a chá»‰ khÃ´ng pháº£i lÃ  má»™t háº±ng sá»‘ ná»¯a, nÃ³ nháº­n má»™t tham sá»‘. VÃ¬ váº­y, bÃ¢y giá», chÃºng tÃ´i sáº½ chá»‰ nháº­n Ä‘Æ°á»£c UTxO dÃ nh cho chÃºng tÃ´i vÃ  Ä‘Ã£ Ä‘áº¿n thá»i háº¡n. ChÃºng ta khÃ´ng cáº§n lá»c báº¥t cá»© thá»© gÃ¬.</p><p>Náº¿u khÃ´ng cÃ³ thÃ´ng bÃ¡o nÃ o, chÃºng tÃ´i ghi láº¡i má»™t thÃ´ng bÃ¡o cho hiá»‡u á»©ng Ä‘Ã³ vÃ  dá»«ng láº¡i, náº¿u khÃ´ng, chÃºng tÃ´i lÃ m nhiá»u hÆ¡n hoáº·c Ã­t hÆ¡n nhá»¯ng gÃ¬ chÃºng tÃ´i Ä‘Ã£ lÃ m trÆ°á»›c Ä‘Ã³.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">grab d = do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">now   &lt;- currentTime</span></div><div class="token-line" style="color:#393A34"><span class="token plain">pkh   &lt;- pubKeyHash &lt;$&gt; ownPubKey</span></div><div class="token-line" style="color:#393A34"><span class="token plain">if now &lt; d</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    then logInfo @String $ &quot;too early&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        let p = VestingParam</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    { beneficiary = pkh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    , deadline    = d</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    utxos &lt;- utxoAt $ scrAddress p</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    if Map.null utxos</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        then logInfo @String $ &quot;no gifts available&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        else do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            let orefs   = fst &lt;$&gt; Map.toList utxos</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                lookups = Constraints.unspentOutputs utxos      &lt;&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                          Constraints.otherScript (validator p)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                tx :: TxConstraints Void Void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                tx      = mconcat [mustSpendScriptOutput oref $ Redeemer $ PlutusTx.toData () | oref &lt;- orefs] &lt;&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                          mustValidateIn (from now)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            ledgerTx &lt;- submitTxConstraintsWith @Void lookups tx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            void $ awaitTxConfirmed $ txId ledgerTx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            logInfo @String $ &quot;collected gifts&quot;                          </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>CÃ¡c hÃ m <code>endpoints</code> lÃ  hÆ¡i khÃ¡c nhau do cÃ¡c tham sá»‘ má»›i cho<code>grab</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI {.haskell}"><div tabindex="0" class="prism-code language-{.haskell} codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">endpoints :: Contract () VestingSchema Text ()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">endpoints = (give&#x27; `select` grab&#x27;) &gt;&gt; endpoints</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  where</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    give&#x27; = endpoint @&quot;give&quot; &gt;&gt;= give</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    grab&#x27; = endpoint @&quot;grab&quot; &gt;&gt;= grab</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="quay-láº¡i-playground"></a>Quay láº¡i playground<a class="hash-link" href="#quay-láº¡i-playground" title="Direct link to heading">#</a></h3><p>BÃ¢y giá» chÃºng tÃ´i sáº½ sao chÃ©p vÃ  dÃ¡n há»£p Ä‘á»“ng má»›i nÃ y vÃ o sÃ¢n chÆ¡i vÃ  thiáº¿t láº­p má»™t ká»‹ch báº£n má»›i.</p><p>CÃ¡c <code>give</code> giao dá»‹ch Ä‘á»u giá»‘ng nhau.</p><p><img src="/assets/images/pic__00059-7f45bb1aa7d141818049b51dd65f2e37.png"></p><p><code>Grab</code> hÆ¡i khÃ¡c nhau. Trong láº§n triá»ƒn khai trÆ°á»›c Ä‘Ã³ cá»§a chÃºng tÃ´i, má»™t vÃ­ cÃ³ thá»ƒ láº¥y UTxO vá»›i cÃ¡c thá»i háº¡n khÃ¡c nhau miá»…n lÃ  thá»i háº¡n Ä‘Ã£ qua. BÃ¢y giá» thá»i háº¡n lÃ  má»™t pháº§n cá»§a tham sá»‘ script, vÃ¬ váº­y chÃºng ta cáº§n chá»‰ Ä‘á»‹nh nÃ³ Ä‘á»ƒ láº¥y Ä‘á»‹a chá»‰ script. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  VÃ­ 2 khÃ´ng thá»ƒ láº¥y quÃ  cho cÃ¡c vá»‹ trÃ­ 10 vÃ  20 cÃ¹ng má»™t lÃºc, Ã­t nháº¥t lÃ  khÃ´ng theo cÃ¡ch mÃ  chÃºng tÃ´i Ä‘Ã£ triá»ƒn khai.</p><p>TrÆ°á»›c tiÃªn, chÃºng ta cÃ³ thá»ƒ Ä‘á»£i cho Ä‘áº¿n khe 10 vÃ  sau Ä‘Ã³ VÃ­ 2 sáº½ cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c mÃ³n quÃ  Ä‘áº§u tiÃªn vÃ  VÃ­ 3 sáº½ cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c mÃ³n quÃ  duy nháº¥t cá»§a nÃ³.</p><p>ChÃºng tÃ´i sáº½ thÃªm má»™t <code>grab</code> cho vÃ­ 2 vÃ  vÃ­ 3. á» Ä‘Ã¢y, chÃºng tÃ´i khÃ´ng cáº§n pháº£i phÃ¢n biá»‡t giá»¯a má»—i giao dá»‹ch vÃ¬ nÃ³ lÃ  hai vÃ­ khÃ¡c nhau.</p><p>Sau Ä‘Ã³, chÃºng tÃ´i Ä‘á»£i cho Ä‘áº¿n khe 20 vÃ  thá»±c hiá»‡n láº§n thá»© hai cá»§a <code>grab</code>vÃ­ 2  vÃ  sau Ä‘Ã³ Ä‘á»£i 1 khá»‘i, nhÆ° bÃ¬nh thÆ°á»ng.</p><p><img src="/assets/images/pic__00060-1d269ec56accfe952503077c80c645d2.png"></p><p>VÃ¬ váº­y, hÃ£y xem náº¿u nÃ³ hoáº¡t Ä‘á»™ng báº±ng cÃ¡ch nháº¥p vÃ o <code>Evaluate</code>.</p><p><img src="/assets/images/pic__00061-34ad2459354578430639958932e6ab4e.png"></p><p>Ghi láº¡i Ä‘á»‹a chá»‰ táº­p lá»‡nh cho giao dá»‹ch Ä‘Ã³ táº¡i vá»‹ trÃ­ 1.</p><p><img src="/assets/images/pic__00062-e875c97dd2255764dd0f1526e5f9922a.png"></p><p>VÃ  so sÃ¡nh Ä‘á»‹a chá»‰ nÃ y vá»›i Ä‘á»‹a chá»‰ táº­p lá»‡nh cho Ä‘áº§u ra giao dá»‹ch táº¡i vá»‹ trÃ­ 2.</p><p><img src="/assets/images/pic__00063-3044e6b470677ac95cdbeeee08d43c7d.png"></p><p>LÆ°u Ã½ ráº±ng Ä‘á»‹a chá»‰ táº­p lá»‡nh cho cÃ¡c UTxO lÃ  khÃ¡c nhau. Trong phiÃªn báº£n Ä‘áº§u tiÃªn cá»§a há»£p Ä‘á»“ng vesting, Ä‘á»‹a chá»‰ táº­p lá»‡nh lÃ  má»™t háº±ng sá»‘. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  táº¥t cáº£ quÃ  táº·ng cá»§a chÃºng tÃ´i káº¿t thÃºc á»Ÿ cÃ¹ng má»™t Ä‘á»‹a chá»‰ táº­p lá»‡nh vÃ  chá»‰ cÃ³ dá»¯ liá»‡u trong má»—i UTxO lÃ  khÃ¡c nhau.</p><p>BÃ¢y giá», dá»¯ liá»‡u lÃ  chÃ­nh xÃ¡c <code>()</code> vÃ  ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ  thá»i háº¡n Ä‘Æ°á»£c bao gá»“m nhÆ° má»™t pháº§n cá»§a chÃ­nh táº­p lá»‡nh, vÃ¬ váº­y cÃ¡c Ä‘á»‹a chá»‰ bÃ¢y giá» khÃ¡c nhau tÃ¹y thuá»™c vÃ o ngÆ°á»i thá»¥ hÆ°á»Ÿng vÃ  cÃ¡c tham sá»‘ thá»i háº¡n.</p><p>Äá»‘i vá»›i mÃ³n quÃ  cho VÃ­ 3, chÃºng tÃ´i tháº¥y cÃ³ má»™t Ä‘á»‹a chá»‰ khÃ¡c.</p><p><img src="/assets/images/pic__00064-a48c950dd5dece774d65874dc96f8994.png"></p><p>ChÃºng tÃ´i tháº¥y hai láº§n láº¥y á»Ÿ vá»‹ trÃ­ 10, má»™t cá»§a VÃ­ 2 vÃ  má»™t cá»§a VÃ­ 3. Thá»© tá»± mÃ  chÃºng Ä‘Æ°á»£c xá»­ lÃ½ khÃ´ng mang tÃ­nh xÃ¡c Ä‘á»‹nh.</p><p>Sau Ä‘Ã³, cuá»‘i cÃ¹ng á»Ÿ khe 20, Wallet 2 láº¥y pháº§n quÃ  cÃ²n láº¡i cá»§a nÃ³.</p><p>VÃ  sá»‘ dÆ° cuá»‘i cÃ¹ng pháº£n Ã¡nh cÃ¡c giao dá»‹ch Ä‘Ã£ xáº£y ra.</p><p><img src="/assets/images/pic__00065-00802007ba5f1b30c6122d3f2985f8fa.png"></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/cardano2vn/cardanovn-portal/edit/main/docs/dr-lars-lession/week3.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/dr-lars-lession/week2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Week 02 - Validation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/dr-lars-lession/week4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Week 04 - Monads Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#trÆ°á»›c-khi-chÃºng-ta-báº¯t-Ä‘áº§u" class="table-of-contents__link">TrÆ°á»›c khi chÃºng ta báº¯t Ä‘áº§u</a></li><li><a href="#tÃ³m-táº¯t-láº¡i" class="table-of-contents__link">TÃ³m táº¯t láº¡i</a></li><li><a href="#scriptcontext" class="table-of-contents__link">ScriptContext</a><ul><li><a href="#txinfovalidrange" class="table-of-contents__link">txInfoValidRange</a></li><li><a href="#posixtimerange" class="table-of-contents__link">POSIXTimeRange</a></li></ul></li><li><a href="#vÃ­-dá»¥---vesting" class="table-of-contents__link">VÃ­ dá»¥ - Vesting</a><ul><li><a href="#in-the-playground" class="table-of-contents__link">In the playground</a></li></ul></li><li><a href="#vÃ­-dá»¥-2---parameterized-contract" class="table-of-contents__link">VÃ­ dá»¥ 2 - Parameterized Contract</a><ul><li><a href="#on-chain" class="table-of-contents__link">On-Chain</a></li><li><a href="#off-chain" class="table-of-contents__link">Off-Chain</a></li><li><a href="#quay-láº¡i-playground" class="table-of-contents__link">Quay láº¡i playground</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">TÃ i liá»‡u</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/overview">Báº¯t Ä‘áº§u</a></li></ul></div><div class="col footer__col"><div class="footer__title">Cá»™ng Ä‘á»“ng</div><ul class="footer__items"><li class="footer__item"><a href="https://t.me/cardano2vn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCJTdAQPGJntJet5v-nk9ebA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://github.com/cardano2vn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/about-us">About Us</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">The content of this site is referenced and copied from the <a href="https://developers.cardano.org/" target="_blank" rel="noopener noreferrer">Cardano Developer</a>, 2021</div></div></div></footer></div>
<script src="/assets/js/runtime~main.af40557b.js"></script>
<script src="/assets/js/main.97b62b7d.js"></script>
</body>
</html>