"use strict";(self.webpackChunkbringscdocs=self.webpackChunkbringscdocs||[]).push([[2670],{3905:function(n,t,e){e.d(t,{Zo:function(){return o},kt:function(){return m}});var a=e(7294);function i(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function h(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,a)}return e}function l(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?h(Object(e),!0).forEach((function(t){i(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):h(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function c(n,t){if(null==n)return{};var e,a,i=function(n,t){if(null==n)return{};var e,a,i={},h=Object.keys(n);for(a=0;a<h.length;a++)e=h[a],t.indexOf(e)>=0||(i[e]=n[e]);return i}(n,t);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(n);for(a=0;a<h.length;a++)e=h[a],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(i[e]=n[e])}return i}var g=a.createContext({}),r=function(n){var t=a.useContext(g),e=t;return n&&(e="function"==typeof n?n(t):l(l({},t),n)),e},o=function(n){var t=r(n.components);return a.createElement(g.Provider,{value:t},n.children)},p={inlineCode:"code",wrapper:function(n){var t=n.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(n,t){var e=n.components,i=n.mdxType,h=n.originalType,g=n.parentName,o=c(n,["components","mdxType","originalType","parentName"]),u=r(e),m=i,s=u["".concat(g,".").concat(m)]||u[m]||p[m]||h;return e?a.createElement(s,l(l({ref:t},o),{},{components:e})):a.createElement(s,l({ref:t},o))}));function m(n,t){var e=arguments,i=t&&t.mdxType;if("string"==typeof n||i){var h=e.length,l=new Array(h);l[0]=u;var c={};for(var g in t)hasOwnProperty.call(t,g)&&(c[g]=t[g]);c.originalType=n,c.mdxType="string"==typeof n?n:i,l[1]=c;for(var r=2;r<h;r++)l[r]=e[r];return a.createElement.apply(null,l)}return a.createElement.apply(null,e)}u.displayName="MDXCreateElement"},707:function(n,t,e){e.r(t),e.d(t,{frontMatter:function(){return c},metadata:function(){return g},toc:function(){return r},default:function(){return p}});var a=e(7462),i=e(3366),h=(e(7294),e(3905)),l=["components"],c={},g={unversionedId:"dr-lars-lession/week3",id:"dr-lars-lession/week3",isDocsHomePage:!1,title:"Week 03 - Script Context",description:"\u0110\xe2y l\xe0 phi\xean b\u1ea3n \u0111\xe3 d\u1ecbch c\u1ee7a B\xe0i gi\u1ea3ng s\u1ed1 3 Dr. Lars.",source:"@site/docs/dr-lars-lession/week3.md",sourceDirName:"dr-lars-lession",slug:"/dr-lars-lession/week3",permalink:"/docs/dr-lars-lession/week3",editUrl:"https://github.com/cardano2vn/cardanovn-portal/edit/main/docs/dr-lars-lession/week3.md",version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Week 02 - Validation",permalink:"/docs/dr-lars-lession/week2"},next:{title:"Week 04 - Monads",permalink:"/docs/dr-lars-lession/week4"}},r=[{value:"Tr\u01b0\u1edbc khi ch\xfang ta b\u1eaft \u0111\u1ea7u",id:"tr\u01b0\u1edbc-khi-ch\xfang-ta-b\u1eaft-\u0111\u1ea7u",children:[]},{value:"T\xf3m t\u1eaft l\u1ea1i",id:"t\xf3m-t\u1eaft-l\u1ea1i",children:[]},{value:"ScriptContext",id:"scriptcontext",children:[{value:"txInfoValidRange",id:"txinfovalidrange",children:[]},{value:"POSIXTimeRange",id:"posixtimerange",children:[]}]},{value:"V\xed d\u1ee5 - Vesting",id:"v\xed-d\u1ee5---vesting",children:[{value:"In the playground",id:"in-the-playground",children:[]}]},{value:"V\xed d\u1ee5 2 - Parameterized Contract",id:"v\xed-d\u1ee5-2---parameterized-contract",children:[{value:"On-Chain",id:"on-chain",children:[]},{value:"Off-Chain",id:"off-chain",children:[]},{value:"Quay l\u1ea1i playground",id:"quay-l\u1ea1i-playground",children:[]}]}],o={toc:r};function p(n){var t=n.components,c=(0,i.Z)(n,l);return(0,h.kt)("wrapper",(0,a.Z)({},o,c,{components:t,mdxType:"MDXLayout"}),(0,h.kt)("p",null,"\u0110\xe2y l\xe0 phi\xean b\u1ea3n \u0111\xe3 d\u1ecbch c\u1ee7a ",(0,h.kt)("a",{parentName:"p",href:"https://youtu.be/WG3uw-TkW2k"},"B\xe0i gi\u1ea3ng s\u1ed1 3 Dr. Lars"),"."),(0,h.kt)("p",null,"Trong b\xe0i gi\u1ea3ng n\xe0y, ch\xfang ta t\xecm hi\u1ec3u v\u1ec1 context script (\u0111\u1ed1i s\u1ed1 x\xe1c th\u1ef1c th\u1ee9 ba), th\u1eddi gian x\u1eed l\xfd v\xe0 c\xe1c h\u1ee3p \u0111\u1ed3ng \u0111\u01b0\u1ee3c tham s\u1ed1 h\xf3a."),(0,h.kt)("p",null,"\u0110o\u1ea1n m\xe3 trong b\xe0i gi\u1ea3ng n\xe0y s\u1eed d\u1ee5ng Plutus commit l\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"81ba78edb1d634a13371397d8c8b19829345ce0d"),"."),(0,h.kt)("h2",{id:"tr\u01b0\u1edbc-khi-ch\xfang-ta-b\u1eaft-\u0111\u1ea7u"},"Tr\u01b0\u1edbc khi ch\xfang ta b\u1eaft \u0111\u1ea7u"),(0,h.kt)("p",null,"K\u1ec3 t\u1eeb b\xe0i gi\u1ea3ng cu\u1ed1i c\xf9ng \u0111\xe3 c\xf3 m\u1ed9t b\u1ea3n c\u1eadp nh\u1eadt cho s\xe2n ch\u01a1i, c\xf3 trong b\u1ea3n cam k\u1ebft Plutus m\xe0 ch\xfang t\xf4i \u0111ang s\u1eed d\u1ee5ng cho b\xe0i gi\u1ea3ng n\xe0y (xem ghi ch\xfa \u1edf tr\xean)."),(0,h.kt)("p",null,"\u0110\xe3 x\u1ea3y ra s\u1ef1 c\u1ed1 khi th\u1eddi gian ch\u1edd \u0111\u01b0\u1ee3c m\xe3 h\xf3a c\u1ee9ng v\xe0o s\xe2n ch\u01a1i qu\xe1 ng\u1eafn. \u0110i\u1ec1u n\xe0y s\u1ebd khi\u1ebfn m\xf4 ph\u1ecfng kh\xf4ng th\xe0nh c\xf4ng n\u1ebfu ch\xfang m\u1ea5t nhi\u1ec1u th\u1eddi gian h\u01a1n th\u1eddi gian ch\u1edd m\xe3 c\u1ee9ng."),(0,h.kt)("p",null,"B\xe2y gi\u1edd c\xf3 m\u1ed9t t\xf9y ch\u1ecdn khi b\u1ea1n kh\u1edfi \u0111\u1ed9ng M\xe1y ch\u1ee7 s\xe2n ch\u01a1i Plutus cho ph\xe9p b\u1ea1n ch\u1ec9 \u0111\u1ecbnh th\u1eddi gian ch\u1edd. V\xed d\u1ee5 sau \u0111\u1eb7t th\u1eddi gian ch\u1edd th\xe0nh 120 gi\xe2y."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.}"},"plutus-playground-server -i 120s\n")),(0,h.kt)("h2",{id:"t\xf3m-t\u1eaft-l\u1ea1i"},"T\xf3m t\u1eaft l\u1ea1i"),(0,h.kt)("p",null,"Khi ch\xfang t\xf4i \u0111\xe3 gi\u1ea3i th\xedch (E) UTxO m\xf4 h\xecnh trong b\xe0i gi\u1ea3ng \u0111\u1ea7u ti\xean, ch\xfang t\xf4i \u0111\u1ec1 c\u1eadp r\u1eb1ng \u0111\u1ec3 m\u1edf kh\xf3a m\u1ed9t \u0111\u1ecba ch\u1ec9 k\u1ecbch b\u1ea3n, k\u1ecbch b\u1ea3n g\u1eafn li\u1ec1n v\u1edbi \u0111\u1ecba ch\u1ec9 \u0111\u01b0\u1ee3c ch\u1ea1y, v\xe0 k\u1ecbch b\u1ea3n m\xe0 \u0111\u01b0\u1ee3c ba m\u1ea9u th\xf4ng tin -\n",(0,h.kt)("em",{parentName:"p"},"datum"),",  ",(0,h.kt)("em",{parentName:"p"},"redeemer")," v\xe0 ",(0,h.kt)("em",{parentName:"p"},"context"),"."),(0,h.kt)("p",null,"Trong b\xe0i gi\u1ea3ng th\u1ee9 hai, ch\xfang ta \u0111\xe3 xem c\xe1c v\xed d\u1ee5 v\u1ec1 \u0111i\u1ec1u \u0111\xf3 v\xe0 ch\xfang ta \u0111\xe3 th\u1ea5y n\xf3 th\u1ef1c s\u1ef1 ho\u1ea1t \u0111\u1ed9ng nh\u01b0 th\u1ebf n\xe0o trong Haskell."),(0,h.kt)("p",null,"Ch\xfang t\xf4i \u0111\xe3 th\u1ea5y vi\u1ec7c tri\u1ec3n khai c\u1ea5p th\u1ea5p, trong \u0111\xf3 c\u1ea3 ba \u0111\u1ed1i s\u1ed1 \u0111\u1ec1u \u0111\u01b0\u1ee3c bi\u1ec3u th\u1ecb b\u1eb1ng ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"Data"),". Ch\xfang t\xf4i c\u0169ng th\u1ea5y r\u1eb1ng trong th\u1ef1c t\u1ebf \u0111i\u1ec1u n\xe0y kh\xf4ng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng."),(0,h.kt)("p",null,"Thay v\xe0o \u0111\xf3, ch\xfang t\xf4i s\u1eed d\u1ee5ng phi\xean b\u1ea3n \u0111\xe3 nh\u1eadp, trong \u0111\xf3 d\u1eef li\u1ec7u v\xe0 c\xf4ng c\u1ee5 \u0111\u1ed5i c\xf3 th\u1ec3 l\xe0 ki\u1ec3u t\xf9y ch\u1ec9nh (mi\u1ec5n l\xe0 ch\xfang tri\u1ec3n khai l\u1edbp ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"IsData"),") v\xe0 trong \u0111\xf3 \u0111\u1ed1i s\u1ed1 th\u1ee9 ba l\xe0 ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"ScriptContext"),"."),(0,h.kt)("p",null,"Trong c\xe1c v\xed d\u1ee5 m\xe0 ch\xfang t\xf4i \u0111\xe3 th\u1ea5y cho \u0111\u1ebfn nay, ch\xfang t\xf4i \u0111\xe3 xem x\xe9t d\u1eef li\u1ec7u v\xe0 c\xf4ng c\u1ee5 \u0111\u1ed5i, nh\u01b0ng ch\xfang t\xf4i lu\xf4n b\u1ecf qua ng\u1eef c\u1ea3nh. Nh\u01b0ng b\u1ed1i c\u1ea3nh, t\u1ea5t nhi\xean, r\u1ea5t quan tr\u1ecdng. V\xec v\u1eady, trong b\xe0i gi\u1ea3ng n\xe0y, ch\xfang ta s\u1ebd b\u1eaft \u0111\u1ea7u xem x\xe9t context."),(0,h.kt)("h2",{id:"scriptcontext"},"ScriptContext"),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"ScriptContext")," \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong g\xf3i ",(0,h.kt)("inlineCode",{parentName:"p"},"plutus-ledger-api"),", m\xe0 l\xe0 m\u1ed9t g\xf3i ph\u1ea7n m\u1ec1m \u0111\xf3, cho \u0111\u1ebfn b\xe2y gi\u1edd, ch\xfang t\xf4i \u0111\xe3 kh\xf4ng c\u1ea7n thi\u1ebft. Nh\u01b0ng b\xe2y gi\u1edd ch\xfang t\xf4i c\u1ea7n n\xf3, v\xe0 n\xf3 \u0111\xe3 \u0111\u01b0\u1ee3c \u0111\u01b0a v\xe0o files ",(0,h.kt)("inlineCode",{parentName:"p"},".cabal")," c\u1ee7a tu\u1ea7n n\xe0y . N\xf3 \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong m\xf4-\u0111un ",(0,h.kt)("inlineCode",{parentName:"p"},"Plutus.V1.Ledger.Contexts"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data ScriptContext = ScriptContext { \n            scriptContextTxInfo :: TxInfo, \n            scriptContextPurpose :: ScriptPurpose \n      }\n")),(0,h.kt)("p",null,"N\xf3 l\xe0 m\u1ed9t lo\u1ea1i b\u1ea3n ghi c\xf3 hai tr\u01b0\u1eddng."),(0,h.kt)("p",null,"Tr\u01b0\u1eddng th\u1ee9 hai thu\u1ed9c lo\u1ea1i ",(0,h.kt)("inlineCode",{parentName:"p"},"ScriptPurpose"),", \u0111\u01b0\u1ee3c x\xe1c \u0111\u1ecbnh trong c\xf9ng m\u1ed9t m\xf4-\u0111un. N\xf3 x\xe1c \u0111\u1ecbnh m\u1ee5c \u0111\xedch m\xe0 m\u1ed9t t\u1eadp l\u1ec7nh \u0111ang \u0111\u01b0\u1ee3c ch\u1ea1y."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data ScriptPurpose\n   = Minting CurrencySymbol\n   | Spending TxOutRef\n   | Rewarding StakingCredential\n   | Certifying DCert\n")),(0,h.kt)("p",null,"\u0110\u1ed1i v\u1edbi ch\xfang t\xf4i, quan tr\u1ecdng nh\u1ea5t l\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"Spending"),". \u0110\xe2y l\xe0 nh\u1eefng g\xec ch\xfang ta \u0111\xe3 n\xf3i cho \u0111\u1ebfn nay trong context c\u1ee7a m\xf4 h\xecnh (E) UTxO. \u0110\xe2y l\xe0 khi m\u1ed9t t\u1eadp l\u1ec7nh \u0111\u01b0\u1ee3c ch\u1ea1y \u0111\u1ec3 x\xe1c th\u1ef1c \u0111\u1ea7u v\xe0o chi ti\xeau cho m\u1ed9t giao d\u1ecbch."),(0,h.kt)("p",null,"C\xe1c ",(0,h.kt)("inlineCode",{parentName:"p"},"Minting")," d\xf9ng khi b\u1ea1n mu\u1ed1n \u0111\u1ecbnh ngh\u0129a m\u1ed9t token g\u1ed1c. M\u1ee5c \u0111\xedch c\u1ee7a n\xf3 l\xe0 ch\xfang t\xf4i m\xf4 t\u1ea3 trong nh\u1eefng tr\u01b0\u1eddng h\u1ee3p n\xe0o token g\u1ed1c c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c \u0111\xfac ho\u1eb7c \u0111\u1ed1t."),(0,h.kt)("p",null,"Ngo\xe0i ra c\xf2n c\xf3 hai m\u1ee5c \u0111\xedch ho\xe0n to\xe0n m\u1edbi -",(0,h.kt)("inlineCode",{parentName:"p"},"Rewarding"),"-  li\xean quan \u0111\u1ebfn \u0111\u1eb7t c\u01b0\u1ee3c v\xe0 ",(0,h.kt)("em",{parentName:"p"},(0,h.kt)("inlineCode",{parentName:"em"},"Certifying")),"  li\xean quan \u0111\u1ebfn \u1ee7y quy\u1ec1n c\u1ed5 ph\u1ea7n."),(0,h.kt)("p",null,"Tr\u01b0\u1eddng th\xfa v\u1ecb nh\u1ea5t, tr\u01b0\u1eddng ch\u1ee9a ng\u1eef c\u1ea3nh th\u1ef1c t\u1ebf ",(0,h.kt)("inlineCode",{parentName:"p"},"scriptContextTxInfo")," l\xe0 tr\u01b0\u1eddng thu\u1ed9c lo\u1ea1i ",(0,h.kt)("inlineCode",{parentName:"p"},"TxInfo"),", c\u0169ng \u0111\u01b0\u1ee3c x\xe1c \u0111\u1ecbnh trong c\xf9ng m\u1ed9t m\xf4-\u0111un."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data TxInfo = TxInfo\n   { txInfoInputs      :: [TxInInfo] -- ^ Transaction inputs\n   , txInfoOutputs     :: [TxOut] -- ^ Transaction outputs\n   , txInfoFee         :: Value -- ^ The fee paid by this transaction.\n   , txInfoForge       :: Value -- ^ The 'Value' forged by this transaction.\n   , txInfoDCert       :: [DCert] -- ^ Digests of certificates included in this transaction\n   , txInfoWdrl        :: [(StakingCredential, Integer)] -- ^ Withdrawals\n   , txInfoValidRange  :: SlotRange -- ^ The valid range for the transaction.\n   , txInfoSignatories :: [PubKeyHash] -- ^ Signatures provided with the transaction, attested that they all signed the tx\n   , txInfoData        :: [(DatumHash, Datum)]\n   , txInfoId          :: TxId\n   -- ^ Hash of the pending transaction (excluding witnesses)\n   } deriving (Generic)\n")),(0,h.kt)("p",null,"N\xf3 m\xf4 t\u1ea3 giao d\u1ecbch chi ti\xeau. Trong m\xf4 h\xecnh (E) UTxO, b\u1ed1i c\u1ea3nh x\xe1c th\u1ef1c l\xe0 giao d\u1ecbch chi ti\xeau v\xe0 c\xe1c \u0111\u1ea7u v\xe0o v\xe0 \u0111\u1ea7u ra c\u1ee7a n\xf3. B\u1ed1i c\u1ea3nh n\xe0y \u0111\u01b0\u1ee3c th\u1ec3 hi\u1ec7n trong ",(0,h.kt)("inlineCode",{parentName:"p"},"TxInfo"),"."),(0,h.kt)("p",null,"C\xf3 m\u1ed9t s\u1ed1 tr\u01b0\u1eddng l\xe0 to\xe0n c\u1ea7u cho to\xe0n b\u1ed9 giao d\u1ecbch v\xe0 c\u1ee5 th\u1ec3 l\xe0 ch\xfang t\xf4i c\xf3 danh s\xe1ch t\u1ea5t c\u1ea3 c\xe1c \u0111\u1ea7u v\xe0o ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoInputs")," v\xe0 danh s\xe1ch t\u1ea5t c\u1ea3 c\xe1c \u0111\u1ea7u ra ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoOutputs"),". M\u1ed7i ng\u01b0\u1eddi trong s\u1ed1 h\u1ecd c\xf3 nhi\u1ec1u l\u0129nh v\u1ef1c kh\xe1c nhau \u0111\u1ec3 \u0111i s\xe2u v\xe0o t\u1eebng \u0111\u1ea7u v\xe0o ho\u1eb7c \u0111\u1ea7u ra ri\xeang l\u1ebb."),(0,h.kt)("p",null,"Ch\xfang t\xf4i c\u0169ng th\u1ea5y c\xe1c tr\u01b0\u1eddng v\u1ec1 ph\xed ",(0,h.kt)("inlineCode",{parentName:"p"},"txFee"),", gi\xe1 tr\u1ecb gi\u1ea3 m\u1ea1o ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoForge"),", \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng khi \u0111\xfac ho\u1eb7c \u0111\u1ed1t c\xe1c token g\u1ed1c."),(0,h.kt)("p",null,"Sau \u0111\xf3, ch\xfang t\xf4i c\xf3 m\u1ed9t danh s\xe1ch c\xe1c ch\u1ee9ng ch\u1ec9 \u1ee7y quy\u1ec1n trong ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoDCert")," v\xe0 m\u1ed9t tr\u01b0\u1eddng ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoWdrl")," \u0111\u1ec3 n\u1eafm gi\u1eef th\xf4ng tin v\u1ec1 vi\u1ec7c r\xfat ti\u1ec1n \u0111\u1eb7t c\u01b0\u1ee3c."),(0,h.kt)("p",null,"Tr\u01b0\u1eddng ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoValidRange")," m\xe0 ch\xfang ta s\u1ebd xem x\xe9t chi ti\u1ebft h\u01a1n trong gi\xe2y l\xe1t, x\xe1c \u0111\u1ecbnh ph\u1ea1m vi v\u1ecb tr\xed m\xe0 giao d\u1ecbch n\xe0y h\u1ee3p l\u1ec7."),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"txInfoSignatories")," l\xe0 danh s\xe1ch c\xe1c kh\xf3a c\xf4ng khai \u0111\xe3 k\xfd k\u1ebft giao d\u1ecbch n\xe0y."),(0,h.kt)("p",null,"C\xe1c giao d\u1ecbch s\u1eed d\u1ee5ng \u0111\u1ea7u ra t\u1eadp l\u1ec7nh c\u1ea7n ph\u1ea3i bao g\u1ed3m d\u1eef li\u1ec7u c\u1ee7a \u0111\u1ea7u ra t\u1eadp l\u1ec7nh. C\xe1c ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoData")," l\u0129nh v\u1ef1c l\xe0 m\u1ed9t danh s\xe1ch li\xean k\u1ebft datums v\u1edbi b\u0103m t\u01b0\u01a1ng \u1ee9ng c\u1ee7a h\u1ecd. N\u1ebfu c\xf3 m\u1ed9t \u0111\u1ea7u ra giao d\u1ecbch t\u1edbi m\u1ed9t \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh mang m\u1ed9t s\u1ed1 d\u1eef li\u1ec7u n\xe0o \u0111\xf3, b\u1ea1n kh\xf4ng c\u1ea7n ph\u1ea3i bao g\u1ed3m d\u1eef li\u1ec7u \u0111\xf3, b\u1ea1n ch\u1ec9 c\xf3 th\u1ec3 bao g\u1ed3m b\u0103m d\u1eef li\u1ec7u. Tuy nhi\xean, c\xe1c t\u1eadp l\u1ec7nh s\u1eed d\u1ee5ng m\u1ed9t \u0111\u1ea7u ra c\u1ea7n ph\u1ea3i bao g\u1ed3m d\u1eef li\u1ec7u, trong tr\u01b0\u1eddng h\u1ee3p \u0111\xf3, n\xf3 s\u1ebd \u0111\u01b0\u1ee3c \u0111\u01b0a v\xe0o danh s\xe1ch ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoData")," ."),(0,h.kt)("p",null,"Cu\u1ed1i c\xf9ng, tr\u01b0\u1eddng ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoId")," l\xe0 ID c\u1ee7a giao d\u1ecbch n\xe0y."),(0,h.kt)("h3",{id:"txinfovalidrange"},"txInfoValidRange"),(0,h.kt)("p",null,"M\u1eb7c d\xf9 c\xf3 r\u1ea5t nhi\u1ec1u th\xf4ng tin ch\u1ee9a trong ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfo"),", nh\u01b0ng \u0111\u1ed1i v\u1edbi v\xed d\u1ee5 \u0111\u1ea7u ti\xean c\u1ee7a ch\xfang t\xf4i v\u1ec1 c\xe1ch s\u1eed d\u1ee5ng \u0111\u1ed1i s\u1ed1 th\u1ee9 ba \u0111\u1ec3 x\xe1c th\u1ef1c, ch\xfang t\xf4i s\u1ebd t\u1eadp trung v\xe0o tr\u01b0\u1eddng ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoValidRange")," n\xe0y."),(0,h.kt)("p",null,"\u0110i\u1ec1u n\xe0y \u0111\u01b0a ch\xfang ta \u0111\u1ebfn m\u1ed9t t\xecnh hu\u1ed1ng kh\xf3 x\u1eed th\xfa v\u1ecb. Ch\xfang t\xf4i \u0111\xe3 nh\u1ea5n m\u1ea1nh nhi\u1ec1u l\u1ea7n r\u1eb1ng l\u1ee3i th\u1ebf l\u1edbn m\xe0 Cardano c\xf3 so v\u1edbi m\u1ed9t th\u1ee9 nh\u01b0 Ethereum l\xe0 vi\u1ec7c x\xe1c th\u1ef1c c\xf3 th\u1ec3 x\u1ea3y ra trong v\xed. Nh\u01b0ng ch\xfang t\xf4i c\u0169ng \u0111\xe3 l\u01b0u \xfd r\u1eb1ng m\u1ed9t giao d\u1ecbch v\u1eabn c\xf3 th\u1ec3 kh\xf4ng th\xe0nh c\xf4ng on-chain sau khi x\xe1c th\u1ef1c, n\u1ebfu khi giao d\u1ecbch tr\xean blockchain, n\xf3 \u0111\xe3 b\u1ecb ng\u01b0\u1eddi kh\xe1c s\u1eed d\u1ee5ng. Trong tr\u01b0\u1eddng h\u1ee3p n\xe0y, giao d\u1ecbch kh\xf4ng th\xe0nh c\xf4ng m\xe0 kh\xf4ng ph\u1ea3i tr\u1ea3 ph\xed."),(0,h.kt)("p",null,"\u0110i\u1ec1u kh\xf4ng bao gi\u1edd n\xean x\u1ea3y ra trong c\xe1c tr\u01b0\u1eddng h\u1ee3p b\xecnh th\u01b0\u1eddng l\xe0 m\u1ed9t t\u1eadp l\u1ec7nh x\xe1c th\u1ef1c ch\u1ea1y v\xe0 sau \u0111\xf3 kh\xf4ng th\xe0nh c\xf4ng. \u0110i\u1ec1u n\xe0y l\xe0 do b\u1ea1n lu\xf4n c\xf3 th\u1ec3 ch\u1ea1y x\xe1c th\u1ef1c trong c\xf9ng m\u1ed9t \u0111i\u1ec1u ki\u1ec7n trong v\xed, v\xec v\u1eady n\xf3 s\u1ebd kh\xf4ng th\xe0nh c\xf4ng tr\u01b0\u1edbc khi b\u1ea1n g\u1eedi n\xf3."),(0,h.kt)("p",null,"V\xec v\u1eady, \u0111\xf3 l\xe0 m\u1ed9t t\xednh n\u0103ng r\u1ea5t hay, nh\u01b0ng kh\xf4ng r\xf5 r\xe0ng l\xe0 l\xe0m th\u1ebf n\xe0o \u0111\u1ec3 qu\u1ea3n l\xfd th\u1eddi gian trong context \u0111\xf3. Th\u1eddi gian r\u1ea5t quan tr\u1ecdng, b\u1edfi v\xec ch\xfang t\xf4i mu\u1ed1n th\u1ec3 hi\u1ec7n r\u1eb1ng m\u1ed9t giao d\u1ecbch nh\u1ea5t \u0111\u1ecbnh ch\u1ec9 c\xf3 hi\u1ec7u l\u1ef1c tr\u01b0\u1edbc ho\u1eb7c ch\u1ec9 c\xf3 hi\u1ec7u l\u1ef1c sau khi \u0111\xe3 \u0111\u1ea1t \u0111\u1ebfn m\u1ed9t th\u1eddi \u0111i\u1ec3m nh\u1ea5t \u0111\u1ecbnh."),(0,h.kt)("p",null,"Ch\xfang ta \u0111\xe3 th\u1ea5y m\u1ed9t v\xed d\u1ee5 v\u1ec1 \u0111i\u1ec1u n\xe0y trong b\xe0i gi\u1ea3ng m\u1ed9t - v\xed d\u1ee5 \u0111\u1ea5u gi\xe1 (bid), trong \u0111\xf3 gi\xe1 th\u1ea7u ch\u1ec9 \u0111\u01b0\u1ee3c ph\xe9p cho \u0111\u1ebfn khi \u0111\u1ea1t \u0111\u1ebfn th\u1eddi h\u1ea1n cu\u1ed1i c\xf9ng v\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"close")," ch\u1ec9 khi c\xf3 th\u1ec3 g\u1ecdi ",(0,h.kt)("em",{parentName:"p"},"Endpoint")," sau khi th\u1eddi h\u1ea1n \u0111\xe3 qua."),(0,h.kt)("p",null,"\u0110i\u1ec1u \u0111\xf3 d\u01b0\u1eddng nh\u01b0 l\xe0 m\u1ed9t s\u1ef1 m\xe2u thu\u1eabn, b\u1edfi v\xec th\u1eddi gian r\xf5 r\xe0ng l\xe0 \u0111ang tr\xf4i. V\xec v\u1eady, khi b\u1ea1n c\u1ed1 g\u1eafng x\xe1c th\u1ef1c m\u1ed9t giao d\u1ecbch m\xe0 b\u1ea1n \u0111ang t\u1ea1o trong v\xed c\u1ee7a m\xecnh, t\u1ea5t nhi\xean, th\u1eddi gian b\u1ea1n \u0111ang th\u1ef1c hi\u1ec7n c\xf3 th\u1ec3 kh\xe1c v\u1edbi th\u1eddi gian giao d\u1ecbch \u0111\u1ebfn m\u1ed9t n\xfat \u0111\u1ec3 x\xe1c th\u1ef1c. V\xec v\u1eady, kh\xf4ng r\xf5 l\xe0m th\u1ebf n\xe0o \u0111\u1ec3 k\u1ebft h\u1ee3p hai \u0111i\u1ec1u n\xe0y l\u1ea1i v\u1edbi nhau \u0111\u1ec3 x\xe1c th\u1ef1c l\xe0 x\xe1c \u0111\u1ecbnh v\xe0 \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o r\u1eb1ng n\u1ebfu v\xe0 ch\u1ec9 khi, x\xe1c th\u1ef1c th\xe0nh c\xf4ng trong v\xed, th\xec n\xf3 c\u0169ng s\u1ebd th\xe0nh c\xf4ng trong n\xfat."),(0,h.kt)("p",null,"C\xe1ch Cardano gi\u1ea3i quy\u1ebft \u0111i\u1ec1u \u0111\xf3, l\xe0 b\u1eb1ng c\xe1ch th\xeam tr\u01b0\u1eddng ph\u1ea1m vi v\u1ecb tr\xed ",(0,h.kt)("inlineCode",{parentName:"p"},"txInfoValidRange"),' v\xe0o m\u1ed9t giao d\u1ecbch, v\u1ec1 c\u01a1 b\u1ea3n n\xf3i r\u1eb1ng "Giao d\u1ecbch n\xe0y h\u1ee3p l\u1ec7 gi\u1eefa v\u1ecb tr\xed n\xe0y v\xe0 v\u1ecb tr\xed kia ".'),(0,h.kt)("p",null,"Khi m\u1ed9t giao d\u1ecbch \u0111\u01b0\u1ee3c g\u1eedi \u0111\u1ebfn blockchain v\xe0 \u0111\u01b0\u1ee3c x\xe1c th\u1ef1c b\u1edfi m\u1ed9t n\xfat, sau \u0111\xf3 tr\u01b0\u1edbc khi ch\u1ea1y b\u1ea5t k\u1ef3 t\u1eadp l\u1ec7nh n\xe0o, m\u1ed9t s\u1ed1 ki\u1ec3m tra chung s\u1ebd \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n, ch\u1eb3ng h\u1ea1n nh\u01b0 t\u1ea5t c\u1ea3 c\xe1c \u0111\u1ea7u v\xe0o \u0111\u1ec1u c\xf3 m\u1eb7t v\xe0 s\u1ed1 d\u01b0 c\u1ed9ng l\u1ea1i, ph\xed \u0111\u01b0\u1ee3c bao g\u1ed3m, v.v."),(0,h.kt)("p",null,"M\u1ed9t trong nh\u1eefng ki\u1ec3m tra x\u1ea3y ra tr\u01b0\u1edbc khi x\xe1c th\u1ef1c l\xe0 ki\u1ec3m tra xem ph\u1ea1m vi v\u1ecb tr\xed c\xf3 h\u1ee3p l\u1ec7 hay kh\xf4ng. N\xfat s\u1ebd xem x\xe9t th\u1eddi \u0111i\u1ec3m hi\u1ec7n t\u1ea1i v\xe0 ki\u1ec3m tra xem n\xf3 c\xf3 n\u1eb1m trong ph\u1ea1m vi v\u1ecb tr\xed h\u1ee3p l\u1ec7 c\u1ee7a giao d\u1ecbch hay kh\xf4ng. N\u1ebfu kh\xf4ng, th\xec x\xe1c th\u1ef1c kh\xf4ng th\xe0nh c\xf4ng ngay l\u1eadp t\u1ee9c m\xe0 kh\xf4ng bao gi\u1edd ch\u1ea1y c\xe1c t\u1eadp l\u1ec7nh tr\xecnh x\xe1c th\u1ef1c."),(0,h.kt)("p",null,"V\xec v\u1eady, n\u1ebfu ki\u1ec3m tra tr\u01b0\u1edbc th\xe0nh c\xf4ng, th\xec \u0111i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 th\u1eddi gian hi\u1ec7n t\u1ea1i r\u01a1i v\xe0o ph\u1ea1m vi v\u1ecb tr\xed h\u1ee3p l\u1ec7. \u0110\u1ebfn l\u01b0\u1ee3t n\xf3, \u0111i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 ch\xfang ta l\u1ea1i ho\xe0n to\xe0n x\xe1c \u0111\u1ecbnh \u0111\u01b0\u1ee3c. T\u1eadp l\u1ec7nh x\xe1c th\u1ef1c c\xf3 th\u1ec3 \u0111\u01a1n gi\u1ea3n gi\u1ea3 \u0111\u1ecbnh r\u1eb1ng n\xf3 \u0111ang \u0111\u01b0\u1ee3c ch\u1ea1y t\u1ea1i m\u1ed9t v\u1ecb tr\xed h\u1ee3p l\u1ec7."),(0,h.kt)("p",null,"Theo m\u1eb7c \u0111\u1ecbnh, m\u1ed9t t\u1eadp l\u1ec7nh s\u1ebd s\u1eed d\u1ee5ng ph\u1ea1m vi v\u1ecb tr\xed v\xf4 h\u1ea1n, m\u1ed9t t\u1eadp l\u1ec7nh bao g\u1ed3m t\u1ea5t c\u1ea3 c\xe1c v\u1ecb tr\xed b\u1eaft \u0111\u1ea7u t\u1eeb kh\u1ed1i g\u1ed1c v\xe0 ch\u1ea1y cho \u0111\u1ebfn h\u1ebft th\u1eddi gian."),(0,h.kt)("p",null,"C\xf3 m\u1ed9t s\u1ef1 ph\u1ee9c t\u1ea1p nh\u1ecf v\u1edbi \u0111i\u1ec1u n\xe0y, \u0111\xf3 l\xe0 Ouroboros, giao th\u1ee9c \u0111\u1ed3ng thu\u1eadn cung c\u1ea5p n\u0103ng l\u01b0\u1ee3ng cho Cardano kh\xf4ng s\u1eed d\u1ee5ng th\u1eddi gian POSIX, n\xf3 s\u1eed d\u1ee5ng c\xe1c khe c\u1eafm. Nh\u01b0ng Plutus s\u1eed d\u1ee5ng th\u1eddi gian th\u1ef1c, v\xec v\u1eady ch\xfang ta c\u1ea7n c\xf3 kh\u1ea3 n\u0103ng chuy\u1ec3n \u0111\u1ed5i qua l\u1ea1i gi\u1eefa th\u1eddi gian th\u1ef1c v\xe0 th\u1eddi \u0111i\u1ec3m. \u0110i\u1ec1u n\xe0y kh\xf4ng c\xf3 v\u1ea5n \u0111\u1ec1 g\xec mi\u1ec5n l\xe0 th\u1eddi gian r\xe3nh \u0111\u01b0\u1ee3c c\u1ed1 \u0111\u1ecbnh. Ngay b\xe2y gi\u1edd l\xe0 m\u1ed9t gi\xe2y, v\xec v\u1eady ngay b\xe2y gi\u1edd n\xf3 l\xe0 d\u1ec5 d\xe0ng."),(0,h.kt)("p",null,"Tuy nhi\xean, \u0111i\u1ec1u n\xe0y c\xf3 th\u1ec3 thay \u0111\u1ed5i trong t\u01b0\u01a1ng lai. C\xf3 th\u1ec3 c\xf3 m\u1ed9t \u0111\u1ee3t hard fork v\u1edbi m\u1ed9t s\u1ed1 thay \u0111\u1ed5i th\xf4ng s\u1ed1 s\u1ebd thay \u0111\u1ed5i th\u1eddi gian c\u1ee7a v\u1ecb tr\xed. Ch\xfang t\xf4i kh\xf4ng th\u1ec3 bi\u1ebft tr\u01b0\u1edbc \u0111i\u1ec1u \u0111\xf3. V\xed d\u1ee5, ch\xfang t\xf4i kh\xf4ng bi\u1ebft \u0111\u1ed9 d\xe0i v\u1ecb tr\xed s\u1ebd l\xe0 bao nhi\xeau trong 10 n\u0103m n\u1eefa."),(0,h.kt)("p",null,"\u0110i\u1ec1u \u0111\xf3 c\xf3 ngh\u0129a l\xe0 c\xe1c kho\u1ea3ng th\u1eddi gian \u0111\u01b0\u1ee3c x\xe1c \u0111\u1ecbnh cho c\xe1c giao d\u1ecbch kh\xf4ng \u0111\u01b0\u1ee3c c\xf3 gi\u1edbi h\u1ea1n tr\xean x\xe1c \u0111\u1ecbnh l\xe0 qu\xe1 xa trong t\u01b0\u01a1ng lai. Ch\u1ec9 c\xe0ng xa trong t\u01b0\u01a1ng lai th\xec ng\u01b0\u1eddi ta m\u1edbi c\xf3 th\u1ec3 bi\u1ebft \u0111\u01b0\u1ee3c \u0111\u1ed9 d\xe0i r\xe3nh s\u1ebd l\xe0 bao nhi\xeau. \u0110i\u1ec1u n\xe0y x\u1ea3y ra t\u01b0\u01a1ng t\u1ef1 nh\u01b0 36 gi\u1edd. Ch\xfang t\xf4i bi\u1ebft r\u1eb1ng n\u1ebfu s\u1eafp c\xf3 m\u1ed9t \u0111\u1ee3t hard fork, ch\xfang t\xf4i s\u1ebd bi\u1ebft v\u1ec1 n\xf3 tr\u01b0\u1edbc \xedt nh\u1ea5t 36 gi\u1edd."),(0,h.kt)("h3",{id:"posixtimerange"},"POSIXTimeRange"),(0,h.kt)("p",null,"H\xe3y xem ",(0,h.kt)("inlineCode",{parentName:"p"},"POSIXTimeRange")," n\xe0y , \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong ",(0,h.kt)("inlineCode",{parentName:"p"},"Plutus.V1.Ledger.Time"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"type POSIXTimeRange = Interval POSIXTime.\n")),(0,h.kt)("p",null,"N\xf3 l\xe0 m\u1ed9t lo\u1ea1i t\u1eeb \u0111\u1ed3ng ngh\u0129a v\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval POSIXTime")," v\xe0 ch\xfang ta th\u1ea5y r\u1eb1ng n\xf3 ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a b\u1edfi  ",(0,h.kt)("inlineCode",{parentName:"p"},"LowerBound")," v\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"UpperBound"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Interval\n      ivFrom :: LowerBound a\n      inTo   :: UpperBound a      \n")),(0,h.kt)("p",null,"N\u1ebfu ch\xfang ta \u0111i s\xe2u v\xe0o, ",(0,h.kt)("inlineCode",{parentName:"p"},"LowerBound")," ch\xfang ta s\u1ebd th\u1ea5y h\xe0m t\u1ea1o"),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data LowerBound a = LowerBound (Extended a) Closure\n")),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"Closure")," l\xe0 m\u1ed9t t\u1eeb \u0111\xf4ng ngh\u0129a v\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"Bool")," v\xe0 ch\u1eafc ch\u1eafn r\u1eb1ng c\xf3 \u0111\u01b0a v\xe0o ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," hay kh\xf4ng."),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"Extended")," c\xf3 th\u1ec3 l\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"NegInf")," \xe2m v\xf4 c\xf9ng, ",(0,h.kt)("inlineCode",{parentName:"p"},"PosInf")," d\u01b0\u01a1ng v\xf4 c\xf9ng, ho\u1eb7c ",(0,h.kt)("inlineCode",{parentName:"p"},"Finite"),"."),(0,h.kt)("p",null,"Ch\xfang t\xf4i c\u0169ng t\xecm th\u1ea5y m\u1ed9t s\u1ed1 h\xe0m tr\u1ee3 gi\xfap bao g\u1ed3m c\u1ea3 h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"member")," ki\u1ec3m tra xem m\u1ed9t c\xe1i \u0111\xe3 cho ",(0,h.kt)("inlineCode",{parentName:"p"},"a")," c\xf3 ph\u1ea3i l\xe0 m\u1ed9t ph\u1ea7n c\u1ee7a m\u1ed9t c\xe1i \u0111\xe3 cho hay kh\xf4ng ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval"),", mi\u1ec5n l\xe0 ki\u1ec3u c\u1ee7a ",(0,h.kt)("inlineCode",{parentName:"p"},"a")," l\xe0 m\u1ed9t ki\u1ec3u con c\u1ee7a ",(0,h.kt)("inlineCode",{parentName:"p"},"Ord"),", \u0111\xe2y l\xe0 tr\u01b0\u1eddng h\u1ee3p cho ",(0,h.kt)("inlineCode",{parentName:"p"},"POSIXTime"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"member :: Ord a => a -> Interval a -> Bool\nmember a i = i `contains` singleton a\n")),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"interval")," l\xe0 m\u1ed9t h\xe0m t\u1ea1o th\xf4ng minh cho ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," Ki\u1ec3u n\xe0y t\u1ea1o ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," v\u1edbi gi\u1edbi h\u1ea1n tr\xean v\xe0 d\u01b0\u1edbi."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"interval :: a -> a -> Interval a\ninterval s s' = Interval (lowerBound s) (upperBound s')\n")),(0,h.kt)("p",null,"Sau \u0111\xf3 ch\xfang ta c\xf3 ",(0,h.kt)("inlineCode",{parentName:"p"},"from")," v\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," c\xe1i n\xe0y b\u1eaft \u0111\u1ea7u t\u1eeb ",(0,h.kt)("inlineCode",{parentName:"p"},"a"),"\nv\xe0 k\xe9o d\xe0i \u0111\u1ebfn v\xf4 c\xf9ng."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"from :: a -> Interval a\nfrom s = Interval (lowerBound s) (UpperBound PosInf True)\n")),(0,h.kt)("p",null,"V\xe0 ch\xfang ta c\xf3 ",(0,h.kt)("inlineCode",{parentName:"p"},"to"),", n\xf3 l\xe0 ng\u01b0\u1edbc l\u1ea1i v\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"from"),". N\xf3 c\u0169ng \u0111\u01b0\u1ee3c d\xf9ng ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval"),"\nn\xf3 b\u1eaft \u0111\u1ea7u block genesis t\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"a"),", v\xe0 bao g\u1ed3m c\u1ea3 ",(0,h.kt)("inlineCode",{parentName:"p"},"a"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"to :: a -> Interval a\nto s = Interval (LowerBound NegInf True) (upperBound s)\n")),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"always")," lu\xf4n m\u1eb7c \u0111\u1ecbnh ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," bao g\u1ed3m t\u1ea5t c\u1ea3 t\u1eeb \xe2m v\xf4 c\xf9ng \u0111\u1ebfn d\u01b0\u01a1ng v\xf4 c\xf9ng."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"always :: Interval a\nalways = Interval (LowerBound NegInf True) (UpperBound PosInf True)\n")),(0,h.kt)("p",null,"v\xe0 c\xf3 \u0111i\u1ec1u ng\u01b0\u01a1c l\u1ea1i, ",(0,h.kt)("inlineCode",{parentName:"p"},"never"),", N\xf3 kh\xf4ng ch\u1ee9a slots n\xe0o."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"never :: Interval a\nnever = Interval (LowerBound PosInf True) (UpperBound NegInf True)\n")),(0,h.kt)("p",null,"Ngo\xe0i ra c\xf2n tr\xecnh tr\u1ee3 gi\xfap ",(0,h.kt)("inlineCode",{parentName:"p"},"singleton"),", n\xf3 bao g\u1ed3m m\u1ed9t slot"),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"singleton :: a -> Interval a\nsingleton s = interval s s      \n")),(0,h.kt)("p",null,"H\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"hull")," cho kho\u1ea3ng nh\u1ecf nh\u1ea5t ch\u1ee9a c\u1ea3 hai kho\u1ea3ng \u0111\xe3 cho."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"hull :: Ord a => Interval a -> Interval a -> Interval a\nhull (Interval l1 h1) (Interval l2 h2) = Interval (min l1 l2) (max h1 h2)\n")),(0,h.kt)("p",null,"Ch\u1ee9c n\u0103ng ",(0,h.kt)("inlineCode",{parentName:"p"},"intersection")," x\xe1c \u0111\u1ecbnh kho\u1ea3ng th\u1eddi gian l\u1edbn nh\u1ea5t \u0111\u01b0\u1ee3c ch\u1ee9a trong c\u1ea3 kho\u1ea3ng th\u1eddi gian nh\u1ea5t \u0111\u1ecbnh. \u0110\xe2y l\xe0 m\u1ed9t ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," b\u1eaft \u0111\u1ea7u t\u1eeb gi\u1edbi h\u1ea1n d\u01b0\u1edbi l\u1edbn nh\u1ea5t c\u1ee7a hai kho\u1ea3ng v\xe0 k\xe9o d\xe0i cho \u0111\u1ebfn gi\u1edbi h\u1ea1n tr\xean nh\u1ecf nh\u1ea5t."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"intersection :: Ord a => Interval a -> Interval a -> Interval a\nintersection (Interval l1 h1) (Interval l2 h2) = Interval (max l1 l2) (min h1 h2)    \n")),(0,h.kt)("p",null,"H\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"overlaps")," ki\u1ec3m tra ch\u1ee9c n\u0103ng cho d\xf9 hai kho\u1ea3ng th\u1eddi gian ch\u1ed3ng l\xean nhau, c\xf3 ngh\u0129a l\xe0, cho d\xf9 c\xf3 m\u1ed9t gi\xe1 tr\u1ecb ch\u1ed3ng l\xean nhau c\u1ee7a c\u1ea3 hai kho\u1ea3ng th\u1eddi gian."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"overlaps :: Ord a => Interval a -> Interval a -> Bool\noverlaps l r = isEmpty (l `intersection` r)\n")),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"contains")," tl\u1ea5y hai kho\u1ea3ng v\xe0 x\xe1c \u0111\u1ecbnh xem kho\u1ea3ng th\u1ee9 hai c\xf3 ho\xe0n to\xe0n n\u1eb1m trong kho\u1ea3ng th\u1eddi gian \u0111\u1ea7u ti\xean hay kh\xf4ng."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"contains :: Ord a => Interval a -> Interval a -> Bool\ncontains (Interval l1 h1) (Interval l2 h2) = l1 <= l2 && h2 <= h1\n")),(0,h.kt)("p",null,"V\xe0 ch\xfang t\xf4i c\xf3 c\xe1c ch\u1ee9c n\u0103ng ",(0,h.kt)("inlineCode",{parentName:"p"},"before")," v\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"after")," \u0111\u1ec3 x\xe1c \u0111\u1ecbnh n\u1ebfu m\u1ed9t th\u1eddi gian nh\u1ea5t \u0111\u1ecbnh t\u01b0\u01a1ng \u1ee9ng, tr\u01b0\u1edbc ho\u1eb7c sau m\u1ecdi th\u1ee9 trong m\u1ed9t th\u1eddi gian nh\u1ea5t \u0111\u1ecbnh ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"before :: Ord a => a -> Interval a -> Bool\nbefore h (Interval f _) = lowerBound h < f\n\nafter :: Ord a => a -> Interval a -> Bool\nafter h (Interval _ t) = upperBound h > t\n")),(0,h.kt)("p",null,"H\xe3y v\xe0o trong REPL."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Week03.Homework1> import Plutus.V1.Ledger.Interval\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1>\n")),(0,h.kt)("p",null,"H\xe3y x\xe2y d\u1ef1ng ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," t\u1eeb 10 \u0111\u1ebfn 20, bao g\u1ed3m c\u1ea3 hai \u0111\u1ea7u."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Plutus.V1.Ledger.Interval Week03.Homework1> interval (10 :: Integer) 20\nInterval {ivFrom = LowerBound (Finite 10) True, ivTo = UpperBound (Finite 20) True}\n")),(0,h.kt)("p",null,"Ch\xfang ta c\xf3 th\u1ec3 ki\u1ec3m tra xem m\u1ed9t gi\xe1 tr\u1ecb c\xf3 ph\u1ea3i l\xe0 th\xe0nh vi\xean c\u1ee7a m\u1ed9t kho\u1ea3ng hay kh\xf4ng:"),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Plutus.V1.Ledger.Interval Week03.Homework1> member 9 $ interval (10 :: Integer) 20\nFalse\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 10 $ interval (10 :: Integer) 20\nTrue\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 12 $ interval (10 :: Integer) 20\nTrue\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 20 $ interval (10 :: Integer) 20\nTrue\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 21 $ interval (10 :: Integer) 20\nFalse\n")),(0,h.kt)("p",null,"Ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"from"),". \u1ede \u0111\xe2y gi\u1edbi h\u1ea1n d\u01b0\u1edbi l\u1ea1i l\xe0 m\u1ed9t slot h\u1eefu h\u1ea1n, nh\u01b0ng gi\u1edbi h\u1ea1n tr\xean l\xe0 d\u01b0\u01a1ng v\xf4 c\xf9ng."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Plutus.V1.Ledger.Interval Week03.Homework1> member 21 $ from (30 :: Integer)\nFalse\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 30 $ from (30 :: Integer)\nTrue\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 300000 $ from (30 :: Integer)\nTrue\n")),(0,h.kt)("p",null,"V\xe0 h\xe0m t\u1ea1o ",(0,h.kt)("inlineCode",{parentName:"p"},"to"),". \u1ede \u0111\xe2y gi\u1edbi h\u1ea1n d\u01b0\u1edbi l\xe0 \xe2m v\xf4 c\xf9ng, trong khi gi\u1edbi h\u1ea1n tr\xean l\xe0 s\u1ed1 slot h\u1eefu h\u1ea1n."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Plutus.V1.Ledger.Interval Week03.Homework1> member 300000 $ to (30 :: Integer)\nFalse\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 31 $ to (30 :: Integer)\nFalse\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 30 $ to (30 :: Integer)\nTrue\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> member 7 $ to (30 :: Integer)\nTrue\n")),(0,h.kt)("p",null,"B\xe2y gi\u1edd, ch\xfang ta h\xe3y th\u1eed h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"intersection")," v\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," t\u1eeb 10 \u0111\u1ebfn 20 v\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," t\u1eeb 18 \u0111\u1ebfn 30."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Plutus.V1.Ledger.Interval Week03.Homework1> intersection (interval (10 :: Integer) 20) $ interval 18 30\nInterval {ivFrom = LowerBound (Finite 18) True, ivTo = UpperBound (Finite 20) True}\n")),(0,h.kt)("p",null,"Nh\u01b0 mong \u0111\u1ee3i, ch\xfang t\xf4i nh\u1eadn \u0111\u01b0\u1ee3c nh\u1eefng ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," ch\u1ea1y t\u1eeb 18 \u0111\u1ebfn 20, bao g\u1ed3m c\u1ea3 gi\xe1 tr\u1ecb hai \u0111\u1ea7u."),(0,h.kt)("p",null,"Ch\xfang t\xf4i c\xf3 th\u1ec3 ki\u1ec3m tra xem m\u1ed9t c\xe1i ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," c\xf3 ch\u1ee9a c\xe1i kh\xe1c hay kh\xf4ng."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Plutus.V1.Ledger.Interval Week03.Homework1> contains (to (100 :: Integer)) $ interval 30 80\nTrue\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> contains (to (100 :: Integer)) $ interval 30 100\nTrue\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> contains (to (100 :: Integer)) $ interval 30 101\nFalse\n")),(0,h.kt)("p",null,"We see that as soon as the second ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," extends to 101, it is no\nlonger fully contained within the ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," that runs to 100."),(0,h.kt)("p",null,"However, if we check with ",(0,h.kt)("inlineCode",{parentName:"p"},"overlaps"),", then it will be true because there\nare elements, such as 40, that are contained in both intervals."),(0,h.kt)("p",null,"Ch\xfang t\xf4i th\u1ea5y r\u1eb1ng ngay sau khi gi\xe2y th\u1ee9 hai ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," k\xe9o d\xe0i \u0111\u1ebfn 101, n\xf3 kh\xf4ng c\xf2n \u0111\u01b0\u1ee3c ch\u1ee9a \u0111\u1ea7y \u0111\u1ee7 b\xean trong gi\xe1 tr\u1ecb ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," ch\u1ea1y \u0111\u1ebfn 100."),(0,h.kt)("p",null,"Tuy nhi\xean, n\u1ebfu ch\xfang ta ki\u1ec3m tra v\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"overlaps"),", th\xec n\xf3 s\u1ebd \u0111\xfang v\xec c\xf3 c\xe1c ph\u1ea7n t\u1eed, ch\u1eb3ng h\u1ea1n nh\u01b0 40, \u0111\u01b0\u1ee3c ch\u1ee9a trong c\u1ea3 hai kho\u1ea3ng."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Plutus.V1.Ledger.Interval Week03.Homework1> overlaps (to (100 :: Integer)) $ interval 30 101\nTrue\n\nPrelude Plutus.V1.Ledger.Interval Week03.Homework1> overlaps (to (100 :: Integer)) $ interval 101 110\nFalse\n")),(0,h.kt)("h2",{id:"v\xed-d\u1ee5---vesting"},"V\xed d\u1ee5 - Vesting"),(0,h.kt)("p",null,"H\xe3y t\u01b0\u1edfng t\u01b0\u1ee3ng b\u1ea1n mu\u1ed1n t\u1eb7ng m\u1ed9t m\xf3n qu\xe0 c\u1ee7a Ada cho m\u1ed9t \u0111\u1ee9a tr\u1ebb. B\u1ea1n mu\u1ed1n \u0111\u1ee9a tr\u1ebb s\u1edf h\u1eefu Ada, nh\u01b0ng b\u1ea1n ch\u1ec9 mu\u1ed1n \u0111\u1ee9a tr\u1ebb c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o n\xf3 khi tr\xf2n m\u01b0\u1eddi t\xe1m tu\u1ed5i."),(0,h.kt)("p",null,"S\u1eed d\u1ee5ng Plutus, n\xf3 r\u1ea5t d\u1ec5 th\u1ef1c hi\u1ec7n. L\xe0 h\u1ee3p \u0111\u1ed3ng \u0111\u1ea7u ti\xean c\u1ee7a ch\xfang t\xf4i s\u1ebd xem x\xe9t \u0111\u1ed1i s\u1ed1 ng\u1eef c\u1ea3nh, ch\xfang t\xf4i s\u1ebd th\u1ef1c hi\u1ec7n m\u1ed9t h\u1ee3p \u0111\u1ed3ng th\u1ef1c hi\u1ec7n m\u1ed9t k\u1ebf ho\u1ea1ch vesting. Ti\u1ec1n s\u1ebd \u0111\u01b0\u1ee3c \u0111\u01b0a v\xe0o m\u1ed9t k\u1ecbch b\u1ea3n v\xe0 sau \u0111\xf3 n\xf3 c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c l\u1ea5y b\u1edfi m\u1ed9t ng\u01b0\u1eddi n\xe0o \u0111\xf3, nh\u01b0ng ch\u1ec9 khi \u0111\u1ebfn m\u1ed9t th\u1eddi h\u1ea1n nh\u1ea5t \u0111\u1ecbnh."),(0,h.kt)("p",null,"Ch\xfang t\xf4i b\u1eaft \u0111\u1ea7u b\u1eb1ng c\xe1ch sao ch\xe9p h\u1ee3p \u0111\u1ed3ng ",(0,h.kt)("inlineCode",{parentName:"p"},"IsData")," t\u1eeb b\xe0i gi\u1ea3ng 2 v\xe0o m\u1ed9t m\xf4-\u0111un m\u1edbi \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"Vesting"),"."),(0,h.kt)("p",null,"B\u01b0\u1edbc \u0111\u1ea7u ti\xean l\xe0 suy ngh\u0129 v\u1ec1 c\xe1c lo\u1ea1i cho d\u1eef li\u1ec7u v\xe0 c\xf4ng c\u1ee5 \u0111\u1ed5i."),(0,h.kt)("p",null,"\u0110\u1ed1i v\u1edbi d\u1eef li\u1ec7u, \u0111i\u1ec1u h\u1ee3p l\xfd l\xe0 c\xf3 hai ph\u1ea7n th\xf4ng tin, ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xe0 th\u1eddi h\u1ea1n. V\xec v\u1eady, h\xe3y x\xe1c \u0111\u1ecbnh lo\u1ea1i n\xe0y:"),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data VestingDatum = VestingDatum\n   { beneficiary :: PubKeyHash\n   , deadline    :: POSIXTime\n   } deriving Show\n\nPlutusTx.unstableMakeIsData ''VestingDatum\n")),(0,h.kt)("p",null,"\u0110\u1ec3 bi\u1ebft ai \u0111\xf3 c\xf3 th\u1ec3 chi ti\xeau \u0111\u1ea7u ra t\u1eadp l\u1ec7nh n\xe0y hay kh\xf4ng, c\u1ea7n c\xf3 hai th\xf4ng tin, t\u1ee9c l\xe0 ch\u1eef k\xfd c\u1ee7a ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xe0 th\u1eddi gian c\u1ee7a giao d\u1ecbch. Trong tr\u01b0\u1eddng h\u1ee3p n\xe0y, c\u1ea3 hai ph\u1ea7n th\xf4ng tin \u0111\xf3 \u0111\u1ec1u \u0111\u01b0\u1ee3c ch\u1ee9a trong ch\xednh giao d\u1ecbch. \u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 ch\xfang t\xf4i kh\xf4ng c\u1ea7n b\u1ea5t k\u1ef3 th\xf4ng tin n\xe0o trong tr\xecnh redeemer, v\xec v\u1eady ch\xfang t\xf4i ch\u1ec9 c\xf3 th\u1ec3 s\u1eed d\u1ee5ng  ",(0,h.kt)("inlineCode",{parentName:"p"},"()")," cho tr\xecnh redeemer."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"mkValidator :: VestingDatum -> () -> ScriptContext -> Bool\n")),(0,h.kt)("p",null,"Ch\xfang ta c\u1ea7n ki\u1ec3m tra hai \u0111i\u1ec1u ki\u1ec7n."),(0,h.kt)("ol",null,(0,h.kt)("li",{parentName:"ol"},"Ch\u1ec9 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng ch\xednh x\xe1c m\u1edbi c\xf3 th\u1ec3 m\u1edf kh\xf3a UTxO t\u1ea1i \u0111\u1ecba ch\u1ec9 n\xe0y. Ch\xfang t\xf4i c\xf3 th\u1ec3 x\xe1c nh\u1eadn \u0111i\u1ec1u n\xe0y b\u1eb1ng c\xe1ch ki\u1ec3m tra xem ch\u1eef k\xfd c\u1ee7a ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng c\xf3 \u0111\u01b0\u1ee3c bao g\u1ed3m trong giao d\u1ecbch hay kh\xf4ng."),(0,h.kt)("li",{parentName:"ol"},"R\u1eb1ng giao d\u1ecbch n\xe0y ch\u1ec9 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n sau khi \u0111\u1ebfn th\u1eddi h\u1ea1n cu\u1ed1i c\xf9ng.")),(0,h.kt)("p",null,"Ch\xfang t\xf4i c\xf3 th\u1ec3 ch\u1ec9 vi\u1ebft \u0111i\u1ec1u n\xe0y trong m\u1ed9t l\u1ea7n, nh\u01b0ng ch\xfang t\xf4i s\u1ebd vi\u1ebft n\xf3 theo ki\u1ec3u t\u1eeb tr\xean xu\u1ed1ng v\xe0 \u1ee7y quy\u1ec1n cho m\u1ed9t s\u1ed1 ch\u1ee9c n\u0103ng tr\u1ee3 gi\xfap."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'mkValidator dat () ctx =\n      mkValidator dat () ctx = traceIfFalse "beneficiary\'s signature missing" signedByBeneficiary &&\n                               traceIfFalse "deadline not reached" deadlineReached\nwhere\n      info :: TxInfo\n      info = scriptContextTxInfo ctx\n')),(0,h.kt)("p",null,"\u0110\u1ec3 ki\u1ec3m tra xem giao d\u1ecbch c\xf3 \u0111\u01b0\u1ee3c k\xfd b\u1edfi ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng hay kh\xf4ng, ch\xfang t\xf4i c\xf3 th\u1ec3 l\u1ea5y kh\xf3a c\xf4ng khai c\u1ee7a ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng t\u1eeb d\u1eef li\u1ec7u v\xe0 chuy\u1ec3n n\xf3, c\xf9ng v\u1edbi th\xf4ng tin giao d\u1ecbch v\xe0o ",(0,h.kt)("inlineCode",{parentName:"p"},"txSignedBy"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"signedByBeneficiary :: Bool\nsignedByBeneficiary = txSignedBy info $ beneficiary dat\n")),(0,h.kt)("p",null,"L\xe0m th\u1ebf n\xe0o \u0111\u1ec3 ch\xfang t\xf4i ki\u1ec3m tra xem th\u1eddi h\u1ea1n \u0111\xe3 qua?"),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(3963).Z})),(0,h.kt)("p",null,"H\xe3y xem x\xe9t m\u1ed9t giao d\u1ecbch c\xf3 gi\xe1 tr\u1ecb h\u1ee3p l\u1ec7 v\u01b0\u1ee3t qua th\u1eddi h\u1ea1n, \u0111\u01b0\u1ee3c hi\u1ec3n th\u1ecb d\u01b0\u1edbi d\u1ea1ng ph\u1ea1m vi cao nh\u1ea5t trong bi\u1ec3u \u0111\u1ed3 tr\xean."),(0,h.kt)("p",null,"Nh\u1edb l\u1ea1i r\u1eb1ng tr\u01b0\u1edbc khi ch\u1ea1y t\u1eadp l\u1ec7nh tr\xecnh x\xe1c th\u1ef1c, c\xe1c ki\u1ec3m tra kh\xe1c \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n, bao g\u1ed3m c\u1ea3 ki\u1ec3m tra th\u1eddi gian. N\xfat ki\u1ec3m tra xem th\u1eddi gian hi\u1ec7n t\u1ea1i c\xf3 n\u1eb1m trong ph\u1ea1m vi h\u1ee3p l\u1ec7 c\u1ee7a giao d\u1ecbch hay kh\xf4ng v\xe0 ch\u1ec9 sau \u0111\xf3 tr\xecnh x\xe1c th\u1ef1c m\u1edbi \u0111\u01b0\u1ee3c ch\u1ea1y. V\xec v\u1eady, ch\xfang t\xf4i bi\u1ebft r\u1eb1ng, n\u1ebfu ch\xfang t\xf4i \u0111ang \u1edf trong tr\xecnh x\xe1c th\u1ef1c, th\u1eddi gian hi\u1ec7n t\u1ea1i n\u1eb1m \u1edf \u0111\xe2u \u0111\xf3 trong kho\u1ea3ng th\u1eddi gian hi\u1ec7u l\u1ef1c."),(0,h.kt)("p",null,"Trong tr\u01b0\u1eddng h\u1ee3p ph\u1ea1m vi v\u01b0\u1ee3t qua th\u1eddi h\u1ea1n, m\xe3 tr\xecnh x\xe1c th\u1ef1c kh\xf4ng th\u1ec3 bi\u1ebft li\u1ec7u th\u1eddi \u0111i\u1ec3m hi\u1ec7n t\u1ea1i l\xe0 tr\u01b0\u1edbc hay sau th\u1eddi h\u1ea1n. Trong tr\u01b0\u1eddng h\u1ee3p n\xe0y, ng\u01b0\u1eddi x\xe1c nh\u1eadn ph\u1ea3i tuy\xean b\u1ed1 r\u1eb1ng giao d\u1ecbch kh\xf4ng h\u1ee3p l\u1ec7."),(0,h.kt)("p",null,"Tuy nhi\xean, v\xed d\u1ee5 th\u1ee9 hai trong s\u01a1 \u0111\u1ed3 l\xe0 t\u1ed1t. Ch\xfang t\xf4i v\u1eabn ch\u01b0a bi\u1ebft ch\xednh x\xe1c th\u1eddi gian hi\u1ec7n t\u1ea1i l\xe0 bao nhi\xeau, nh\u01b0ng ch\xfang t\xf4i bi\u1ebft r\u1eb1ng d\xf9 th\u1eddi gian l\xe0 bao nhi\xeau th\xec c\u0169ng s\u1ebd \u0111\u1ebfn sau th\u1eddi h\u1ea1n."),(0,h.kt)("p",null,"V\xec v\u1eady, nh\u1eefng g\xec ch\xfang t\xf4i \u0111ang ki\u1ec3m tra l\xe0 to\xe0n b\u1ed9 kho\u1ea3ng th\u1eddi gian hi\u1ec7u l\u1ef1c n\u1eb1m \u1edf b\xean ph\u1ea3i c\u1ee7a th\u1eddi h\u1ea1n. M\u1ed9t c\xe1ch \u0111\u1ec3 l\xe0m \u0111i\u1ec1u n\xe0y l\xe0 s\u1eed d\u1ee5ng  h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"contains")," \u0111\u1ec3 ki\u1ec3m tra xem kho\u1ea3ng th\u1eddi gian hi\u1ec7u l\u1ef1c c\xf3 \u0111\u01b0\u1ee3c ch\u1ee9a \u0111\u1ea7y \u0111\u1ee7 trong kho\u1ea3ng th\u1eddi gian b\u1eaft \u0111\u1ea7u t\u1eeb th\u1eddi h\u1ea1n v\xe0 k\xe9o d\xe0i cho \u0111\u1ebfn h\u1ebft th\u1eddi gian hay kh\xf4ng. "),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"deadlineReached :: Bool\ndeadlineReached = contains (from $ deadline dat) $ txInfoValidRange info\n")),(0,h.kt)("p",null,"\u0110i\u1ec1u \u0111\xf3 ho\xe0n th\xe0nh logic x\xe1c th\u1ef1c. H\xe3y quan t\xe2m \u0111\u1ebfn m\u1ed9t s\u1ed1 t\u1ea5m boilerplate."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data Vesting\ninstance Scripts.ValidatorTypes Vesting where\n    type instance DatumType Vesting = VestingDatum\n    type instance RedeemerType Vesting = ()\n\ntypedValidator :: Scripts.TypedValidator Vesting\ntypedValidator = Scripts.mkTypedValidator @Vesting\n    $$(PlutusTx.compile [|| mkValidator ||])\n    $$(PlutusTx.compile [|| wrap ||])\n  where\n    wrap = Scripts.wrapValidator @VestingDatum @()\n")),(0,h.kt)("p",null,"Ch\xfang t\xf4i s\u1ebd t\u1eadp trung nhi\u1ec1u h\u01a1n v\xe0o ph\u1ea7n v\xed c\u1ee7a script sau, nh\u01b0ng \u0111\xe2y l\xe0 nh\u1eefng thay \u0111\u1ed5i."),(0,h.kt)("p",null,"Ngo\xe0i ra th\xeam v\xe0o tham s\u1ed1 m\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"LANGUAGE")," v\xe0 m\u1ed9t s\u1ed1 imports b\u1ed5 xung, chung t\xf4i c\xf3 t\u1ea1o ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"GiveParams"),", v\xe0 s\u1eeda endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"grab")," \u0111\u1ec3 kh\xf4ng y\xeau c\u1ea7u tham s\u1ed1."),(0,h.kt)("p",null,"C\xe1c ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"VestingSchema")," \u0111\u1ecbnh ngh\u0129a endpoints c\xe1i m\xe0 Ch\xfang ta mu\u1ed1n \u0111\u1ec3 l\u1ed9 cho ng\u01b0\u1eddi d\xf9ng. Nh\u01b0 trong v\xed d\u1ee5 cu\u1ed1i c\xf9ng c\u1ee7a ch\xfang t\xf4i, ",(0,h.kt)("inlineCode",{parentName:"p"},"give")," s\u1ebd \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng b\u1edfi ng\u01b0\u1eddi d\xf9ng \u0111\u1eb7t ti\u1ec1n v\xe0o h\u1ee3p \u0111\u1ed3ng, sau \u0111\xf3 ",(0,h.kt)("inlineCode",{parentName:"p"},"grab")," s\u1ebd \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng b\u1edfi ng\u01b0\u1eddi d\xf9ng mu\u1ed1n nh\u1eadn ti\u1ec1n."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'type VestingSchema =\n   .\\/ Endpoint "give" GiveParams\n   .\\/ Endpoint "grab" ()\n')),(0,h.kt)("p",null,"V\u1eady ch\xfang ta c\u1ea7n nh\u1eefng th\xf4ng s\u1ed1 n\xe0o ",(0,h.kt)("inlineCode",{parentName:"p"},"give"),"? Endpoint s\u1ebd t\u1ea1o m\u1ed9t UTxO t\u1ea1i \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh vesting v\u1edbi m\u1ed9t s\u1ed1 ti\u1ec1n v\xe0 m\u1ed9t m\u1ee9c d\u1eef li\u1ec7u. N\u1ebfu b\u1ea1n nh\u1edb l\u1ea1i, datum c\u1ee7a ch\xfang t\xf4i ch\u1ee9a ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xe0 th\u1eddi h\u1ea1n. V\xec v\u1eady, c\xf3 ba ph\u1ea7n th\xf4ng tin m\xe0 ch\xfang ta ph\u1ea3i chuy\u1ec3n \u0111\u1ebfn endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"give"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data GiveParams = GiveParams\n   { gpBeneficiary :: !PubKeyHash\n   , gpDeadline    :: !POSIXTime\n   , gpAmount      :: !Integer\n   } deriving (Generic, ToJSON, FromJSON, ToSchema)\n")),(0,h.kt)("p",null," Endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"grab"),"  kh\xf4ng y\xeau c\u1ea7u b\u1ea5t k\u1ef3 tham s\u1ed1 n\xe0o v\xec ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng s\u1ebd ch\u1ec9 t\xecm c\xe1c UTxO \u1edf \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh v\xe0 sau \u0111\xf3 c\xf3 th\u1ec3 ki\u1ec3m tra xem h\u1ecd c\xf3 ph\u1ea3i l\xe0 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng hay kh\xf4ng v\xe0 th\u1eddi h\u1ea1n \u0111\xe3 qua hay ch\u01b0a. N\u1ebfu v\u1eady, h\u1ecd c\xf3 th\u1ec3 ti\xeau th\u1ee5 ch\xfang."),(0,h.kt)("p",null,"H\xe3y nhanh ch\xf3ng nh\xecn v\xe0o endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"give")," ."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'give :: AsContractError e => GiveParams -> Contract w s e ()\ngive gp = do\n    let dat = VestingDatum\n                { beneficiary = gpBeneficiary gp\n                , deadline    = gpDeadline gp\n                }\n        tx  = mustPayToTheScript dat $ Ada.lovelaceValueOf $ gpAmount gp\n    ledgerTx <- submitTxConstraints typedValidator tx\n    void $ awaitTxConfirmed $ txId ledgerTx\n    logInfo @String $ printf "made a gift of %d lovelace to %s with deadline %s"\n        (gpAmount gp)\n        (show $ gpBeneficiary gp)\n        (show $ gpDeadline gp)\n')),(0,h.kt)("p",null,"\u0110\u1ea7u ti\xean, ch\xfang t\xf4i t\xednh to\xe1n d\u1eef li\u1ec7u m\xe0 ch\xfang t\xf4i mu\u1ed1n s\u1eed d\u1ee5ng v\xe0 ch\xfang t\xf4i c\xf3 th\u1ec3 nh\u1eadn \u0111\u01b0\u1ee3c c\u1ea3 hai ph\u1ea7n th\xf4ng tin t\u1eeb ",(0,h.kt)("inlineCode",{parentName:"p"},"GiveParams")," \u0111\xf3 \u0111\u01b0\u1ee3c chuy\u1ec3n v\xe0o h\xe0m."),(0,h.kt)("p",null,"Sau \u0111\xf3, \u0111\u1ed1i v\u1edbi giao d\u1ecbch, ch\xfang t\xf4i th\xeam m\u1ed9t r\xe0ng bu\u1ed9c r\u1eb1ng ph\u1ea3i c\xf3 m\u1ed9t \u0111\u1ea7u ra t\u1ea1i \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh n\xe0y v\u1edbi d\u1eef li\u1ec7u m\xe0 ch\xfang t\xf4i v\u1eeba x\xe1c \u0111\u1ecbnh v\xe0 m\u1ed9t s\u1ed1 lovelace nh\u1ea5t \u0111\u1ecbnh, m\xe0 ch\xfang t\xf4i c\u0169ng nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb ",(0,h.kt)("inlineCode",{parentName:"p"},"GiveParams"),"."),(0,h.kt)("p",null,"Ph\u1ea7n c\xf2n l\u1ea1i c\u1ee7a ch\u1ee9c n\u0103ng v\u1eabn nh\u01b0 tr\u01b0\u1edbc, ch\u1ec9 v\u1edbi m\u1ed9t th\xf4ng b\xe1o nh\u1eadt k\xfd kh\xe1c."),(0,h.kt)("p",null,"Endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"grab"),"  c\xf3 li\xean quan nhi\u1ec1u h\u01a1n m\u1ed9t ch\xfat."),(0,h.kt)("p",null,"C\xf3 th\u1ec3 c\xf3 nhi\u1ec1u UTxO t\u1ea1i \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh n\xe0y v\xe0 m\u1ed9t s\u1ed1 trong s\u1ed1 ch\xfang c\xf3 th\u1ec3 kh\xf4ng ph\xf9 h\u1ee3p v\u1edbi ch\xfang t\xf4i, v\xec ch\xfang t\xf4i kh\xf4ng ph\u1ea3i l\xe0 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng ho\u1eb7c v\xec th\u1eddi h\u1ea1n ch\u01b0a tr\xf4i qua. N\u1ebfu ch\xfang t\xf4i c\u1ed1 g\u1eafng g\u1eedi m\u1ed9t giao d\u1ecbch khi kh\xf4ng c\xf3 UTxO ph\xf9 h\u1ee3p, ch\xfang t\xf4i s\u1ebd tr\u1ea3 ph\xed nh\u01b0ng kh\xf4ng nh\u1eadn l\u1ea1i \u0111\u01b0\u1ee3c g\xec."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'grab :: forall w s e. AsContractError e => Contract w s e ()\ngrab = do\n    now   <- currentTime\n    pkh   <- pubKeyHash <$> ownPubKey\n    utxos <- Map.filter (isSuitable pkh now) <$> utxoAt scrAddress\n    if Map.null utxos\n        then logInfo @String $ "no gifts available"\n        else do\n            let orefs   = fst <$> Map.toList utxos\n                lookups = Constraints.unspentOutputs utxos  <>\n                          Constraints.otherScript validator\n                tx :: TxConstraints Void Void\n                tx      = mconcat [mustSpendScriptOutput oref $ Redeemer $ PlutusTx.toData () | oref <- orefs] <>\n                          mustValidateIn (from now)\n            ledgerTx <- submitTxConstraintsWith @Void lookups tx\n            void $ awaitTxConfirmed $ txId ledgerTx\n            logInfo @String $ "collected gifts"\n  where\n    isSuitable :: PubKeyHash -> POSIXTime -> TxOutTx -> Bool\n    isSuitable pkh now o = case txOutDatumHash $ txOutTxOut o of\n        Nothing -> False\n        Just h  -> case Map.lookup h $ txData $ txOutTxTx o of\n            Nothing        -> False\n            Just (Datum e) -> case PlutusTx.fromData e of\n                Nothing -> False\n                Just d  -> beneficiary d == pkh && deadline d <= now\n')),(0,h.kt)("p",null,"\u0110\u1ea7u ti\xean, ch\xfang t\xf4i l\u1ea5y th\u1eddi gian hi\u1ec7n t\u1ea1i v\xe0 t\xednh to\xe1n b\u0103m kh\xf3a c\xf4ng khai c\u1ee7a ch\xfang t\xf4i. Sau \u0111\xf3, ch\xfang t\xf4i tra c\u1ee9u t\u1ea5t c\u1ea3 c\xe1c UTxO t\u1ea1i \u0111\u1ecba ch\u1ec9 n\xe0y v\xe0 l\u1ecdc ch\xfang b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"isSuitable")," tr\u1ee3 gi\xfap, \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong m\u1ec7nh \u0111\u1ec1 ",(0,h.kt)("inlineCode",{parentName:"p"},"where"),"."),(0,h.kt)("p",null,"Tr\u01b0\u1edbc ti\xean, n\xf3 ki\u1ec3m tra b\u0103m datum v\xe0 n\u1ebfu t\xecm th\u1ea5y n\xf3, n\xf3 s\u1ebd c\u1ed1 g\u1eafng t\xecm ki\u1ebfm datum t\u01b0\u01a1ng \u1ee9ng. Nh\u1edb l\u1ea1i r\u1eb1ng giao d\u1ecbch s\u1ea3n xu\u1ea5t, trong tr\u01b0\u1eddng h\u1ee3p ",(0,h.kt)("inlineCode",{parentName:"p"},"give")," n\xe0y kh\xf4ng ph\u1ea3i cung c\u1ea5p datum, n\xf3 ch\u1ec9 c\u1ea7n cung c\u1ea5p b\u0103m datum. Tuy nhi\xean, trong tr\u01b0\u1eddng h\u1ee3p c\u1ee7a ch\xfang ta, ch\xfang ta c\u1ea7n c\xf3 s\u1eb5n d\u1eef li\u1ec7u cho endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"grab")," , v\xec v\u1eady endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"give")," cung c\u1ea5p datum."),(0,h.kt)("p",null,"N\u1ebfu endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"grab")," t\xecm th\u1ea5y datum, n\xf3 ph\u1ea3i gi\u1ea3i th\xedch n\xf3 th\xe0nh ki\u1ec3u",(0,h.kt)("inlineCode",{parentName:"p"},"Vesting")," ."),(0,h.kt)("p",null,"N\u1ebfu t\u1ea5t c\u1ea3 nh\u1eefng \u0111i\u1ec1u n\xe0y th\xe0nh c\xf4ng, ch\xfang t\xf4i c\xf3 th\u1ec3 ki\u1ec3m tra xem ch\xfang t\xf4i c\xf3 ph\u1ea3i l\xe0 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng hay kh\xf4ng v\xe0 th\u1eddi h\u1ea1n \u0111\xe3 qua hay ch\u01b0a."),(0,h.kt)("p",null,"T\u1ea1i th\u1eddi \u0111i\u1ec3m n\xe0y, ",(0,h.kt)("inlineCode",{parentName:"p"},"utxos")," ch\u1ee9a t\u1ea5t c\u1ea3 c\xe1c UTxO m\xe0 ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng. N\u1ebfu ch\xfang t\xf4i kh\xf4ng t\xecm th\u1ea5y, th\xec ch\xfang t\xf4i ch\u1ec9 c\u1ea7n ghi l\u1ea1i m\u1ed9t th\xf4ng b\xe1o cho hi\u1ec7u \u1ee9ng \u0111\xf3. N\u1ebfu c\xf3 \xedt nh\u1ea5t m\u1ed9t giao d\u1ecbch, th\xec ch\xfang t\xf4i t\u1ea1o m\u1ed9t giao d\u1ecbch s\u1eed d\u1ee5ng t\u1ea5t c\u1ea3 ch\xfang l\xe0m \u0111\u1ea7u v\xe0o v\xe0 thanh to\xe1n ti\u1ec1n v\xe0o v\xed c\u1ee7a ch\xfang t\xf4i."),(0,h.kt)("p",null,"Nh\u01b0 ",(0,h.kt)("inlineCode",{parentName:"p"},"lookups"),", ch\xfang t\xf4i cung c\u1ea5p danh s\xe1ch c\xe1c UTxO c\u0169ng nh\u01b0 t\u1eadp l\u1ec7nh tr\xecnh x\xe1c th\u1ef1c. Nh\u1edb l\u1ea1i r\u1eb1ng, \u0111\u1ec3 s\u1eed d\u1ee5ng UTxO t\u1ea1i \u0111\u1ecba ch\u1ec9 n\xe0y, giao d\u1ecbch chi ti\xeau ph\u1ea3i cung c\u1ea5p t\u1eadp l\u1ec7nh x\xe1c th\u1ef1c."),(0,h.kt)("p",null,"Sau \u0111\xf3, ch\xfang t\xf4i t\u1ea1o m\u1ed9t giao d\u1ecbch s\u1eed d\u1ee5ng t\u1ea5t c\u1ea3 c\xe1c UTxO ph\xf9 h\u1ee3p c\xf9ng v\u1edbi m\u1ed9t r\xe0ng bu\u1ed9c m\xe0 n\xf3 ph\u1ea3i x\xe1c th\u1ef1c trong \u0111\xf3 ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," k\xe9o d\xe0i t\u1eeb slot hi\u1ec7n t\u1ea1i cho \u0111\u1ebfn h\u1ebft th\u1eddi gian. N\u1ebfu ch\xfang t\xf4i kh\xf4ng cung c\u1ea5p kho\u1ea3ng th\u1eddi gian \u1edf \u0111\xe2y, th\xec vi\u1ec7c x\xe1c th\u1ef1c s\u1ebd kh\xf4ng th\xe0nh c\xf4ng, v\xec kho\u1ea3ng th\u1eddi gian m\u1eb7c \u0111\u1ecbnh l\xe0 t\u1eeb ban \u0111\u1ea7u cho \u0111\u1ebfn khi k\u1ebft th\xfac th\u1eddi gian. X\xe1c th\u1ef1c tr\xean chu\u1ed7i s\u1ebd t\u1eeb ch\u1ed1i \u0111i\u1ec1u n\xe0y v\xec n\xf3 c\u1ea7n m\u1ed9t kho\u1ea3ng th\u1eddi gian \u0111\u01b0\u1ee3c ch\u1ee9a \u0111\u1ea7y \u0111\u1ee7 trong kho\u1ea3ng th\u1eddi gian k\xe9o d\xe0i t\u1eeb th\u1eddi h\u1ea1n cho \u0111\u1ebfn khi k\u1ebft th\xfac th\u1eddi gian."),(0,h.kt)("p",null,"Ch\xfang t\xf4i c\xf3 th\u1ec3 s\u1eed d\u1ee5ng  ",(0,h.kt)("inlineCode",{parentName:"p"},"Interval")," ",(0,h.kt)("inlineCode",{parentName:"p"},"now"),", nh\u01b0ng n\u1ebfu c\xf3 b\u1ea5t k\u1ef3 s\u1ef1 c\u1ed1 n\xe0o, ch\u1eb3ng h\u1ea1n nh\u01b0 s\u1ef1 ch\u1eadm tr\u1ec5 c\u1ee7a m\u1ea1ng v\xe0 giao d\u1ecbch \u0111\u1ebfn m\u1ed9t n\xfat mu\u1ed9n h\u01a1n m\u1ed9t ho\u1eb7c hai v\u1ecb tr\xed, th\xec qu\xe1 tr\xecnh x\xe1c th\u1ef1c s\u1ebd kh\xf4ng ho\u1ea1t \u0111\u1ed9ng n\u1eefa."),(0,h.kt)("p",null,"v\xe0 gi\u1edd, ch\xfang ta ch\u1ec9 t\u1eadp h\u1ee3p c\xe1c endpoints."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"endpoints :: Contract () VestingSchema Text ()\nendpoints = (give' `select` grab') >> endpoints\n  where\n    give' = endpoint @\"give\" >>= give\n    grab' = endpoint @\"grab\" >>  grab\n")),(0,h.kt)("p",null,"Sau \u0111\xf3, c\xf3 m\u1ed9t s\u1ed1 t\u1ea5m b\u1ea3ng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng trong playground."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"mkSchemaDefinitions ''VestingSchema\n\nmkKnownCurrencies []\n")),(0,h.kt)("h3",{id:"in-the-playground"},"In the playground"),(0,h.kt)("p",null,"\u0110\u1ea7u ti\xean, h\xe3y th\xeam m\u1ed9t v\xed th\u1ee9 ba. Ch\xfang t\xf4i s\u1ebd t\u1ea1o m\u1ed9t k\u1ecbch b\u1ea3n trong \u0111\xf3 V\xed 1 t\u1ea1o hai qu\xe0 t\u1eb7ng cho V\xed 2 v\u1edbi th\u1eddi h\u1ea1n kh\xe1c nhau v\xe0 c\u0169ng t\u1ea1o m\u1ed9t qu\xe0 t\u1eb7ng cho V\xed 3."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(5828).Z})),(0,h.kt)("p",null,"Th\xf4ng th\u01b0\u1eddng, c\xf3 th\u1ec3 g\u1eedi c\u1ea3 hai givegiao d\u1ecbch trong c\xf9ng m\u1ed9t v\u1ecb tr\xed, nh\u01b0ng c\xe1ch m\xe3 c\u1ee7a ch\xfang t\xf4i \u0111\u01b0\u1ee3c tri\u1ec3n khai, ch\xfang t\xf4i ch\u1edd x\xe1c nh\u1eadn, c\xf3 ngh\u0129a l\xe0 ch\xfang t\xf4i c\u1ea7n th\xeam h\xe0nh \u0111\u1ed9ng ch\u1edd. \u0110\xe2y c\xf3 th\u1ec3 kh\xf4ng ph\u1ea3i l\xe0 c\xe1ch t\u1ed1t nh\u1ea5t \u0111\u1ec3 l\xe0m \u0111i\u1ec1u \u0111\xf3, nh\u01b0ng \u0111\xf3 l\xe0 c\xe1ch l\xe0m trong th\u1eddi \u0111i\u1ec3m hi\u1ec7n t\u1ea1i."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(2711).Z})),(0,h.kt)("p",null,"\u1ede \u0111\xe2y ch\xfang t\xf4i g\u1eb7p ph\u1ea3i v\u1ea5n \u0111\u1ec1 \u0111\u1ea7u ti\xean c\u1ee7a ch\xfang t\xf4i. Ch\xfang t\xf4i c\u1ea7n cung c\u1ea5p \u0111\u1ecba ch\u1ec9 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng, nh\u01b0ng kh\xf4ng c\xf3 c\xe1ch n\xe0o trong s\xe2n ch\u01a1i \u0111\u1ec3 l\u1ea5y m\xe3 b\u0103m kh\xf3a c\xf4ng khai c\u1ee7a v\xed."),(0,h.kt)("p",null,"Nh\u01b0ng ch\xfang ta c\xf3 th\u1ec3 l\u1ea5y n\xf3 t\u1eeb REPL."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Week03.Homework1> :l src/Week03/Vesting.hs \nOk, one module loaded.\nPrelude Week03.Vesting> import Ledger\nPrelude Ledger Week03.Vesting> import Wallet.Emulator\nPrelude Ledger Wallet.Emulator Week03.Vesting> pubKeyHash $ walletPubKey $ Wallet 2\n39f713d0a644253f04529421b9f51b9b08979d08295959c4f3990ee617f5139f\nPrelude Ledger Wallet.Emulator Week03.Vesting> pubKeyHash $ walletPubKey $ Wallet 3\ndac073e0123bdea59dd9b3bda9cf6037f63aca82627d7abcd5c4ac29dd74003e\n")),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(2552).Z})),(0,h.kt)("p",null,"V\u1ea5n \u0111\u1ec1 ti\u1ebfp theo l\xe0 th\u1eddi h\u1ea1n. Trong b\xe0i gi\u1ea3ng tr\u01b0\u1edbc, ch\xfang ta \u0111\xe3 bi\u1ebft c\xe1ch chuy\u1ec3n \u0111\u1ed5i gi\u1eefa c\xe1c v\u1ecb tr\xed v\xe0 th\u1eddi gian POSIX. \u0110i\u1ec1u n\xe0y \u0111\xe3 thay \u0111\u1ed5i. Tr\u01b0\u1edbc \u0111\xe2y, b\u1ea1n ch\u1ec9 c\u1ea7n m\u1ed9t v\u1ecb tr\xed v\xe0 xu\u1ea5t hi\u1ec7n th\u1eddi gian POSIX. B\xe2y gi\u1edd c\xf3 m\u1ed9t cu\u1ed9c tranh c\xe3i th\u1ee9 hai."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Ledger Wallet.Emulator Week03.Vesting> import Ledger.TimeSlot \nPrelude Ledger Wallet.Emulator Ledger.TimeSlot Week03.Vesting> :t slotToBeginPOSIXTime\nslotToBeginPOSIXTime :: SlotConfig -> Slot -> POSIXTime\n")),(0,h.kt)("p",null,"C\u0169ng c\xf3 nh\u1eefng phi\xean b\u1ea3n slotToBeginPOSIXTimec\xf3 th\u1eddi gian b\u1eaft \u0111\u1ea7u v\xe0 k\u1ebft th\xfac. \u0110i\u1ec1u n\xe0y l\xe0 do m\u1ed9t th\u1eddi \u0111i\u1ec3m kh\xf4ng ch\u1ec9 l\xe0 m\u1ed9t th\u1eddi \u0111i\u1ec3m, m\xe0 l\xe0 m\u1ed9t kho\u1ea3ng th\u1eddi gian."),(0,h.kt)("p",null,"V\u1eady \u0111\xe2y l\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"SlotConfig"),"?"),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Ledger Wallet.Emulator Ledger.TimeSlot Week03.Vesting> :i SlotConfig \ntype SlotConfig :: *\ndata SlotConfig\n  = SlotConfig {scSlotLength :: Integer, scZeroSlotTime :: POSIXTime}\n        -- Defined in \u2018Ledger.TimeSlot\u2019\ninstance Eq SlotConfig -- Defined in \u2018Ledger.TimeSlot\u2019\ninstance Show SlotConfig -- Defined in \u2018Ledger.TimeSlot\u2019\n")),(0,h.kt)("p",null,"N\xf3 t\xednh theo \u0111\u1ed9 d\xe0i v\u1ecb tr\xed v\xe0 th\u1eddi gian m\xe0 v\u1ecb tr\xed s\u1ed1 0 b\u1eaft \u0111\u1ea7u."),(0,h.kt)("p",null,"V\xec v\u1eady, b\xe2y gi\u1edd ch\xfang ta ph\u1ea3i t\xecm ra nh\u1eefng g\xec SlotConfig\u0111\u1ec3 s\u1eed d\u1ee5ng cho s\xe2n ch\u01a1i. May m\u1eafn thay, n\xf3 l\xe0 m\u1eb7c \u0111\u1ecbnh. \u0110\u1ec3 l\xe0m \u0111\u01b0\u1ee3c \u0111i\u1ec1u \u0111\xf3, ch\xfang ta c\u1ea7n s\u1eed d\u1ee5ng ",(0,h.kt)("inlineCode",{parentName:"p"},"Data.Default"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Ledger Wallet.Emulator Ledger.TimeSlot Week03.Vesting> import Data.Default\nPrelude Ledger Wallet.Emulator Ledger.TimeSlot Data.Default Week03.Vesting> def :: SlotConfig\nSlotConfig {scSlotLength = 1000, scZeroSlotTime = POSIXTime {getPOSIXTime = 1596059091000}}\n")),(0,h.kt)("p",null,"B\xe2y gi\u1edd ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ",(0,h.kt)("inlineCode",{parentName:"p"},"slotToBeginPOSIXTime")," v\u1edbi c\u1ea5u h\xecnh m\u1eb7c \u0111\u1ecbnh \u0111\u1ec3 l\u1ea5y th\u1eddi gian POSIX cho v\xf9ng 10 v\xe0 v\xf9ng 20."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"Prelude Ledger Wallet.Emulator Ledger.TimeSlot Data.Default Week03.Vesting> slotToBeginPOSIXTime def 10\nPOSIXTime {getPOSIXTime = 1596059101000}\n\nPrelude Ledger Wallet.Emulator Ledger.TimeSlot Data.Default Week03.Vesting> slotToBeginPOSIXTime def 20\nPOSIXTime {getPOSIXTime = 1596059111000}\n")),(0,h.kt)("p",null,"V\xe0 ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ch\xfang trong s\xe2n ch\u01a1i. Ch\xfang t\xf4i s\u1ebd s\u1eed d\u1ee5ng v\u1ecb tr\xed 10 l\xe0m th\u1eddi h\u1ea1n cho ",(0,h.kt)("inlineCode",{parentName:"p"},"give")," v\xed \u0111\u1ea7u ti\xean v\xe0 th\u1ee9 ba v\xe0 v\u1ecb tr\xed 20 cho ",(0,h.kt)("inlineCode",{parentName:"p"},"give")," v\xed th\u1ee9 hai. Ch\xfang t\xf4i c\u0169ng s\u1ebd \u0111\u01b0a ra 10 Ada trong m\u1ed7i tr\u01b0\u1eddng h\u1ee3p. "),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(186).Z})),(0,h.kt)("p",null,"H\xe3y t\u1ea1o m\u1ed9t k\u1ecbch b\u1ea3n m\xe0 m\u1ecdi th\u1ee9 \u0111\u1ec1u ho\u1ea1t \u0111\u1ed9ng. V\xed 3 nh\u1eadn \u1edf v\u1ecb tr\xed 10 khi th\u1eddi h\u1ea1n cho V\xed 3 \u0111\xe3 qua v\xe0 V\xed 2 l\u1ea5y \u1edf v\u1ecb tr\xed 20, khi c\u1ea3 hai th\u1eddi h\u1ea1n c\u1ee7a V\xed 2 \u0111\xe3 qua. Ch\xfang t\xf4i s\u1ebd s\u1eed d\u1ee5ng ",(0,h.kt)("inlineCode",{parentName:"p"},"Wait Until..")," t\xf9y ch\u1ecdn cho vi\u1ec7c n\xe0y."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(6408).Z})),(0,h.kt)("p",null,"Sau khi \u0111\xe1nh gi\xe1, \u0111\u1ea7u ti\xean ch\xfang ta th\u1ea5y giao d\u1ecbch Genesis."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(7678).Z})),(0,h.kt)("p",null,"N\u1ebfu ch\xfang ta xem x\xe9t giao d\u1ecbch ti\u1ebfp theo, ch\xfang ta th\u1ea5y qu\xe0 t\u1eb7ng t\u1eeb V\xed 1 \u0111\u1ebfn V\xed 2 v\u1edbi th\u1eddi h\u1ea1n l\xe0 10. T\u1ea1i \u0111\xe2y, m\u01b0\u1eddi Ada b\u1ecb kh\xf3a \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(1807).Z})),(0,h.kt)("p",null,"Giao d\u1ecbch ti\u1ebfp theo l\xe0 qu\xe0 t\u1eb7ng t\u1eeb V\xed 1 \u0111\u1ebfn V\xed 2 v\u1edbi th\u1eddi h\u1ea1n l\xe0 20. M\u1ed9t UTxO m\u1edbi hi\u1ec7n \u0111\xe3 \u0111\u01b0\u1ee3c t\u1ea1o t\u1ea1i \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh v\u1edbi m\u01b0\u1eddi Ada."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(6735).Z})),(0,h.kt)("p",null,"V\xe0 m\xf3n qu\xe0 th\u1ee9 ba, l\u1ea7n n\xe0y l\xe0 V\xed 3, v\u1edbi th\u1eddi h\u1ea1n l\xe0 10. V\xed 1 hi\u1ec7n c\xf3 kho\u1ea3ng 70 Ada v\xe0 m\u1ed9t UTxO kh\xe1c \u0111\u01b0\u1ee3c t\u1ea1o v\u1edbi 10 Ada b\u1ecb kh\xf3a t\u1ea1i \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(4669).Z})),(0,h.kt)("p",null,"T\u1ea1i v\u1ecb tr\xed s\u1ed1 10, V\xed ti\u1ec1n 3 l\u1ea5y th\xe0nh c\xf4ng. UTxO th\u1ee9 ba l\xe0 \u0111\u1ea7u v\xe0o, m\u1ed9t s\u1ed1 kho\u1ea3n ph\xed \u0111\u01b0\u1ee3c thanh to\xe1n v\xe0 sau \u0111\xf3 ph\u1ea7n c\xf2n l\u1ea1i c\u1ee7a cu\u1ed9c t\xecnh \u0111\u01b0\u1ee3c g\u1eedi \u0111\u1ebfn V\xed 3."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(2105).Z})),(0,h.kt)("p",null,"Sau \u0111\xf3, t\u1ea1i v\u1ecb tr\xed 20, Wallet 2 l\u1ea5y th\xe0nh c\xf4ng c\u1ea3 hai UTxO m\xe0 h\u1ecd l\xe0 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng. L\u1ea7n n\xe0y ph\xed cao h\u01a1n v\xec ph\u1ea3i ch\u1ea1y hai tr\xecnh x\xe1c th\u1ef1c."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(8068).Z})),(0,h.kt)("p",null,"S\u1ed1 d\u01b0 cu\u1ed1i c\xf9ng ph\u1ea3n \xe1nh nh\u1eefng thay \u0111\u1ed5i."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(3400).Z})),(0,h.kt)("p",null,"B\xe2y gi\u1edd ch\xfang ta h\xe3y xem x\xe9t tr\u01b0\u1eddng h\u1ee3p x\u1ea3y ra qu\xe1 s\u1edbm. Ch\xfang t\xf4i s\u1ebd t\u1ea1o cho Wallet 2 l\u1ea5y \u1edf v\u1ecb tr\xed 15 thay v\xec v\u1ecb tr\xed 20."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(2058).Z})),(0,h.kt)("p",null,"B\xe2y gi\u1edd ch\xfang ta th\u1ea5y r\u1eb1ng c\xe1c giao d\u1ecbch \u0111\u1ea7u ti\xean gi\u1ed1ng nhau, nh\u01b0ng giao d\u1ecbch cu\u1ed1i c\xf9ng t\u1ea1i v\u1ecb tr\xed 15 ch\u1ec9 c\xf3 m\u1ed9t \u0111\u1ea7u v\xe0o, v\xec UTxO th\u1ee9 hai ch\u01b0a c\xf3 s\u1eb5n."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(1032).Z})),(0,h.kt)("p",null,"V\xe0 ch\xfang ta c\xf3 th\u1ec3 th\u1ea5y r\u1eb1ng c\xf3 10 Ada v\u1eabn b\u1ecb kh\xf3a t\u1ea1i \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(1032).Z})),(0,h.kt)("p",null,"M\xe3 off-chain c\u1ee7a ch\xfang t\xf4i \u0111\u01b0\u1ee3c vi\u1ebft theo c\xe1ch m\xe0 n\xf3 s\u1ebd ch\u1ec9 g\u1eedi m\u1ed9t giao d\u1ecbch n\u1ebfu c\xf3 UTxO ph\xf9 h\u1ee3p c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c l\u1ea5y. \u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 ch\xfang t\xf4i kh\xf4ng th\u1ef1c s\u1ef1 s\u1eed d\u1ee5ng tr\xecnh x\xe1c th\u1ef1c v\xec ch\xfang t\xf4i ch\u1ec9 g\u1eedi c\xe1c giao d\u1ecbch \u0111\u1ebfn chu\u1ed7i kh\u1ed1i s\u1ebd v\u01b0\u1ee3t qua x\xe1c th\u1ef1c."),(0,h.kt)("p",null,"N\u1ebfu b\u1ea1n mu\u1ed1n ki\u1ec3m tra tr\xecnh x\xe1c th\u1ef1c, b\u1ea1n c\xf3 th\u1ec3 s\u1eeda \u0111\u1ed5i m\xe3 v\xed \u0111\u1ec3 \u0111i\u1ec3m cu\u1ed1i l\u1ea5y c\u1ed1 g\u1eafng l\u1ea5y m\u1ecdi th\u1ee9 v\xe0 sau \u0111\xf3 x\xe1c th\u1ef1c s\u1ebd kh\xf4ng th\xe0nh c\xf4ng n\u1ebfu b\u1ea1n kh\xf4ng ph\u1ea3i l\xe0 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng ho\u1eb7c ch\u01b0a \u0111\u1ebfn th\u1eddi h\u1ea1n."),(0,h.kt)("p",null,"B\u1ea1n c\u1ea7n l\u01b0u \xfd r\u1eb1ng b\u1ea5t k\u1ef3 ai c\u0169ng c\xf3 th\u1ec3 vi\u1ebft m\xe3 ngo\xe0i chu\u1ed7i. V\xec v\u1eady, m\u1eb7c d\xf9 n\xf3 ho\u1ea1t \u0111\u1ed9ng ngay b\xe2y gi\u1edd mi\u1ec5n l\xe0 b\u1ea1n s\u1eed d\u1ee5ng grab\u0111i\u1ec3m cu\u1ed1i m\xe0 ch\xfang t\xf4i \u0111\xe3 t\u1ef1 vi\u1ebft, ai \u0111\xf3 c\xf3 th\u1ec3 vi\u1ebft m\u1ed9t \u0111o\u1ea1n m\xe3 off-chain kh\xe1c kh\xf4ng l\u1ecdc c\xe1c UTxO nh\u01b0 ch\xfang t\xf4i \u0111\xe3 l\xe0m. Trong tr\u01b0\u1eddng h\u1ee3p n\xe0y, n\u1ebfu tr\xecnh x\xe1c nh\u1eadn kh\xf4ng \u0111\xfang, \u0111i\u1ec1u g\xec \u0111\xf3 c\xf3 th\u1ec3 sai kh\u1ee7ng khi\u1ebfp."),(0,h.kt)("h2",{id:"v\xed-d\u1ee5-2---parameterized-contract"},"V\xed d\u1ee5 2 - Parameterized Contract"),(0,h.kt)("p",null,"Ch\xfang ta s\u1ebd b\u1eaft \u0111\u1ea7u v\xed d\u1ee5 ti\u1ebfp theo b\u1eb1ng c\xe1ch sao ch\xe9p m\xe3 t\u1eeb v\xed d\u1ee5 vesting v\xe0o m\u1ed9t m\xf4-\u0111un m\u1edbi c\xf3 t\xean ",(0,h.kt)("inlineCode",{parentName:"p"},"Week03.Parameterized"),"."),(0,h.kt)("h3",{id:"on-chain"},"On-Chain"),(0,h.kt)("p",null,"L\u01b0u \xfd r\u1eb1ng trong v\xed d\u1ee5 vesting, ch\xfang t\xf4i \u0111\xe3 s\u1eed d\u1ee5ng ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"Vesting"),"  l\xe0m datum, nh\u01b0ng n\xf3 ch\u1ec9 \u0111\u01b0\u1ee3c s\u1eeda ch\u1eefa, n\xf3 kh\xf4ng thay \u0111\u1ed5i. Ngo\xe0i ra, ch\xfang t\xf4i c\xf3 th\u1ec3 \u0111\u01b0a n\xf3 v\xe0o h\u1ee3p \u0111\u1ed3ng, c\xf3 th\u1ec3 n\xf3i, \u0111\u1ec3 ch\xfang t\xf4i c\xf3 m\u1ed9t h\u1ee3p \u0111\u1ed3ng m\xe0 b\u1ea3n th\xe2n t\u1eadp l\u1ec7nh \u0111\xe3 ch\u1ee9a th\xf4ng tin v\u1ec1 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xe0 th\u1eddi h\u1ea1n."),(0,h.kt)("p",null,"T\u1ea5t c\u1ea3 c\xe1c v\xed d\u1ee5 v\u1ec1 h\u1ee3p \u0111\u1ed3ng m\xe0 ch\xfang t\xf4i \u0111\xe3 th\u1ea5y cho \u0111\u1ebfn nay \u0111\xe3 \u0111\u01b0\u1ee3c s\u1eeda ch\u1eefa. Ch\xfang t\xf4i \u0111\xe3 s\u1eed d\u1ee5ng ",(0,h.kt)("inlineCode",{parentName:"p"},"TypedValidator")," l\xe0m h\u1eb1ng s\u1ed1 th\u1eddi gian bi\xean d\u1ecbch. \xdd t\u01b0\u1edfng c\u1ee7a t\u1eadp l\u1ec7nh \u0111\u01b0\u1ee3c tham s\u1ed1 h\xf3a l\xe0 b\u1ea1n c\xf3 th\u1ec3 c\xf3 m\u1ed9t tham s\u1ed1 v\xe0 t\xf9y thu\u1ed9c v\xe0o gi\xe1 tr\u1ecb c\u1ee7a tham s\u1ed1, b\u1ea1n nh\u1eadn \u0111\u01b0\u1ee3c c\xe1c gi\xe1 tr\u1ecb kh\xe1c nhau c\u1ee7a ",(0,h.kt)("inlineCode",{parentName:"p"},"TypedValidator"),"."),(0,h.kt)("p",null,"SV\xec v\u1eady, thay v\xec x\xe1c \u0111\u1ecbnh m\u1ed9t t\u1eadp l\u1ec7nh, v\u1edbi m\u1ed9t \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh duy nh\u1ea5t, v\u1edbi t\u1ea5t c\u1ea3 c\xe1c UTxO \u1edf c\xf9ng m\u1ed9t \u0111\u1ecba ch\u1ec9, b\u1ea1n c\xf3 th\u1ec3 x\xe1c \u0111\u1ecbnh m\u1ed9t h\u1ecd t\u1eadp l\u1ec7nh \u0111\u01b0\u1ee3c tham s\u1ed1 h\xf3a b\u1edfi m\u1ed9t tham s\u1ed1 nh\u1ea5t \u0111\u1ecbnh. Trong tr\u01b0\u1eddng h\u1ee3p c\u1ee7a ch\xfang t\xf4i, \u0111i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 c\xe1c UTxO cho nh\u1eefng ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng kh\xe1c nhau v\xe0 / ho\u1eb7c th\u1eddi h\u1ea1n s\u1ebd l\xe0 m\u1ed9t \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh kh\xe1c, v\xec ch\xfang s\u1ebd c\xf3 tr\xecnh x\xe1c th\u1ef1c \u0111\u01b0\u1ee3c tham s\u1ed1 h\xf3a c\u1ee5 th\u1ec3 cho c\xe1c tham s\u1ed1 c\u1ee7a h\u1ecd thay v\xec c\u1ee5 th\u1ec3 cho d\u1eef li\u1ec7u c\u1ee7a UTxO."),(0,h.kt)("p",null,"Ch\xfang t\xf4i s\u1ebd tr\xecnh b\xe0y c\xe1ch th\u1ef1c hi\u1ec7n \u0111i\u1ec1u n\xe0y b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng m\u1ed9t tham s\u1ed1 thay v\xec s\u1eed d\u1ee5ng s\u1ed1 li\u1ec7u cho ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xe0 gi\xe1 tr\u1ecb th\u1eddi h\u1ea1n."),(0,h.kt)("p",null,"H\xe3y b\u1eaft \u0111\u1ea7u b\u1eb1ng c\xe1ch \u0111\u1ed5i t\xean ",(0,h.kt)("inlineCode",{parentName:"p"},"VestingDatum")," th\xe0nh m\u1ed9t c\xe1i g\xec \u0111\xf3 ph\xf9 h\u1ee3p h\u01a1n."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data VestingParam = VestingParam\n      { beneficiary :: PubKeyHash\n      , deadline    :: POSIXTime\n      } deriving Show\n")),(0,h.kt)("p",null,"Ch\xfang t\xf4i c\u0169ng s\u1ebd x\xf3a ",(0,h.kt)("inlineCode",{parentName:"p"},"unstableMakeIsData")," v\xec ch\xfang t\xf4i kh\xf4ng c\u1ea7n n\xf3 n\u1eefa."),(0,h.kt)("p",null,"L\xfd do ch\xfang ta kh\xf4ng c\u1ea7n n\xf3, l\xe0 v\xec ch\xfang ta s\u1ebd s\u1eed d\u1ee5ng ",(0,h.kt)("inlineCode",{parentName:"p"},"()")," cho datum trong h\xe0m  ",(0,h.kt)("inlineCode",{parentName:"p"},"mkValidator"),". T\u1ea5t c\u1ea3 th\xf4ng tin ch\xfang t\xf4i y\xeau c\u1ea7u s\u1ebd n\u1eb1m trong m\u1ed9t \u0111\u1ed1i s\u1ed1 m\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"mkValidator"),", thu\u1ed9c lo\u1ea1i ",(0,h.kt)("inlineCode",{parentName:"p"},"VestingParam")," m\xe0 ch\xfang t\xf4i th\xeam v\xe0o \u1edf \u0111\u1ea7u danh s\xe1ch c\xe1c \u0111\u1ed1i s\u1ed1."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'{-# INLINABLE mkValidator #-}\nmkValidator :: VestingParam -> () -> () -> ScriptContext -> Bool\nmkValidator p () () ctx = traceIfFalse "beneficiary\'s signature missing" signedByBeneficiary &&\n                          traceIfFalse "deadline not reached" deadlineReached\n  where\n    info :: TxInfo\n    info = scriptContextTxInfo ctx\n\n    signedByBeneficiary :: Bool\n    signedByBeneficiary = txSignedBy info $ beneficiary p\n\n    deadlineReached :: Bool\n    deadlineReached = contains (from $ deadline p) $ txInfoValidRange info\n')),(0,h.kt)("p",null,"Ch\xfang t\xf4i c\u0169ng thay \u0111\u1ed5i ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"Vesting")," \u0111\u1ec3 ph\u1ea3n \xe1nh s\u1ef1 thay \u0111\u1ed5i \u0111\u1ed1i v\u1edbi datum."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data Vesting\ninstance Scripts.ValidatorTypes Vesting where\n    type instance DatumType Vesting = ()\n    type instance RedeemerType Vesting = ()     \n")),(0,h.kt)("p",null,"B\xe2y gi\u1edd, ",(0,h.kt)("inlineCode",{parentName:"p"},"TypedValidator")," kh\xf4ng c\xf2n l\xe0 m\u1ed9t gi\xe1 tr\u1ecb kh\xf4ng \u0111\u1ed5i. Thay v\xe0o \u0111\xf3, n\xf3 s\u1ebd nh\u1eadn m\u1ed9t tham s\u1ed1."),(0,h.kt)("p",null,"Nh\u1edb l\u1ea1i r\u1eb1ng h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"mkTypedValidator"),"  y\xeau c\u1ea7u l\xe0 \u0111\u1ed1i s\u1ed1 \u0111\u1ea7u ti\xean c\u1ee7a n\xf3 m\xe3 \u0111\xe3 bi\xean d\u1ecbch c\u1ee7a m\u1ed9t h\xe0m nh\u1eadn ba \u0111\u1ed1i s\u1ed1 v\xe0 tr\u1ea3 v\u1ec1 m\u1ed9t ",(0,h.kt)("inlineCode",{parentName:"p"},"Bool"),". Nh\u01b0ng b\xe2y gi\u1edd, n\xf3 c\xf3 b\u1ed1n \u0111\u1ed1i s\u1ed1, v\xec v\u1eady ch\xfang ta c\u1ea7n t\xednh \u0111\u1ebfn \u0111i\u1ec1u \u0111\xf3."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"typedValidator :: VestingParam -> Scripts.TypedValidator Vesting\ntypedValidator p = Scripts.mkTypedValidator @Vesting      \n")),(0,h.kt)("p",null,"B\xe2y gi\u1edd, nh\u1eefng g\xec ch\xfang t\xf4i mu\u1ed1n l\xe0m l\xe0 m\u1ed9t c\xe1i g\xec \u0111\xf3 nh\u01b0 th\u1ebf n\xe0y, chuy\u1ec3n tham s\u1ed1 m\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," v\xe0o ",(0,h.kt)("inlineCode",{parentName:"p"},"mkValidator")," \u0111\u1ec3 m\xe3 \u0111\u01b0\u1ee3c bi\xean d\u1ecbch trong d\u1ea5u ngo\u1eb7c Oxford s\u1ebd c\xf3 ki\u1ec3u ch\xednh x\xe1c."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"-- this won't work\n$$(PlutusTx.compile [|| mkValidator p ||])\n$$(PlutusTx.compile [|| wrap ||])\nwhere\nwrap = Scripts.wrapValidator @() @()\n")),(0,h.kt)("p",null,"M\xe3 n\xe0y s\u1ebd kh\xf4ng ho\u1ea1t \u0111\u1ed9ng, nh\u01b0ng tr\u01b0\u1edbc khi ch\xfang t\xf4i \u0111i\u1ec1u tra, h\xe3y \u0111\u1ec3 m\xe3 nh\u01b0 hi\u1ec7n t\u1ea1i v\xe0 th\u1ef1c hi\u1ec7n th\xeam m\u1ed9t s\u1ed1 thay \u0111\u1ed5i \u0111\u1ed1i v\u1edbi ph\u1ea7n c\xf2n l\u1ea1i c\u1ee7a m\xe3."),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"validator")," b\xe2y gi\u1edd s\u1ebd nh\u1eadn m\u1ed9t ",(0,h.kt)("inlineCode",{parentName:"p"},"VestingParam")," v\xe0 s\u1ebd tr\u1ea3 v\u1ec1 m\u1ed9t h\xe0m \u0111\xe3 so\u1ea1n. H\xe0m \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 c\xf3 t\xe1c d\u1ee5ng m\xe0 b\u1ea5t k\u1ef3 tham s\u1ed1 n\xe0o \u0111\u01b0\u1ee3c truy\u1ec1n \u0111\u1ebfn ",(0,h.kt)("inlineCode",{parentName:"p"},"validator")," b\xe2y gi\u1edd s\u1ebd \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ebfn h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"typedValidator")," m\u1ed9t c\xe1ch hi\u1ec7u qu\u1ea3 , gi\xe1 tr\u1ecb tr\u1ea3 v\u1ec1 c\u1ee7a ch\xfang s\u1ebd \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ebfn ",(0,h.kt)("inlineCode",{parentName:"p"},"validatorScript"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"validator :: VestingParam -> Validator\nvalidator = Scripts.validatorScript . typedValidator\n")),(0,h.kt)("p",null,"V\xe0 t\u01b0\u01a1ng t\u1ef1 \u0111\u1ed1i v\u1edbi ",(0,h.kt)("inlineCode",{parentName:"p"},"valHash")," v\xe0 ",(0,h.kt)("inlineCode",{parentName:"p"},"scrAddress"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"valHash :: VestingParam -> Ledger.ValidatorHash\nvalHash = Scripts.validatorHash . typedValidator\n\nscrAddress :: VestingParam -> Ledger.Address\nscrAddress = scriptAddress . validator\n")),(0,h.kt)("p",null,"B\xe2y gi\u1edd, ch\xfang ta h\xe3y t\xecm hi\u1ec3u nh\u1eefng g\xec sai v\u1edbi h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"typedValidator")," ."),(0,h.kt)("p",null,"N\u1ebfu ch\xfang t\xf4i c\u1ed1 g\u1eafng kh\u1edfi ch\u1ea1y REPL, ch\xfang t\xf4i s\u1ebd g\u1eb7p l\u1ed7i bi\xean d\u1ecbch."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'GHC Core to PLC plugin: E043:Error: Reference to a name which is not a local, a builtin, or an external INLINABLE function: Variable p\nNo unfolding\nContext: Compiling expr: p\nContext: Compiling expr: Week03.Parameterized.mkValidator p\nContext: Compiling expr at "plutus-pioneer-program-week03-0.1.0.0-inplace:Week03.Parameterized:(67,10)-(67,48)"\n')),(0,h.kt)("p",null,"V\u1ea5n \u0111\u1ec1 l\xe0 d\xf2ng n\xe0y."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"-- this won't work\n$$(PlutusTx.compile [|| mkValidator p ||])\n")),(0,h.kt)("p",null,"Nh\u1edb l\u1ea1i r\u1eb1ng m\u1ecdi th\u1ee9 b\xean trong d\u1ea5u ngo\u1eb7c [] ph\u1ea3i \u0111\u01b0\u1ee3c bi\u1ebft r\xf5 r\xe0ng t\u1ea1i th\u1eddi \u0111i\u1ec3m bi\xean d\u1ecbch. Th\xf4ng th\u01b0\u1eddng, n\xf3 th\u1eadm ch\xed s\u1ebd c\u1ea7n t\u1ea5t c\u1ea3 m\xe3 \u0111\u01b0\u1ee3c vi\u1ebft r\xf5 r\xe0ng, nh\u01b0ng b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng th\u1ed1ng s\u1ed1 ",(0,h.kt)("inlineCode",{parentName:"p"},"INLINABLE")," trong h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"mkValidator"),", ch\xfang ta c\xf3 th\u1ec3 tham chi\u1ebfu h\xe0m \u0111\u1ec3 thay th\u1ebf. Tuy nhi\xean, n\xf3 v\u1eabn ph\u1ea3i \u0111\u01b0\u1ee3c bi\u1ebft t\u1ea1i th\u1eddi \u0111i\u1ec3m bi\xean d\u1ecbch, v\xec \u0111\xf3 l\xe0 c\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Template Haskell - n\xf3 \u0111\u01b0\u1ee3c th\u1ef1c thi tr\u01b0\u1edbc tr\xecnh bi\xean d\u1ecbch ch\xednh."),(0,h.kt)("p",null," ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," kh\xf4ng bi\u1ebft \u0111\u1ebfn l\xfac bi\xean d\u1ecbch, b\u1edfi v\xec ch\xfang t\xf4i c\xf3 \xfd \u0111\u1ecbnh cung c\u1ea5p n\xf3 khi ch\u1ea1y. May m\u1eafn thay, c\xf3 m\u1ed9t c\xe1ch \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 n\xe0y."),(0,h.kt)("p",null,"V\u1ec1 ph\xeda Haskell, ch\xfang t\xf4i c\xf3 h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"mkValidator")," c\u1ee7a m\xecnh v\xe0 ch\xfang t\xf4i c\xf3 ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"VestingParam"),". Ch\xfang t\xf4i c\xf3 th\u1ec3 bi\xean d\u1ecbch ",(0,h.kt)("inlineCode",{parentName:"p"},"mkValidator")," sang Plutus core, nh\u01b0ng ch\xfang t\xf4i kh\xf4ng th\u1ec3 bi\xean d\u1ecbch ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," sang Plutus core v\xec ch\xfang t\xf4i kh\xf4ng bi\u1ebft n\xf3 l\xe0 g\xec. Nh\u01b0ng, n\u1ebfu ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng phi\xean b\u1ea3n \u0111\xe3 bi\xean d\u1ecbch ",(0,h.kt)("inlineCode",{parentName:"p"},"p"),", ch\xfang ta c\xf3 th\u1ec3 \xe1p d\u1ee5ng phi\xean b\u1ea3n \u0111\xe3 bi\xean d\u1ecbch n\xe0y cho phi\xean b\u1ea3n \u0111\xe3 bi\xean d\u1ecbch mkValidatorv\xe0 \u0111i\u1ec1u n\xe0y s\u1ebd mang l\u1ea1i cho ch\xfang ta nh\u1eefng g\xec ch\xfang ta mu\u1ed1n."),(0,h.kt)("p",null,"\u0110i\u1ec1u n\xe0y d\u01b0\u1eddng nh\u01b0 kh\xf4ng gi\u1ea3i quy\u1ebft \u0111\u01b0\u1ee3c g\xec, b\u1edfi v\xec ch\xfang t\xf4i v\u1eabn c\u1ea7n m\u1ed9t phi\xean b\u1ea3n \u0111\xe3 bi\xean d\u1ecbch ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," v\xe0 ch\xfang t\xf4i c\xf3 c\xf9ng m\u1ed9t v\u1ea5n \u0111\u1ec1 ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," ch\u01b0a \u0111\u01b0\u1ee3c bi\u1ebft t\u1ea1i th\u1eddi \u0111i\u1ec3m bi\xean d\u1ecbch."),(0,h.kt)("p",null,"Tuy nhi\xean, ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," pkh\xf4ng ph\u1ea3i l\xe0 m\u1ed9t s\u1ed1 m\xe3 Haskell t\xf9y \xfd, m\xe0 l\xe0 d\u1eef li\u1ec7u, v\xec v\u1eady n\xf3 kh\xf4ng ch\u1ee9a b\u1ea5t k\u1ef3 lo\u1ea1i ch\u1ee9c n\u0103ng n\xe0o. N\u1ebfu ch\xfang ta th\u1ef1c hi\u1ec7n ki\u1ec3u c\u1ee7a ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," th\u1ec3 hi\u1ec7n c\u1ee7a l\u1edbp ki\u1ec3u \u0111\u01b0\u1ee3c g\u1ecdi ",(0,h.kt)("inlineCode",{parentName:"p"},"Lift"),". Ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ",(0,h.kt)("inlineCode",{parentName:"p"},"liftCode")," \u0111\u1ec3 bi\xean d\u1ecbch ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," trong th\u1eddi gian bi\xean d\u1ecbch sang Plutus Core v\xe0 sau \u0111\xf3, b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng ",(0,h.kt)("inlineCode",{parentName:"p"},"applyCode")," ch\xfang ta c\xf3 th\u1ec3 \xe1p d\u1ee5ng Plutus Core ",(0,h.kt)("inlineCode",{parentName:"p"},"p"),"  cho Plutus Core ",(0,h.kt)("inlineCode",{parentName:"p"},"mkValidator"),"."),(0,h.kt)("h4",{id:"l\u1edbp-lift"},"L\u1edbp Lift"),(0,h.kt)("p",null,"Ch\xfang ta h\xe3y nh\xecn s\u01a1 qua v\u1ec1 l\u1edbp ",(0,h.kt)("inlineCode",{parentName:"p"},"Lift"),"  N\xf3 \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong g\xf3i plutus-tx."),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"plutus-tx"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"module PlutusTx.Lift.Class\n")),(0,h.kt)("p",null,"N\xf3 ch\u1ec9 c\xf3 m\u1ed9t ch\u1ee9c n\u0103ng ",(0,h.kt)("inlineCode",{parentName:"p"},"Lift"),". Tuy nhi\xean, ch\xfang t\xf4i s\u1ebd kh\xf4ng s\u1eed d\u1ee5ng ch\u1ee9c n\u0103ng n\xe0y tr\u1ef1c ti\u1ebfp"),(0,h.kt)("p",null,"T\u1ea7m quan tr\u1ecdng c\u1ee7a l\u1edbp l\xe0 n\xf3 cho ph\xe9p ch\xfang ta, trong th\u1eddi gian ch\u1ea1y,  c\xe1c gi\xe1 tr\u1ecb lift c\u1ee7a Haskell th\xe0nh c\xe1c gi\xe1 tr\u1ecb t\u1eadp l\u1ec7nh Plutus t\u01b0\u01a1ng \u1ee9ng. V\xe0 \u0111\xe2y ch\xednh x\xe1c l\xe0 nh\u1eefng g\xec ch\xfang ta c\u1ea7n \u0111\u1ec3 chuy\u1ec3n tham s\u1ed1 c\u1ee7a m\xecnh ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," th\xe0nh m\xe3."),(0,h.kt)("p",null,"Ch\xfang ta s\u1ebd s\u1eed d\u1ee5ng m\u1ed9t h\xe0m kh\xe1c, \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong c\xf9ng m\u1ed9t g\xf3i nh\u01b0ng trong m\u1ed9t m\xf4-\u0111un kh\xe1c."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"module PlutusTx.Lift\n")),(0,h.kt)("p",null,"H\xe0m ch\xfang ta s\u1ebd s\u1eed d\u1ee5ng \u0111\u01b0\u1ee3c g\u1ecdi  ",(0,h.kt)("inlineCode",{parentName:"p"},"liftCode"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"-- | Get a Plutus Core program corresponding to the given value as a 'CompiledCodeIn', throwing any errors that occur as exceptions and ignoring fresh names.\nliftCode\n   :: (Lift.Lift uni a, Throwable uni fun, PLC.ToBuiltinMeaning uni fun)\n   => a -> CompiledCodeIn uni fun a\nliftCode x = unsafely $ safeLiftCode x\n")),(0,h.kt)("p",null,"N\xf3 nh\u1eadn m\u1ed9t gi\xe1 tr\u1ecb Haskell c\u1ee7a ki\u1ec3u ",(0,h.kt)("inlineCode",{parentName:"p"},"a"),", v\u1edbi \u0111i\u1ec1u ki\u1ec7n ",(0,h.kt)("inlineCode",{parentName:"p"},"a")," l\xe0 m\u1ed9t th\u1ec3 hi\u1ec7n c\u1ee7a l\u1edbp ",(0,h.kt)("inlineCode",{parentName:"p"},"Lift")," v\xe0 bi\u1ebfn n\xf3 th\xe0nh m\u1ed9t \u0111o\u1ea1n m\xe3 t\u1eadp l\u1ec7nh Plutus t\u01b0\u01a1ng \u1ee9ng v\u1edbi c\xf9ng ki\u1ec3u."),(0,h.kt)("p",null,"B\xe2y gi\u1edd ch\xfang t\xf4i c\xf3 th\u1ec3 s\u1eeda ch\u1eefa tr\xecnh x\xe1c nh\u1eadn c\u1ee7a m\xecnh."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"typedValidator :: VestingParam -> Scripts.TypedValidator Vesting\ntypedValidator p = Scripts.mkTypedValidator @Vesting\n    ($$(PlutusTx.compile [|| mkValidator ||]) `PlutusTx.applyCode` PlutusTx.liftCode p)\n    $$(PlutusTx.compile [|| wrap ||])\n  where\n    wrap = Scripts.wrapValidator @() @()\n")),(0,h.kt)("p",null,"M\xe3 n\xe0y \u1ed5n, nh\u01b0ng n\xf3 s\u1ebd kh\xf4ng \u0111\u01b0\u1ee3c bi\xean d\u1ecbch, b\u1edfi v\xec ",(0,h.kt)("inlineCode",{parentName:"p"},"VestingParam")," kh\xf4ng ph\u1ea3i l\xe0 m\u1ed9t phi\xean b\u1ea3n c\u1ee7a ",(0,h.kt)("inlineCode",{parentName:"p"},"Lift"),". \u0110\u1ec3 kh\u1eafc ph\u1ee5c \u0111i\u1ec1u n\xe0y, ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ",(0,h.kt)("inlineCode",{parentName:"p"},"makeLift")),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"PlutusTx.makeLift ''VestingParam\n")),(0,h.kt)("p",null,"V\xe0, ch\xfang ta c\u1ea7n b\u1eadt ti\u1ec7n \xedch m\u1edf r\u1ed9ng GHC."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"{-# LANGUAGE MultiParamTypeClasses #-}\n")),(0,h.kt)("p",null,"B\xe2y gi\u1edd n\xf3 s\u1ebd bi\xean d\u1ecbch."),(0,h.kt)("h3",{id:"off-chain"},"Off-Chain"),(0,h.kt)("p",null,"M\xe3 ngo\xe0i chu\u1ed7i kh\xf4ng thay \u0111\u1ed5i nhi\u1ec1u."),(0,h.kt)("p",null,"C\xe1c ",(0,h.kt)("inlineCode",{parentName:"p"},"GiveParams")," v\u1eabn gi\u1ed1ng nhau."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"data GiveParams = GiveParams\n      { gpBeneficiary :: !PubKeyHash\n      , gpDeadline    :: !POSIXTime\n      , gpAmount      :: !Integer\n      } deriving (Generic, ToJSON, FromJSON, ToSchema)      \n")),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"VestingSchema")," \u0111\xe3 thay \u0111\u1ed5i m\u1ed9t ch\xfat v\xec endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"grab"),"  gi\u1edd \u0111\xe2y d\u1ef1a v\xe0o vi\u1ec7c bi\u1ebft ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xe0 th\u1eddi h\u1ea1n \u0111\u1ec3 bi\u1ebft x\xe1c \u0111\u1ecbnh \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh. Ch\xfang t\xf4i bi\u1ebft ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xec n\xf3 s\u1ebd l\xe0 m\xe3 b\u0103m kh\xf3a c\xf4ng khai c\u1ee7a v\xed g\u1ecdi ",(0,h.kt)("inlineCode",{parentName:"p"},"grab"),", nh\u01b0ng ch\xfang t\xf4i kh\xf4ng bi\u1ebft th\u1eddi h\u1ea1n, v\xec v\u1eady ch\xfang t\xf4i ph\u1ea3i chuy\u1ec3n n\xf3 cho ",(0,h.kt)("inlineCode",{parentName:"p"},"grab"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'type VestingSchema =\n          Endpoint "give" GiveParams\n      .\\/ Endpoint "grab" POSIXTime\n')),(0,h.kt)("p",null,"endpoint",(0,h.kt)("inlineCode",{parentName:"p"},"give")," t\u01b0\u01a1ng t\u1ef1 nh\u01b0 v\xed d\u1ee5 vesting, nh\u01b0ng c\xf3 m\u1ed9t s\u1ed1 kh\xe1c bi\u1ec7t."),(0,h.kt)("p",null,"Thay v\xec t\xednh to\xe1n d\u1eef li\u1ec7u, ch\xfang t\xf4i s\u1ebd x\xe2y d\u1ef1ng m\u1ed9t c\xe1i g\xec \u0111\xf3 ki\u1ec3u\n",(0,h.kt)("inlineCode",{parentName:"p"},"VestingParam"),".Ch\xfang t\xf4i c\u0169ng thay \u0111\u1ed5i tham chi\u1ebfu \u0111\u1ebfn datum trong\n",(0,h.kt)("inlineCode",{parentName:"p"},"mustPayToTheScript")," \u0111\u1ec3 tr\u1edf th\xe0nh ",(0,h.kt)("inlineCode",{parentName:"p"},"()"),", v\xe0 ch\xfang t\xf4i cung c\u1ea5p c\xe1c lo\u1ea1i ",(0,h.kt)("inlineCode",{parentName:"p"},"p")," \u0111\u1ec3 ",(0,h.kt)("inlineCode",{parentName:"p"},"typedValidator")," nh\u01b0 n\xf3 kh\xf4ng c\xf2n l\xe0 m\u1ed9t h\u1eb1ng s\u1ed1."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'give :: AsContractError e => GiveParams -> Contract w s e ()\ngive gp = do\n    let p  = VestingParam\n                { beneficiary = gpBeneficiary gp\n                , deadline    = gpDeadline gp\n                }\n        tx = mustPayToTheScript () $ Ada.lovelaceValueOf $ gpAmount gp\n    ledgerTx <- submitTxConstraints (typedValidator p) tx\n    void $ awaitTxConfirmed $ txId ledgerTx\n    logInfo @String $ printf "made a gift of %d lovelace to %s with deadline %s"\n        (gpAmount gp)\n        (show $ gpBeneficiary gp)\n        (show $ gpDeadline gp)      \n')),(0,h.kt)("p",null,"Endpoint ",(0,h.kt)("inlineCode",{parentName:"p"},"grab"),"  c\u0169ng c\xf3 m\u1ed9t s\u1ed1 thay \u0111\u1ed5i."),(0,h.kt)("p",null,"Nh\u1edb l\u1ea1i r\u1eb1ng tr\u01b0\u1edbc \u0111\xf3 ch\xfang ta c\xf3 t\u1ea5t c\u1ea3 c\xe1c UTxO \u1edf t\u1ea1i m\u1ed9t \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh n\xe0y v\xe0 ch\xfang c\xf3 th\u1ec3 d\xe0nh cho nh\u1eefng ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng t\xf9y \xfd v\xe0 cho nh\u1eefng th\u1eddi h\u1ea1n t\xf9y \xfd. V\xec l\xfd do n\xe0y, ch\xfang t\xf4i ph\u1ea3i l\u1ecdc nh\u1eefng UTxO d\xe0nh cho ch\xfang t\xf4i v\xe0 nh\u1eefng n\u01a1i \u0111\xe3 \u0111\u1ebfn th\u1eddi h\u1ea1n."),(0,h.kt)("p",null,"B\xe2y gi\u1edd ch\xfang t\xf4i c\xf3 tham s\u1ed1 b\u1ed5 sung, m\xe0 ch\xfang t\xf4i s\u1ebd g\u1ecdi ",(0,h.kt)("inlineCode",{parentName:"p"},"d"),", \u0111\u1ea1i di\u1ec7n cho th\u1eddi h\u1ea1n. V\xec v\u1eady, ch\xfang t\xf4i c\xf3 th\u1ec3 ngay l\u1eadp t\u1ee9c xem n\u1ebfu th\u1eddi h\u1ea1n \u0111\xe3 \u0111\u1ebfn hay ch\u01b0a."),(0,h.kt)("p",null,"N\u1ebfu n\xf3 v\u1eabn ch\u01b0a \u0111\u1ea1t \u0111\u01b0\u1ee3c, ch\xfang t\xf4i vi\u1ebft m\u1ed9t th\xf4ng b\xe1o nh\u1eadt k\xfd v\xe0 d\u1eebng l\u1ea1i, n\u1ebfu kh\xf4ng ch\xfang t\xf4i ti\u1ebfp t\u1ee5c v\xe0 x\xe2y d\u1ef1ng ",(0,h.kt)("inlineCode",{parentName:"p"},"VestingParam"),"."),(0,h.kt)("p",null,"Sau \u0111\xf3, ch\xfang t\xf4i t\xecm ki\u1ebfm c\xe1c UTxO c\xf3 t\u1ea1i \u0111\u1ecba ch\u1ec9 n\xe0y. \u0110\u1ecba ch\u1ec9 kh\xf4ng ph\u1ea3i l\xe0 m\u1ed9t h\u1eb1ng s\u1ed1 n\u1eefa, n\xf3 nh\u1eadn m\u1ed9t tham s\u1ed1. V\xec v\u1eady, b\xe2y gi\u1edd, ch\xfang t\xf4i s\u1ebd ch\u1ec9 nh\u1eadn \u0111\u01b0\u1ee3c UTxO d\xe0nh cho ch\xfang t\xf4i v\xe0 \u0111\xe3 \u0111\u1ebfn th\u1eddi h\u1ea1n. Ch\xfang ta kh\xf4ng c\u1ea7n l\u1ecdc b\u1ea5t c\u1ee9 th\u1ee9 g\xec."),(0,h.kt)("p",null,"N\u1ebfu kh\xf4ng c\xf3 th\xf4ng b\xe1o n\xe0o, ch\xfang t\xf4i ghi l\u1ea1i m\u1ed9t th\xf4ng b\xe1o cho hi\u1ec7u \u1ee9ng \u0111\xf3 v\xe0 d\u1eebng l\u1ea1i, n\u1ebfu kh\xf4ng, ch\xfang t\xf4i l\xe0m nhi\u1ec1u h\u01a1n ho\u1eb7c \xedt h\u01a1n nh\u1eefng g\xec ch\xfang t\xf4i \u0111\xe3 l\xe0m tr\u01b0\u1edbc \u0111\xf3."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},'grab d = do\nnow   <- currentTime\npkh   <- pubKeyHash <$> ownPubKey\nif now < d\n    then logInfo @String $ "too early"\n    else do\n        let p = VestingParam\n                    { beneficiary = pkh\n                    , deadline    = d\n                    }\n                    utxos <- utxoAt $ scrAddress p\n                    if Map.null utxos\n                        then logInfo @String $ "no gifts available"\n                        else do\n                            let orefs   = fst <$> Map.toList utxos\n                                lookups = Constraints.unspentOutputs utxos      <>\n                                          Constraints.otherScript (validator p)\n                                tx :: TxConstraints Void Void\n                                tx      = mconcat [mustSpendScriptOutput oref $ Redeemer $ PlutusTx.toData () | oref <- orefs] <>\n                                          mustValidateIn (from now)\n                            ledgerTx <- submitTxConstraintsWith @Void lookups tx\n                            void $ awaitTxConfirmed $ txId ledgerTx\n                            logInfo @String $ "collected gifts"                          \n')),(0,h.kt)("p",null,"C\xe1c h\xe0m ",(0,h.kt)("inlineCode",{parentName:"p"},"endpoints")," l\xe0 h\u01a1i kh\xe1c nhau do c\xe1c tham s\u1ed1 m\u1edbi cho",(0,h.kt)("inlineCode",{parentName:"p"},"grab"),"."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-{.haskell}"},"endpoints :: Contract () VestingSchema Text ()\nendpoints = (give' `select` grab') >> endpoints\n  where\n    give' = endpoint @\"give\" >>= give\n    grab' = endpoint @\"grab\" >>= grab\n")),(0,h.kt)("h3",{id:"quay-l\u1ea1i-playground"},"Quay l\u1ea1i playground"),(0,h.kt)("p",null,"B\xe2y gi\u1edd ch\xfang t\xf4i s\u1ebd sao ch\xe9p v\xe0 d\xe1n h\u1ee3p \u0111\u1ed3ng m\u1edbi n\xe0y v\xe0o s\xe2n ch\u01a1i v\xe0 thi\u1ebft l\u1eadp m\u1ed9t k\u1ecbch b\u1ea3n m\u1edbi."),(0,h.kt)("p",null,"C\xe1c ",(0,h.kt)("inlineCode",{parentName:"p"},"give")," giao d\u1ecbch \u0111\u1ec1u gi\u1ed1ng nhau."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(4233).Z})),(0,h.kt)("p",null,(0,h.kt)("inlineCode",{parentName:"p"},"Grab")," h\u01a1i kh\xe1c nhau. Trong l\u1ea7n tri\u1ec3n khai tr\u01b0\u1edbc \u0111\xf3 c\u1ee7a ch\xfang t\xf4i, m\u1ed9t v\xed c\xf3 th\u1ec3 l\u1ea5y UTxO v\u1edbi c\xe1c th\u1eddi h\u1ea1n kh\xe1c nhau mi\u1ec5n l\xe0 th\u1eddi h\u1ea1n \u0111\xe3 qua. B\xe2y gi\u1edd th\u1eddi h\u1ea1n l\xe0 m\u1ed9t ph\u1ea7n c\u1ee7a tham s\u1ed1 script, v\xec v\u1eady ch\xfang ta c\u1ea7n ch\u1ec9 \u0111\u1ecbnh n\xf3 \u0111\u1ec3 l\u1ea5y \u0111\u1ecba ch\u1ec9 script. \u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 V\xed 2 kh\xf4ng th\u1ec3 l\u1ea5y qu\xe0 cho c\xe1c v\u1ecb tr\xed 10 v\xe0 20 c\xf9ng m\u1ed9t l\xfac, \xedt nh\u1ea5t l\xe0 kh\xf4ng theo c\xe1ch m\xe0 ch\xfang t\xf4i \u0111\xe3 tri\u1ec3n khai."),(0,h.kt)("p",null,"Tr\u01b0\u1edbc ti\xean, ch\xfang ta c\xf3 th\u1ec3 \u0111\u1ee3i cho \u0111\u1ebfn khe 10 v\xe0 sau \u0111\xf3 V\xed 2 s\u1ebd c\xf3 th\u1ec3 nh\u1eadn \u0111\u01b0\u1ee3c m\xf3n qu\xe0 \u0111\u1ea7u ti\xean v\xe0 V\xed 3 s\u1ebd c\xf3 th\u1ec3 nh\u1eadn \u0111\u01b0\u1ee3c m\xf3n qu\xe0 duy nh\u1ea5t c\u1ee7a n\xf3."),(0,h.kt)("p",null,"Ch\xfang t\xf4i s\u1ebd th\xeam m\u1ed9t ",(0,h.kt)("inlineCode",{parentName:"p"},"grab")," cho v\xed 2 v\xe0 v\xed 3. \u1ede \u0111\xe2y, ch\xfang t\xf4i kh\xf4ng c\u1ea7n ph\u1ea3i ph\xe2n bi\u1ec7t gi\u1eefa m\u1ed7i giao d\u1ecbch v\xec n\xf3 l\xe0 hai v\xed kh\xe1c nhau."),(0,h.kt)("p",null,"Sau \u0111\xf3, ch\xfang t\xf4i \u0111\u1ee3i cho \u0111\u1ebfn khe 20 v\xe0 th\u1ef1c hi\u1ec7n l\u1ea7n th\u1ee9 hai c\u1ee7a ",(0,h.kt)("inlineCode",{parentName:"p"},"grab"),"v\xed 2  v\xe0 sau \u0111\xf3 \u0111\u1ee3i 1 kh\u1ed1i, nh\u01b0 b\xecnh th\u01b0\u1eddng."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(6877).Z})),(0,h.kt)("p",null,"V\xec v\u1eady, h\xe3y xem n\u1ebfu n\xf3 ho\u1ea1t \u0111\u1ed9ng b\u1eb1ng c\xe1ch nh\u1ea5p v\xe0o ",(0,h.kt)("inlineCode",{parentName:"p"},"Evaluate"),"."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(2740).Z})),(0,h.kt)("p",null,"Ghi l\u1ea1i \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh cho giao d\u1ecbch \u0111\xf3 t\u1ea1i v\u1ecb tr\xed 1."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(3086).Z})),(0,h.kt)("p",null,"V\xe0 so s\xe1nh \u0111\u1ecba ch\u1ec9 n\xe0y v\u1edbi \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh cho \u0111\u1ea7u ra giao d\u1ecbch t\u1ea1i v\u1ecb tr\xed 2."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(7619).Z})),(0,h.kt)("p",null,"L\u01b0u \xfd r\u1eb1ng \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh cho c\xe1c UTxO l\xe0 kh\xe1c nhau. Trong phi\xean b\u1ea3n \u0111\u1ea7u ti\xean c\u1ee7a h\u1ee3p \u0111\u1ed3ng vesting, \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh l\xe0 m\u1ed9t h\u1eb1ng s\u1ed1. \u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 t\u1ea5t c\u1ea3 qu\xe0 t\u1eb7ng c\u1ee7a ch\xfang t\xf4i k\u1ebft th\xfac \u1edf c\xf9ng m\u1ed9t \u0111\u1ecba ch\u1ec9 t\u1eadp l\u1ec7nh v\xe0 ch\u1ec9 c\xf3 d\u1eef li\u1ec7u trong m\u1ed7i UTxO l\xe0 kh\xe1c nhau."),(0,h.kt)("p",null,"B\xe2y gi\u1edd, d\u1eef li\u1ec7u l\xe0 ch\xednh x\xe1c ",(0,h.kt)("inlineCode",{parentName:"p"},"()")," v\xe0 ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xe0 th\u1eddi h\u1ea1n \u0111\u01b0\u1ee3c bao g\u1ed3m nh\u01b0 m\u1ed9t ph\u1ea7n c\u1ee7a ch\xednh t\u1eadp l\u1ec7nh, v\xec v\u1eady c\xe1c \u0111\u1ecba ch\u1ec9 b\xe2y gi\u1edd kh\xe1c nhau t\xf9y thu\u1ed9c v\xe0o ng\u01b0\u1eddi th\u1ee5 h\u01b0\u1edfng v\xe0 c\xe1c tham s\u1ed1 th\u1eddi h\u1ea1n."),(0,h.kt)("p",null,"\u0110\u1ed1i v\u1edbi m\xf3n qu\xe0 cho V\xed 3, ch\xfang t\xf4i th\u1ea5y c\xf3 m\u1ed9t \u0111\u1ecba ch\u1ec9 kh\xe1c."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(1191).Z})),(0,h.kt)("p",null,"Ch\xfang t\xf4i th\u1ea5y hai l\u1ea7n l\u1ea5y \u1edf v\u1ecb tr\xed 10, m\u1ed9t c\u1ee7a V\xed 2 v\xe0 m\u1ed9t c\u1ee7a V\xed 3. Th\u1ee9 t\u1ef1 m\xe0 ch\xfang \u0111\u01b0\u1ee3c x\u1eed l\xfd kh\xf4ng mang t\xednh x\xe1c \u0111\u1ecbnh."),(0,h.kt)("p",null,"Sau \u0111\xf3, cu\u1ed1i c\xf9ng \u1edf khe 20, Wallet 2 l\u1ea5y ph\u1ea7n qu\xe0 c\xf2n l\u1ea1i c\u1ee7a n\xf3."),(0,h.kt)("p",null,"V\xe0 s\u1ed1 d\u01b0 cu\u1ed1i c\xf9ng ph\u1ea3n \xe1nh c\xe1c giao d\u1ecbch \u0111\xe3 x\u1ea3y ra."),(0,h.kt)("p",null,(0,h.kt)("img",{src:e(5054).Z})))}p.isMDXComponent=!0},2058:function(n,t,e){t.Z=e.p+"assets/images/pic__00010-86ac7d37c76a594b6967b6f7648e5335.png"},5828:function(n,t,e){t.Z=e.p+"assets/images/pic__00043-90836e56ce8338b63ac410965d2cc39c.png"},2711:function(n,t,e){t.Z=e.p+"assets/images/pic__00044-ae789cd0b18189a70d1c764d465b5002.png"},3963:function(n,t,e){t.Z=e.p+"assets/images/pic__00046-91ac81d2e6110ca563ef34a48b448bb4.png"},2552:function(n,t,e){t.Z=e.p+"assets/images/pic__00047-e701ccc70650672796705049bc861960.png"},186:function(n,t,e){t.Z=e.p+"assets/images/pic__00048-d7da99592a35e7501ca80f88da6366d0.png"},6408:function(n,t,e){t.Z=e.p+"assets/images/pic__00049-d73f83f7294dd0187da15f4eaa3c7247.png"},7678:function(n,t,e){t.Z=e.p+"assets/images/pic__00050-cd1459efe52e84b5c3fcebd8fb077b08.png"},1807:function(n,t,e){t.Z=e.p+"assets/images/pic__00051-74d33494d0e068519bd23ae9b42ae1ca.png"},6735:function(n,t,e){t.Z=e.p+"assets/images/pic__00052-baa346bdcdad8c6a6cf40acf94e227d3.png"},4669:function(n,t,e){t.Z=e.p+"assets/images/pic__00053-95169853875b3a94d47aacb5be95d8f1.png"},2105:function(n,t,e){t.Z=e.p+"assets/images/pic__00054-914e9e6153e10e5200376f911ef80451.png"},8068:function(n,t,e){t.Z=e.p+"assets/images/pic__00055-9d7a06572c0cabe917a527aa359cf8e8.png"},3400:function(n,t,e){t.Z=e.p+"assets/images/pic__00056-ffd977106823023ce72d426f5bf57051.png"},1032:function(n,t,e){t.Z=e.p+"assets/images/pic__00057-deaf409949adb584abc3ce5ca4253d5a.png"},4233:function(n,t,e){t.Z=e.p+"assets/images/pic__00059-7f45bb1aa7d141818049b51dd65f2e37.png"},6877:function(n,t,e){t.Z=e.p+"assets/images/pic__00060-1d269ec56accfe952503077c80c645d2.png"},2740:function(n,t,e){t.Z=e.p+"assets/images/pic__00061-34ad2459354578430639958932e6ab4e.png"},3086:function(n,t,e){t.Z=e.p+"assets/images/pic__00062-e875c97dd2255764dd0f1526e5f9922a.png"},7619:function(n,t,e){t.Z=e.p+"assets/images/pic__00063-3044e6b470677ac95cdbeeee08d43c7d.png"},1191:function(n,t,e){t.Z=e.p+"assets/images/pic__00064-a48c950dd5dece774d65874dc96f8994.png"},5054:function(n,t,e){t.Z=e.p+"assets/images/pic__00065-00802007ba5f1b30c6122d3f2985f8fa.png"}}]);